<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Open Energy Data For All: Visual Data Exploration</title><meta name="viewport" content="width=device-width, initial-scale=1"><script src="assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="assets/styles.css"><script src="assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="favicons/incubator/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="favicons/incubator/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="favicons/incubator/favicon-16x16.png"><link rel="manifest" href="favicons/incubator/site.webmanifest"><link rel="mask-icon" href="favicons/incubator/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="black"></head><body>
    <header id="top" class="navbar navbar-expand-md top-nav incubator"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="incubator-logo" alt="Foundational data and software skills for energy data analysis." src="assets/images/incubator-logo.svg"><span class="badge text-bg-danger">
          <abbr title="This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.">
            <a href="https://docs.carpentries.org/resources/curriculum/lesson-life-cycle.html" class="external-link alert-link">
              <i aria-hidden="true" class="icon" data-feather="alert-octagon" style="border-radius: 5px"></i>
              Pre-Alpha
            </a>
            <span class="visually-hidden">This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.</span>
          </abbr>
        </span>

      </div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text"><li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul></li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/visual-data-exploration.html';">Instructor View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Foundational data and software skills for energy data analysis." src="assets/images/incubator-logo-sm.svg"></div>
    <div class="lesson-title-md">
      Open Energy Data For All
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            Open Energy Data For All
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"><li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul></li>
      </ul></div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Open Energy Data For All
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 37%" class="percentage">
    37%
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: 37%" aria-valuenow="37" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text"><li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul></li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/visual-data-exploration.html">Instructor View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->

            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Setup</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="introduction.html">1. Introduction</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="working-with-diverse-filetypes.html">2. Handling diverse filetypes in Pandas</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="accessing-remote-data.html">3. Accessing remote data</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="scraping-data.html">4. Scraping Data</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        5. Visual Data Exploration
        </span>
      
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="assumptions.html">6. Making assumptions about your data</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="coming-soon.html">7. More Topics Coming Soon</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glossary</a>
                      </li>
                      <li>
                        <a href="profiles.html">Learner Profiles</a>
                      </li>
                      <li><a href="reference.html">Reference</a></li>
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources"><a href="aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">

            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="scraping-data.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="assumptions.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="scraping-data.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Scraping Data
        </a>
        <a class="chapter-link float-end" href="assumptions.html" rel="next">
          Next: Making assumptions...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Visual Data Exploration</h1>
        <p>Last updated on 2025-09-09 |

        <a href="https://github.com/catalyst-cooperative/open-energy-data-for-all/edit/main/episodes/visual-data-exploration.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>



        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>How do I get ready to do research with data that is new to me?</li>
<li>What should I do when I find something that doesn’t look right?</li>
<li>How can I get a head start on identifying data problems that might
cause headaches later?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>Use divide-and-conquer to split a table into manageable pieces</li>
<li>Examine data for anomalies using summarization and
visualization</li>
<li>Articulate the difference between refining plots for exploration and
refining plots for presentation</li>
<li>Execute strategies for locating the cause and extent of
anomalies</li>
</ul></div>
</div>
</div>
</div>
</div>
<p>Now that you have some raw data, how do you get from there to
actually doing research with it?</p>
<p>Maybe you already have a research question; how do you get your data
into a form that can help you answer it? How do you know your data
doesn’t have gremlins hiding in it that will mess up your research?</p>
<p>In this session we will do some initial data explorations and develop
strategies for identifying and diagnosing sneaky data problems –
including the use of data visualization as part of your exploration
toolkit. Plots aren’t just for papers!</p>
<div class="section level1">
<h1 id="what-kinds-of-data-problems-are-common-in-energy-data">What kinds of data problems are common in energy data?<a class="anchor" aria-label="anchor" href="#what-kinds-of-data-problems-are-common-in-energy-data"></a></h1>
<p>Data problems come in many different forms, and how you respond to
them will depend on the source of the problem and what kind of impact it
will have on the kinds of modeling and analysis you want to do.</p>
<ul><li>
<strong>Problems introduced by the respondent</strong> - typos and
other data entry errors - These can be fixed if they’re simple, or can
be a reason to exclude certain rows if correct values can’t be
reconstructed.</li>
<li>
<strong>Problems introduced by the data aggregator</strong> -
disagreement between documentation you received and the actual forms
filled out by respondents; a bad choice of data format that doesn’t
preserve relationships within the data - These can sometimes be “fixed”
by working out logically what the definition of a column should actually
be, but sometimes not.</li>
<li>
<strong>“Problems” introduced by external forces</strong> - natural
disasters, policy change - These may be retained or excluded depending
on your exact area of research.</li>
<li>
<strong>Problems we created for ourselves</strong> - We’ll talk
about this in a later session.</li>
</ul><p>Data problems can occur in a single column, or in the relationship
between columns, or even in the relationship between tables.</p>
</div>
<div class="section level1">
<h1 id="what-is-a-good-general-strategy-for-finding-problems-in-unfamiliar-data">What is a good general strategy for finding problems in unfamiliar
data?<a class="anchor" aria-label="anchor" href="#what-is-a-good-general-strategy-for-finding-problems-in-unfamiliar-data"></a></h1>
<p>Data problems aren’t always obvious. To uncover them, we will need to
go looking for them.</p>
<p>There is a pattern to this:</p>
<ul><li>Carve off a chunk of data small enough to reason about</li>
<li>Identify what we expect to see from that data</li>
<li>Compare with what we actually see</li>
<li>Justify or explain any differences between what we expect and what
is actually there</li>
</ul><p>When we first start out, our expectations will be quite general,
often based on data type – whether the data is numeric, categorical, or
free text. As we become more familiar with the data, our expectations
will become more sophisticated.</p>
</div>
<div class="section level1">
<h1 id="put-it-into-practice">Put it into practice<a class="anchor" aria-label="anchor" href="#put-it-into-practice"></a></h1>
<p>Let’s take a look at how these ideas apply to real data.</p>
<p>We’re looking at form EIA-923, which covers electricity generation
and fuel consumption by plant and prime mover on a monthly and annual
basis.</p>
<p>You have one raw file for EIA-923 data from Puerto Rico, and two
processed files which were prepared by your predecessor:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>raw_file <span class="op">=</span> <span class="st">"../data/raw_eia923__puerto_rico_generation_fuel.parquet"</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>annual_file <span class="op">=</span> <span class="st">"../data/pr_gen_fuel_annual.parquet"</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>monthly_file <span class="op">=</span> <span class="st">"../data/pr_gen_fuel_monthly.parquet"</span></span></code></pre>
</div>
<p>(They also left you their source code, but we’ll start with the data
and take a look at the code in another session. Reading the code will be
easier if we are more familiar with the data.)</p>
<p>We will ask ourselves:</p>
<ul><li>What kinds of data are there? Can I look at just one kind at a
time?</li>
<li>What do I expect to see from this data?</li>
<li>What do I actually see?</li>
<li>Can I justify or explain any differences between what I expect and
what I actually see?</li>
</ul><div class="section level2">
<h2 id="annual-data">Annual data<a class="anchor" aria-label="anchor" href="#annual-data"></a></h2>
<p>We’ll start with the annual file.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>pr_gen_fuel_annual <span class="op">=</span> pd.read_parquet(annual_file)</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>pr_gen_fuel_annual</span></code></pre>
</div>
<p>Our predecessor has already taken care of a lot of the cleaning
necessary for this data, so it’s already in usable condition, with nice
specific data types and a tidy arrangement of columns.
<!--  -- we'll dig into their pipeline for that in a later session, but it covered setting appropriate data types, splitting annual data from monthly data, and pivoting the monthly data from a wide to a tidy narrow format. --></p>
<p>We want to focus on uncovering problems that didn’t show up during
cleaning.</p>
<p>There are 24 columns here, which is a little much to reason about all
at once. One way to tackle a problem that seems too large is to break it
up into smaller pieces. There are lots of ways to split up a wide table,
and they’ll all work well enough to get you started:</p>
<ul><li>Split up columns by purpose
<ul><li>Primary key columns: the columns that uniquely identify each row of
data; closely related to what each row represents</li>
<li>Timeseries columns: the independent and dependent variables you
would plot in a line chart</li>
<li>Grouping columns: the columns you could use to group data together
and see if different groups have different properties</li>
</ul></li>
<li>Split up columns by data type
<ul><li>Numeric data</li>
<li>Categorical data
<ul><li>Identifiers</li>
<li>Codes</li>
<li>True/false (“booleans”)</li>
</ul></li>
<li>Free text data</li>
</ul></li>
</ul><p>Generally, splitting up columns by purpose requires more domain
knowledge, but can also help you understand the meaning of the data more
quickly than looking just based on data type. We’ll use a little of both
so you can see what they’re like.</p>
<div class="section level3">
<h3 id="primary-keys-index-columns">Primary keys &amp; index columns<a class="anchor" aria-label="anchor" href="#primary-keys-index-columns"></a></h3>
<p>Let’s start with a primary key. What columns, taken together, have
unique values from row to row? What does each row in this file
represent?</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># 1. carve off a chunk: what is the primary key?</span></span></code></pre>
</div>
<p>If we were familiar with EIA 923 from other research, we might know
that already. If not, we can check the dataset documentation. The
grandfather of this dataframe is an Excel file, which has some
documentation we can look at.</p>
<p>If you want to follow along, you can find the file
<code>eia923_pr.xlsx</code> in the <code>data</code> directory of the
lesson repo.</p>
<figure><img src="fig/ep-5/eia923-filelayout.png" alt="Excel screenshot showing tab Page 7 File Layout of file data/eia923_pr.xlsx. A table titled Generation and Fuel Data has two columns, Data Elements and Description. The first few rows are visible; contents as follows. Plant ID: EIA Plant Identification number. One to five digit numeric. Combined Heat &amp; Power Plant: Whether or not the plant is a combined heat &amp; power facility (cogenerator). One character alphanumeric, Y or N. Nuclear Unit ID: For nuclear plants only, the unit number. One digit numeric. Nuclear plants are the only type of plants for which data are shown explicitly at the generating unit level. Plant Name: Plant name. Alphanumeric. Operator Name: The name of the entity which operates the plant. Alphanumeric. Operator ID: The EIA operator identification number. Five digit numeric, padded with leading zeros. State: State the facility is located in. Two character alphanumeric (standard state postal codes)." class="figure mx-auto d-block"><div class="figcaption">Excel screenshot showing tab Page 7 File Layout
of data/eia923_pr.xlsx</div>
</figure><p>The documentation doesn’t say what uniquely identifies each entry; we
will have to reason it out. We know each plant has to file with the EIA
every year, so we’ll use that as our initial guess:</p>
<ul><li>Plant ID</li>
<li>Year</li>
</ul><p>Let’s check. If that’s the primary key, then we expect each pair of
(plant ID, year) values to only occur once in the data frame.
<code>.value_counts()</code> will tell us the number of times each
distinct row occurs in a data frame. If we select only the primary key
columns, then it will tell us how many times each primary key value
occurs. If there are no values that occur more than once, or few enough
that we could believe they were mistakes, then we got it.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="co"># 1. carve off a chunk: what is the primary key?</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>primary_key_columns <span class="op">=</span> [<span class="st">"plant_id_eia"</span>, <span class="st">"report_year"</span>]</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="co"># 2. what do we expect: every pk value occurs no more than once</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>pr_gen_fuel_annual[primary_key_columns].value_counts()</span></code></pre>
</div>
<p>There are 283 rows in the result, so there are 283 primary key values
available. Oh dear there are some that occur five or six times. How
common is that? For easier readability we can add the plant name in.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>primary_key_columns <span class="op">=</span> [<span class="st">"plant_id_eia"</span>, <span class="st">"plant_name_eia"</span>, <span class="st">"report_year"</span>]</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="co"># 2. what do we expect: every pk value occurs no more than once</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>pr_gen_fuel_annual[primary_key_columns].value_counts()</span></code></pre>
</div>
<p>And then filter for just the ones with multiple rows.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>primary_key_columns <span class="op">=</span> [<span class="st">"plant_id_eia"</span>, <span class="st">"plant_name_eia"</span>, <span class="st">"report_year"</span>]</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="co"># 2. what do we expect: every pk value occurs no more than once</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>pk_sizes <span class="op">=</span> pr_gen_fuel_annual[primary_key_columns].value_counts()</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>pk_sizes.loc[pk_sizes<span class="op">&gt;</span><span class="dv">1</span>]</span></code></pre>
</div>
<p>Ninety one! Out of 283. That’s almost a third. We might expect a few
errors but a third is too many; it’s more likely we’re wrong about the
primary key. Let’s look at one example.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co"># 3. what did we find: 1/3 occur more than once</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="co"># 4. explain why: try an example</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>pr_gen_fuel_annual.loc[</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>    (pr_gen_fuel_annual.plant_id_eia <span class="op">==</span> <span class="dv">66127</span>) <span class="op">&amp;</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>    (pr_gen_fuel_annual.report_year <span class="op">==</span> <span class="dv">2022</span>)</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>].transpose()</span></code></pre>
</div>
<p>Looks like these two records differ in
<code>energy_source_code</code>. Let’s add that in, and see if our
revised expectation holds true.</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="co"># 4. explain why: we were missing energy_source_code</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>primary_key_columns <span class="op">=</span> [<span class="st">"plant_id_eia"</span>, <span class="st">"plant_name_eia"</span>, <span class="st">"report_year"</span>, <span class="st">"energy_source_code"</span>]</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="co"># 2. what we expect: no more than once</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>pk_sizes <span class="op">=</span> pr_gen_fuel_annual[primary_key_columns].value_counts()</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>pk_sizes.loc[pk_sizes<span class="op">&gt;</span><span class="dv">1</span>]</span></code></pre>
</div>
<p>Better, but we still have a lot of duplicates.</p>
<div id="challenge1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p>Look at one of the duplicate entries and propose another column to
add to our primary key.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>If we add <code>prime_mover_code</code> to our primary key, we end up
with only one duplicate entry.</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>primary_key_columns <span class="op">=</span> [</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>    <span class="st">'plant_id_eia'</span>, <span class="st">'plant_name_eia'</span>, <span class="st">'report_year'</span>, <span class="st">'energy_source_code'</span>, <span class="st">'prime_mover_code'</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>]</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="co"># 3. what we found: one duplicate</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>pk_sizes <span class="op">=</span> pr_gen_fuel_annual[primary_key_columns].value_counts()</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>pk_sizes.loc[pk_sizes<span class="op">&gt;</span><span class="dv">1</span>]</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>plant_id_eia  plant_name_eia            report_year  prime_mover_code  energy_source_code
62410         Cervecera de Puerto Rico  2020         IC                DFO                   2
dtype: int64</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Only one! That’s plausibly a respondent error or data entry
problem.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="co"># 4. explain why: likely respondent error or data entry problem</span></span></code></pre>
</div>
<p>We can note that plant down as a possible troublemaker to investigate
later.</p>
<p>It’s a good idea to keep notes on the problems you find, or little
bits that look suspicious but would take away from your primary focus if
you chased them immediately. Let’s do that now. We’ll open up a new
document, and make a note of what we found.</p>
<pre class="text"><code># Problems in EIA-923 Puerto Rico data

Primary key occurs twice:
    plant_id_eia  plant_name_eia            report_year  prime_mover_code  energy_source_code
    62410         Cervecera de Puerto Rico  2020         IC                DFO                   2
    dtype: int64</code></pre>
<p>But we have our primary key! That’s five columns we’ve carved off of
the original 24, using the “split columns by purpose” strategy. We wound
up needing a combination of domain knowledge from the documentation, and
empirical knowledge gained by guess-and-check.</p>
<p>Using this approach, we found one duplicate entry that could mess up
our analysis later.</p>
<p>Next let’s take a look at an example of the “split columns by data
type” strategy.</p>
</div>
<div class="section level3">
<h3 id="splitting-columns-by-data-type">Splitting columns by data type<a class="anchor" aria-label="anchor" href="#splitting-columns-by-data-type"></a></h3>
<p>Let’s think about how data type affects what we expect to see.</p>
<ul><li>
<strong>Numeric data</strong> might be in whole numbers (1, 2, -11,
56,912) or use decimal fractions (3.14, 0.000123, -65,536.2). In
programming, a whole number is often called an “integer” or “int” while
a number with a decimal fraction is often called a “float” (short for
“floating point”, which has to do with minutiae of how fractions are
implemented in binary – we don’t need to know the details for this
course)</li>
<li>
<strong>Categorical data</strong> takes on one of a restricted set
of available values. They might be ID numbers, an alphanumeric string, a
few words, or a few letters meant to abbreviate a longer category name.
If a value appears that is not in the restricted set, that value is
invalid, and likely resulted from a typo or similar error. An
explanation of all the available values for each categorical column is
usually included in the documentation for a data source, but sometimes
you can get a rough idea from context.</li>
<li>
<strong>Free text data</strong> [which we won’t cover today] is
unrestricted, except perhaps in length. It might be a description of an
incident, location, or piece of equipment. A free text value is not
required to match any other entry or registry, and there’s usually no
such thing as an invalid value. Free text typically requires the
application of qualitative research methods before it can be analyzed
further. Unfortunately, in energy data it is common for things like
plant names to be entered as free text – meaning you have to cope with a
variety of spelling and abbreviation choices when trying to match
between data sets.</li>
</ul><!--
All data types need to deal with situations where no value is available for that entry.
In pandas, we usually encode an intentionally missing value as `NA`.
Elsewhere in Python, we use `None`.
Other programming languages, software, and systems may make different choices.
Often, one of the first things to do when getting a new data set ready for research is to figure out how missing data was encoded by the data source, and map that to how *you* plan to encode missing data.
 --><p>We can use <code>.dtypes</code> to show the data type of each
column.</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>pr_gen_fuel_annual.dtypes</span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="categorical-data">Categorical data<a class="anchor" aria-label="anchor" href="#categorical-data"></a></h3>
<p>We’ll start with categorical data.</p>
<p>Some of the columns have already been labeled as having pandas data
type <code>category</code>. That’s a pandas dtype that automatically
restricts the set of values the column is allowed to take. We can
examine one of the dtypes directly to see the available values for that
column:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>pr_gen_fuel_annual.dtypes[<span class="st">"energy_source_code"</span>]</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>CategoricalDtype(categories=['BIT', 'DFO', 'MWH', 'NG', 'RFO', 'SUN', 'WAT', 'WND'], ordered=False, categories_dtype=object)</code></pre>
</div>
<p>We can glean a little information just from context here – this is an
energy source code, and it looks like it’s a 2- or 3-letter abbreviation
for where the energy came from. NG could be natural gas; SUN feels
likely for solar, WAT for hydro, WND for wind. BIT may be familiar if
you’re from anywhere in Appalachia, for bituminous coal. DFO and RFO are
a mystery to me, but codes like this should be defined in the
documentation for each dataset. Let’s look in the EIA 923 documentation
to see what the others are.</p>
<figure><img src="fig/ep-5/eia923-reported_fuel_type_code.png" alt="Excel screenshot showing rows 68-94 of tab Page 7 File Layout of data/eia923_pr.xlsx. Row 68 contains the title: Reported Fuel Type Code; and description: The fuel code reported to EIA, two or three letter alphanumeric. There are rows for BIT (bituminous coal), DFO (distillate Fuel Oil including diesel, number 1, number 2, and number 4 fuel oils), NG (natural gas), and RFO (residual fuel oil, including number 5 and 6 fuel oils and bunker c fuel oil)." class="figure mx-auto d-block"><div class="figcaption">Excel screenshot showing tab Page 7 File Layout
of data/eia923_pr.xlsx, rows 68-94</div>
</figure><p>Under Reported Fuel Type Code, there are a lot more options than we
have in the pandas dtype, but that’s okay so long as all the options we
<em>do</em> have in the pandas dtype are listed – and they are. DFO is
distillate fuel oil (like diesel), and RFO is residual fuel oil.</p>
<div id="challenge2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p>Look at <code>reporting_frequency_code</code>, which is another
column with the <code>category</code> dtype. Use the column name, the
available values, and the EIA 923 documentation to get a rough idea of
what the category means.</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<p>The <code>reporting_frequency_code</code> column has 3 available
values:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>pr_gen_fuel_annual.dtypes[<span class="st">"reporting_frequency_code"</span>]</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>CategoricalDtype(categories=['A', 'AM', 'M'], ordered=False, categories_dtype=object)</code></pre>
</div>
<p>The documentation says these indicate respondents that file annually
with only annual totals, respondents that file annually with both annual
and monthly data, and respondents that file monthly data each month.</p>
</div>
</div>
</div>
</div>
<p>Great! Now we know how to start making sense of columns with the
<code>category</code> dtype.</p>
<p>To go deeper, let’s collect all the category columns together so we
can analyse them all at the same time.</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="co"># 1. carve off a chunk: what columns contain categorical data?</span></span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>category_columns <span class="op">=</span> <span class="bu">list</span>(</span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>    pr_gen_fuel_annual.dtypes[</span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>        (pr_gen_fuel_annual.dtypes <span class="op">==</span> <span class="st">"category"</span>)</span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a>    ].index</span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a>)</span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a>category_columns</span></code></pre>
</div>
<p>We can use <code>.describe()</code> to show some basic information
about category data.</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a>pr_gen_fuel_annual[category_columns].describe()</span></code></pre>
</div>
<p>Let’s look at <code>energy_source_code</code> as an example:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>energy_source_code	fuel_type_code_agg	fuel_unit	plant_state	prime_mover_code	reporting_frequency_code	data_maturity
count	450	450	319	450	450	349	450
unique	8	8	4	1	9	3	2
top	DFO	DFO	barrels	PR	PV	M	final
freq	188	188	237	450	99	181	417</code></pre>
</div>
<ul><li>
<code>count</code> shows us how many rows have a value set. If it’s
equal to the total number of rows, you know you have no nulls. Looks
like there aren’t any nulls in the in the energy source code, which is
good.</li>
<li>
<code>unique</code> shows us how many unique values are in each
column. We already kinda know this from looking at the category dtype
object, but it’s nice to have confirmation that this data includes 8
different energy source codes.</li>
<li>
<code>top</code> shows us the most common value in each column, and
<code>freq</code> shows how many times that value appeared. Looks like a
third to half of the rows have an energy source code of DFO.</li>
</ul><p>We can apply our strategy here too:</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="co"># 2. what do we expect?</span></span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a><span class="co"># - count: no nulls*</span></span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a><span class="co"># - unique: matches category dtype count, ~matches documentation</span></span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a><span class="co"># - top&amp;freq: plausible</span></span></code></pre>
</div>
<p>To go even further, we can look at the frequency table for
<code>energy_source_code</code> using <code>.value_counts()</code>:</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a>pr_gen_fuel_annual.energy_source_code.value_counts()</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>energy_source_code
DFO    188
SUN     99
NG      49
RFO     49
MWH     24
WND     17
WAT     15
BIT      9
Name: count, dtype: int64</code></pre>
</div>
<p>This builds up our domain knowledge and gives us a more detailed
picture of the energy landscape in Puerto Rico:</p>
<ul><li>Lots of oil</li>
<li>Solar is surprisingly common</li>
<li>Wind and hydro less so</li>
<li>Very few coal entries. Is this expected? Not sure.</li>
</ul><p>– but keep in mind, this is going purely by the number of EIA-923
entries, and not by the actual fuel mix of the grid. We’ll make a note
of the two surprises – lots of solar and little coal – in our notebook,
in case we want to come back to it later.</p>
<pre class="text"><code>Energy source code frequency table:
    energy_source_code
    DFO    188
    SUN     99
    NG      49
    RFO     49
    MWH     24
    WND     17
    WAT     15
    BIT      9
    Name: count, dtype: int64
Why so much solar?
Why so little coal?</code></pre>
<div id="challenge3" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p>Your turn: Examine the <code>.describe()</code> output for the other
category columns. Use the File Layout documentation and
<code>.value_counts()</code> to verify whether the
<code>reporting_frequency_code</code> and <code>fuel_unit</code> columns
make sense or not.</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a>pr_gen_fuel_annual.reporting_frequency_code.describe()</span></code></pre>
</div>
<p><code>reporting_frequency_code</code> looks good; the File Layout
documentation says there are three options, and we see three unique
values here. There are some nulls though. Something to keep an eye on if
we end up needing this column for something later.</p>
<p>Let’s make a note of what we found:</p>
<pre class="text"><code>- reporting_frequency_code has a bunch of nulls; will this matter? ~100/450</code></pre>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a>pr_gen_fuel_annual.fuel_unit.describe()</span></code></pre>
</div>
<p><code>fuel_unit</code> looks off, since File Layout says there should
be three values but <code>.describe()</code> found four. Let’s look
closer:</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a><span class="co"># 4. why are there 4 fuel units when the docs say there should only be three?</span></span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a>pr_gen_fuel_annual.fuel_unit.value_counts()</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>fuel_unit
barrels          237
mcf               49
megawatthours     24
short tons         9
Name: count, dtype: Int64</code></pre>
</div>
<p>Huh. <code>megawatthours</code> is not a valid physical unit,
according to the documentation… but it’s definitely not a typo. How is
this being used in the data?</p>
<p>We can filter for just the rows that use <code>megawatthours</code>
in the <code>fuel_unit</code> column:</p>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a>pr_gen_fuel_annual.loc[pr_gen_fuel_annual.fuel_unit <span class="op">==</span> <span class="st">"megawatthours"</span>, category_columns].describe()</span></code></pre>
</div>
<p>We can eyeball the whole dataframe looking for patterns, or we can
use <code>.describe()</code> to help us know for sure whether each
column has multiple values or only one.</p>
<ul><li>
<code>energy_source_code</code> is MWH, which intuitively matches
the unit but isn’t particularly illuminating</li>
<li>
<code>fuel_type_code_agg</code> is OTH, probably for “Other”; no
help there</li>
<li>
<code>prime_mover_code</code> is BA, which is worth looking up.
“Energy Storage, Battery” – looks like at least some of the PR
respondents report generation from batteries using a fuel unit, which
isn’t expected by the EIA, but they’re consistent about it, which is
nice.</li>
</ul><p>Better write that down too:</p>
<pre class="text"><code>- fuel_unit includes "megawatthours" for BA (=battery) prime movers</code></pre>
</div>
</div>
</div>
</div>
<p>We’ve split off 7 of the 24 columns using the “split by data type”
strategy to look at category data. Using this approach, we found some
null values we’ll need to handle carefully if we need those columns for
our research, and we found one off-spec-but-ultimately-reasonable rogue
value for <code>fuel_unit</code> that could have tripped us up if we
were relying on the documentation alone.</p>
</div>
<div class="section level3">
<h3 id="numeric-data">Numeric data<a class="anchor" aria-label="anchor" href="#numeric-data"></a></h3>
<p>But we’re here for <em>visual</em> data exploration! Let’s look at
some data we can plot.</p>
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a>pr_gen_fuel_annual.dtypes</span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a>pr_gen_fuel_annual.drop(columns<span class="op">=</span>category_columns).dtypes</span></code></pre>
</div>
<p>While the categorical data was pretty much limited to one dtype, the
numeric data is divided up between <code>float64</code> and
<code>Int64</code>. The columns with <code>float64</code> dtype, like
<code>elec_fuel_consumption_mmbtu</code>, can contain decimal fractions,
while the columns with <code>Int64</code> dtype, like
<code>report_year</code>, contain only whole numbers. Some datasets may
use integers to store whole-number measurements such as counts. In this
dataset, all of the measurements are continuous. If we want to plot
measurement data, we want to look at the float columns.</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a><span class="co"># 1. carve off a chunk: float columns for measurement data</span></span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a>measurement_columns <span class="op">=</span> <span class="bu">list</span>(</span>
<span id="cb33-3"><a href="#cb33-3" tabindex="-1"></a>    pr_gen_fuel_annual.dtypes[</span>
<span id="cb33-4"><a href="#cb33-4" tabindex="-1"></a>        (pr_gen_fuel_annual.dtypes <span class="op">==</span> <span class="st">"float64"</span>)</span>
<span id="cb33-5"><a href="#cb33-5" tabindex="-1"></a>    ].index</span>
<span id="cb33-6"><a href="#cb33-6" tabindex="-1"></a>)</span>
<span id="cb33-7"><a href="#cb33-7" tabindex="-1"></a>measurement_columns</span></code></pre>
</div>
<p>When we were looking at categorical string data, we used
<code>.describe()</code> to show a summary that helped us determine
whether the data was reasonable or not. We can use
<code>.describe()</code> on numeric data, too!</p>
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a>pr_gen_fuel_annual[measurement_columns].describe()</span></code></pre>
</div>
<p>For numeric data, <code>.describe()</code> gives us statistics for
each column.</p>
<ul><li>
<code>count</code> is the same as with string data: it shows us how
many rows have a value set. For all of these numeric columns, it is
equal to the total number of rows, so we know we have no nulls.</li>
<li>
<code>mean</code> is the average. If one of these showed a wildly
unexpected scale, or large negative, we would know something was weird,
but these all look plausible.</li>
<li>
<code>std</code> is the standard deviation, which tells you how
spread out the values are in each column.</li>
<li>
<code>min</code>, <code>25%</code> <code>50%</code> <code>75%</code>
(quartiles), <code>max</code> give a rough idea of how the data are
distributed. We have some negatives in
<code>total_net_generation_mwh</code>, but negatives do show up
sometimes in netgen, and negative 3,000 on a maximum of 3,000,000 is
reasonable.</li>
</ul><div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a><span class="co"># what do we expect?</span></span>
<span id="cb35-2"><a href="#cb35-2" tabindex="-1"></a><span class="co"># - count: no/few nulls</span></span>
<span id="cb35-3"><a href="#cb35-3" tabindex="-1"></a><span class="co"># - mean&amp;std: plausible scale; plausible sign</span></span>
<span id="cb35-4"><a href="#cb35-4" tabindex="-1"></a><span class="co"># - quartiles: plausible scale; plausible sign</span></span></code></pre>
</div>
<p>This is where we can start looking at the relationship between
columns to see if problems are hiding there.</p>
<p>We’ve got two pairs of mmbtu+quantity variables. Since they’re
measuring in different units, we don’t expect their values to match, but
we do kinda expect them to have the same shape. But it looks like the
<code>_quantity</code> variables have a lot more zeros in them. Let’s
look closer with a histogram:</p>
<div class="codewrapper sourceCode" id="cb36">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a><span class="co"># what did we find? quantity has more zeros than mmbtus. why?</span></span>
<span id="cb36-2"><a href="#cb36-2" tabindex="-1"></a>elec_fuel_consumption_cols <span class="op">=</span> [<span class="st">"elec_fuel_consumption_mmbtu"</span>,<span class="st">"electric_fuel_consumption_quantity"</span>]</span>
<span id="cb36-3"><a href="#cb36-3" tabindex="-1"></a>elec_fuel_consumption <span class="op">=</span> pr_gen_fuel_annual[elec_fuel_consumption_cols]</span>
<span id="cb36-4"><a href="#cb36-4" tabindex="-1"></a>elec_fuel_consumption.hist()</span></code></pre>
</div>
<p>The first thing it prints out is this array of Axes. There is one for
each column we plotted. We’ll talk more about Axes in a little bit.</p>
<p>The next thing is shows is the histogram. There are a few things
preventing this graph from telling us what we want to know. A histogram
has the value on the x axis and the frequency of that value / range of
values on the y axis. These two plots have different y axes, which makes
it difficult to see that the zero bin has a different frequency for
mmbtus on the left than for quantity on the right. We can fix that with
<code>sharey</code>.</p>
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a>elec_fuel_consumption_cols <span class="op">=</span> [<span class="st">"elec_fuel_consumption_mmbtu"</span>,<span class="st">"electric_fuel_consumption_quantity"</span>]</span>
<span id="cb37-2"><a href="#cb37-2" tabindex="-1"></a>elec_fuel_consumption <span class="op">=</span> pr_gen_fuel_annual[elec_fuel_consumption_cols]</span>
<span id="cb37-3"><a href="#cb37-3" tabindex="-1"></a>elec_fuel_consumption.hist(sharey<span class="op">=</span><span class="va">True</span>)</span></code></pre>
</div>
<p>Now we can see that zeros are much more common on the right. Next
let’s make use of this empty space to the right of the plot. The default
plot width is quite narrow. To widen it, we will use the following
incantation:</p>
<div class="codewrapper sourceCode" id="cb38">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb38-2"><a href="#cb38-2" tabindex="-1"></a>plt.rcParams[<span class="st">'figure.figsize'</span>] <span class="op">=</span> [<span class="dv">10</span>, <span class="dv">4</span>]</span></code></pre>
</div>
<p>This sets the default figure size to 10 inches wide and 4 inches
tall. You can put in whatever size makes sense for your monitor. This
works because pandas uses matplotlib under the hood to make its plots.
When we change the settings for matplotlib, it affects pandas’
plotting.</p>
<p>Back to our question: why does <code>_quantity</code> have so many
more zeros than <code>_mmbtu</code>?</p>
<p>The easiest explanation would be if one of our categorical variables
could identify a group that behaved wildly differently in
<code>_quantity</code> than it did in <code>_mmbtu</code>.</p>
<p>Let’s check one categorical variable together.</p>
<p>We can use a for loop to plot each group from
<code>data_maturity</code>:</p>
<div class="codewrapper sourceCode" id="cb39">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" tabindex="-1"></a><span class="co"># why does quantity have more zeros than mmbtu?</span></span>
<span id="cb39-2"><a href="#cb39-2" tabindex="-1"></a><span class="cf">for</span> gr, df <span class="kw">in</span> pr_gen_fuel_annual.groupby(<span class="st">"data_maturity"</span>):</span>
<span id="cb39-3"><a href="#cb39-3" tabindex="-1"></a>    axs <span class="op">=</span> df.hist(column<span class="op">=</span>elec_fuel_consumption_cols, sharey<span class="op">=</span><span class="va">True</span>)</span></code></pre>
</div>
<p>That gave us one row for each value of <code>data_maturity</code>,
but it hasn’t told us which value goes with which row. That’s confusing.
Let’s add some labels using the <code>legend()</code> function:</p>
<div class="codewrapper sourceCode" id="cb40">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" tabindex="-1"></a><span class="cf">for</span> gr, df <span class="kw">in</span> pr_gen_fuel_annual.groupby(<span class="st">"data_maturity"</span>):</span>
<span id="cb40-2"><a href="#cb40-2" tabindex="-1"></a>    axs <span class="op">=</span> df.hist(column<span class="op">=</span>elec_fuel_consumption_cols, sharey<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb40-3"><a href="#cb40-3" tabindex="-1"></a>    axs[<span class="op">-</span><span class="dv">1</span>][<span class="op">-</span><span class="dv">1</span>].legend([<span class="ss">f"data_maturity: </span><span class="sc">{</span>gr<span class="sc">}</span><span class="ss">"</span>])</span></code></pre>
</div>
<p>Okay, so the first row is for <code>data_maturity</code> final and
the second row is for <code>data_maturity</code> incremental-ytd. These
show some slight differences, particularly for the incremental-ytd
group, but nothing overwhelmingly convincing. Ideally we would want to
see a group that had some nonzero bins for <code>mmbtu</code>, but only
the zero bin for <code>quantity</code>. We can mark
<code>data_maturity</code> as a “maybe” for helping explain our
question.</p>
<p>Let’s take a moment and review the process we just used for
exploratory data visualization:</p>
<p>First, we decided we wanted to see a histogram comparing quantity and
mmbtus split out by each category in the <code>data_maturity</code>
column.</p>
<p>Next, we wrote code to get pandas/matplotlib to show it to us.</p>
<p>In our first try, it was too hard to tell which set of histograms
went with which category. So, we added some code to label each pair of
histograms. They’re not pretty labels, but they were enough to clarify
what we were looking at.</p>
<p>Finally, we evaluated the plots and determined that
<code>data_maturity</code> doesn’t explain why quantity has more zeros
than mmbtus.</p>
<div id="challenge4" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p>Now it’s your turn. Find a categorical column that seems to explain
why there are so many more zeros in <code>quantity</code> than in
<code>mmbtu</code>.</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4"> Show me the solution </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" data-bs-parent="#accordionSolution4" aria-labelledby="headingSolution4">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb41">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" tabindex="-1"></a><span class="cf">for</span> gr, df <span class="kw">in</span> pr_gen_fuel_annual.groupby(<span class="st">"energy_source_code"</span>):</span>
<span id="cb41-2"><a href="#cb41-2" tabindex="-1"></a>    axs <span class="op">=</span> df.hist(column<span class="op">=</span>elec_fuel_consumption_cols, sharey<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb41-3"><a href="#cb41-3" tabindex="-1"></a>    axs[<span class="op">-</span><span class="dv">1</span>][<span class="op">-</span><span class="dv">1</span>].legend([gr])</span></code></pre>
</div>
<ul><li>SUN, WAT, and WND <em>always</em> have zero <code>quantity</code>.
You can kinda guess from the codes themselves, or look them up in the
File Layout documentation (“Reported Fuel Type Code”), but these are the
energy source codes for solar (SUN), hydro (WAT), and wind (WND) power.
Which kinda makes sense, if we’re trying to measure a “quantity of fuel
consumed”. How many units of sun did we burn today at the power plant?
How about wind? … water? It doesn’t explain why <code>mmbtu</code> for
renewables is nonzero, but it’s something!</li>
<li>Bonus confidence: the other energy source codes have
<em>excellent</em> matching between <code>quantity</code> and
<code>mmbtu</code>.</li>
<li>Bonus puzzle: MWH always has zero <code>mmbtu</code>! How odd.</li>
</ul><p>Honorable mentions:</p>
<ul><li>
<code>prime_mover</code> shows moderate differences for BA, CT, and
ST as well as the overwhelming differences for HY, PV, and WT. If you’re
a little more endowed with domain knowledge (or handy with the File
Layout documentation, “Reported Primer[sic] Mover”) you may notice that
these are the prime mover codes for hydro (HY), photovoltaic (PV), and
wind turbines (WT), which line up exactly with the WAT, SUN, and WND
energy source codes. The only reason this wasn’t my top choice for the
solution is because this dataset covers 8 energy source codes and 9
prime mover codes.</li>
<li>
<code>fuel_unit</code> shows suspicious differences for
megawatthours, though it’s in the opposite direction</li>
<li>
<code>reporting_frequency_code</code> shows suspicious differences
for AM, but that only covers ~10 respondents, and our discrepancy is
more like 50.</li>
</ul><p>Alternate approach: use boxplots</p>
<div class="codewrapper sourceCode" id="cb42">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" tabindex="-1"></a>axs<span class="op">=</span>pr_gen_fuel_annual.groupby(<span class="st">"energy_source_code"</span>)[elec_fuel_consumption_cols].plot.box(</span>
<span id="cb42-2"><a href="#cb42-2" tabindex="-1"></a>    label<span class="op">=</span><span class="st">"energy_source_code"</span>)</span>
<span id="cb42-3"><a href="#cb42-3" tabindex="-1"></a><span class="cf">for</span> i, ax <span class="kw">in</span> <span class="bu">zip</span>(axs.index, axs.values):</span>
<span id="cb42-4"><a href="#cb42-4" tabindex="-1"></a>    ax.legend([i])</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p>So now we know to stick to mmbtus if we want to capture renewables.
That’s definitely something to write down for future-us:</p>
<pre class="text"><code>- fuel consumption columns
  _ *_quantity is always zero for renewables (SUN, WAT, &amp; WND energy source codes) -- use *_mmbtu instead
  - *_mmbtu is always zero for MWH energy source code -- use *_quantity instead? :(</code></pre>
<p>Splitting off the numerical measurement data got us through another 5
columns. Using this approach, we found out that renewables are handled
oddly in the <code>fuel_consumption</code> columns: For solar, wind, and
hydro, all the useful data are in <code>_mmbtu</code>, and for battery
storage, they’re all in <code>_quantity</code>. If our research relies
on fuel consumption figures, we’ll need to either exclude renewables
from our analyses, or treat them separately.</p>
<p>The remaining 9 columns are:</p>
<ul><li>1 boolean column (honorary categorical)</li>
<li>3 object columns (all nulls)</li>
<li>3 Int64 columns (all identifiers)</li>
<li>2 string columns (all names) (you can analyse these the same way as
categoricals, using <code>.describe()</code> and
<code>.value_counts()</code>)</li>
</ul><p>We got through a 24-column table of annual data from EIA 923 in
Puerto Rico, and we know something about the primary key columns,
category columns, and numeric measurement columns. That’s a significant
step in getting familiar with this dataset!</p>
</div>
</div>
<div class="section level2">
<h2 id="little-break">Little break!<a class="anchor" aria-label="anchor" href="#little-break"></a></h2>
</div>
<div class="section level2">
<h2 id="monthly-data">Monthly data<a class="anchor" aria-label="anchor" href="#monthly-data"></a></h2>
<p>Now let’s look at the monthly data.</p>
<div class="codewrapper sourceCode" id="cb44">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" tabindex="-1"></a>pr_gen_fuel_monthly <span class="op">=</span> pd.read_parquet(monthly_file)</span>
<span id="cb44-2"><a href="#cb44-2" tabindex="-1"></a>pr_gen_fuel_monthly</span>
<span id="cb44-3"><a href="#cb44-3" tabindex="-1"></a>pr_gen_fuel_monthly.dtypes</span></code></pre>
</div>
<p>We have some familiar friends:</p>
<ul><li>Plant ID &amp; plant name</li>
<li>Prime mover code</li>
<li>Energy source code</li>
<li>Fuel unit</li>
</ul><p>We have a new <code>date</code> column with dtype
<code>datetime64</code>. What’s that about?</p>
<div class="codewrapper sourceCode" id="cb45">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" tabindex="-1"></a>pr_gen_fuel_monthly.date</span></code></pre>
</div>
<p>Looks suspiciously like the first of the month. Is it always like
that? We can verify using <code>.value_counts()</code>.</p>
<div class="codewrapper sourceCode" id="cb46">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" tabindex="-1"></a>pr_gen_fuel_monthly.date.value_counts().sort_index()</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>date
2017-01-01    35
2017-02-01    35
2017-03-01    35
2017-04-01    35
2017-05-01    35
              ..
2024-10-01    33
2024-11-01    33
2024-12-01    33
2025-01-01    33
2025-02-01    33
Name: count, Length: 98, dtype: int64</code></pre>
</div>
<p>Most of the remaining variables are time series. Time series data
lends itself to plotting especially well.</p>
<p>Most people are familiar with putting plots in reports, research
papers, and presentation slides, where they’re useful as evidence
supporting your argument. To be effective, those plots need to –
essentially – look nice: clear labels and titles, appropriate units and
limits, good color separation for print or screen, tidy legends,
minimizing extraneous data. The goal is to communicate your point.</p>
<p>When you’re in the exploratory phase, you don’t know what the point
is yet, and you’re communicating with yourself, now and future-you. To
be effective, exploratory plots need to tell you something you don’t
already know, and ideally they should do that quickly, so you don’t lose
track of what you’re doing. We can skip a lot of the presentation
refinements, so long as a plot is not <em>actively confusing</em>.</p>
<p>Pandas has great support for exploratory plotting, since it doesn’t
require much extra setup, and the options for presentation refinements
are extremely limited, reducing the risk of going down pixel-perfection
rabbit holes.</p>
<p>In the last section, we started to establish a rhythm for exploratory
data visualization. Let’s review that. The steps are:</p>
<ol style="list-style-type: decimal"><li>Decide what we want to see</li>
<li>Get pandas/matplotlib to show it to us</li>
<li>If what we want to see is too hard to see, refine the plot</li>
<li>Make a note of anything surprising or weird for followup</li>
</ol><div class="section level3">
<h3 id="plot-all-monthly-variables">Plot all monthly variables<a class="anchor" aria-label="anchor" href="#plot-all-monthly-variables"></a></h3>
<p>Let’s look at all the monthly variables at once.</p>
<p>What do we want to see?</p>
<ul><li>a different line for each variable: fuel consumed for electricity
mmbtu &amp; units, fuel consumed mmbtu &amp; units, and net
generation</li>
<li>one value for each month – we’ll sum across all the plants</li>
</ul><p>Now let’s get pandas to show it to us.</p>
<p>The primary key or index columns for this data frame are the month
(“date”), plant id, plant name, prime mover, and energy source code.
We’ll throw fuel unit in there too.</p>
<div class="codewrapper sourceCode" id="cb48">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" tabindex="-1"></a>monthly_index_columns <span class="op">=</span> [</span>
<span id="cb48-2"><a href="#cb48-2" tabindex="-1"></a>    <span class="st">"date"</span>,</span>
<span id="cb48-3"><a href="#cb48-3" tabindex="-1"></a>    <span class="st">"plant_id_eia"</span>,</span>
<span id="cb48-4"><a href="#cb48-4" tabindex="-1"></a>    <span class="st">"plant_name_eia"</span>,</span>
<span id="cb48-5"><a href="#cb48-5" tabindex="-1"></a>    <span class="st">"prime_mover_code"</span>,</span>
<span id="cb48-6"><a href="#cb48-6" tabindex="-1"></a>    <span class="st">"energy_source_code"</span>,</span>
<span id="cb48-7"><a href="#cb48-7" tabindex="-1"></a>    <span class="st">"fuel_unit"</span>,</span>
<span id="cb48-8"><a href="#cb48-8" tabindex="-1"></a>]</span></code></pre>
</div>
<p>We want one value for each month, so we’ll group by date and then
sum.</p>
<pre><code>pr_gen_fuel_monthly.groupby("date").sum()</code></pre>
<p>When we sum on some of the index columns, we make a huge mess! How do
we get it to … not do that? If we move the index columns to the actual
index, then pandas won’t sum them.</p>
<div class="codewrapper sourceCode" id="cb50">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" tabindex="-1"></a>pr_gen_fuel_monthly.set_index(monthly_index_columns).groupby(<span class="st">"date"</span>).<span class="bu">sum</span>()</span></code></pre>
</div>
<p>Much better. Now plot!</p>
<div class="codewrapper sourceCode" id="cb51">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" tabindex="-1"></a>pr_gen_fuel_monthly.set_index(monthly_index_columns).groupby(<span class="st">"date"</span>).<span class="bu">sum</span>().plot()</span></code></pre>
</div>
<p>Check: can we see a different line for each variable, and one value
per month? Yes.</p>
<p>Things to notice:</p>
<ul><li>Big zero spike in late 2017, all variables</li>
<li>Repeating pattern of annual variation that peaks in the summer,
mostly</li>
<li>Variables are on vastly different scales but pandas did its best and
it’s okay</li>
</ul></div>
<div class="section level3">
<h3 id="compare-energy-source-breakdown-over-time">Compare energy source breakdown over time<a class="anchor" aria-label="anchor" href="#compare-energy-source-breakdown-over-time"></a></h3>
<p>Let’s dive in further. What does the energy source breakdown look
like over time?</p>
<p>Restart the cycle again. What do we want to see?</p>
<ul><li>a different line for each energy source: DFO, SUN, NG, etc</li>
<li>just fuel consumed mmbtus; we’ll lose battery storage but get to see
solar, hydro, and wind</li>
<li>one value for each month – we’ll sum across all the plants</li>
</ul><p>Now let’s get pandas to show it to us. To get <code>.plot()</code> to
show the lines we want, we’ll need to make one column for each energy
source, where each row is the sum for one month.</p>
<div class="codewrapper sourceCode" id="cb52">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" tabindex="-1"></a>(</span>
<span id="cb52-2"><a href="#cb52-2" tabindex="-1"></a>    pr_gen_fuel_monthly</span>
<span id="cb52-3"><a href="#cb52-3" tabindex="-1"></a>    .groupby([<span class="st">"energy_source_code"</span>, <span class="st">"date"</span>], observed<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb52-4"><a href="#cb52-4" tabindex="-1"></a>    .fuel_consumed_mmbtu.<span class="bu">sum</span>()</span>
<span id="cb52-5"><a href="#cb52-5" tabindex="-1"></a>    .unstack(<span class="st">"energy_source_code"</span>).plot()</span>
<span id="cb52-6"><a href="#cb52-6" tabindex="-1"></a>)</span></code></pre>
</div>
<p>Check: does this show us the lines we want? Yes, though it’s pretty
busy. We may need to split it up to see some elements more clearly.</p>
<div id="challenge5" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p>What do you notice?</p>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5"> Show me the solution </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" data-bs-parent="#accordionSolution5" aria-labelledby="headingSolution5">
<div class="accordion-body">
<ul><li>Zero spike in 2017 visible in all energy sources but recovery
severely delayed for BIT and renewables</li>
<li>NG another big drop in late 2019/early 2020; again in late 2021.
Independent of other energy sources though.</li>
<li>RFO also seems to vary quite a lot; also not related to other energy
sources.</li>
<li>Renewables way smaller than others</li>
<li>Renewables all drop starting in 2022</li>
</ul></div>
</div>
</div>
</div>
<p>That drop in 2022 looks pretty serious. Depending on the cause, it
could definitely affect any research we’d do with this data. We should
investigate further.</p>
</div>
<div class="section level3">
<h3 id="focus-on-renewables">Focus on renewables<a class="anchor" aria-label="anchor" href="#focus-on-renewables"></a></h3>
<p>This is an appropriate time for refinement: the current graph
settings aren’t giving us enough detail on the renewable energy
sources.</p>
<p>Let’s put the renewables on their own plot so we can see them
better.</p>
<div class="codewrapper sourceCode" id="cb53">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" tabindex="-1"></a>renewables <span class="op">=</span> [<span class="st">"SUN"</span>, <span class="st">"WND"</span>, <span class="st">"WAT"</span>]</span>
<span id="cb53-2"><a href="#cb53-2" tabindex="-1"></a>(</span>
<span id="cb53-3"><a href="#cb53-3" tabindex="-1"></a>    pr_gen_fuel_monthly</span>
<span id="cb53-4"><a href="#cb53-4" tabindex="-1"></a>    .loc[pr_gen_fuel_monthly.energy_source_code.isin(renewables)]</span>
<span id="cb53-5"><a href="#cb53-5" tabindex="-1"></a>    .groupby([<span class="st">"energy_source_code"</span>, <span class="st">"date"</span>], observed<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb53-6"><a href="#cb53-6" tabindex="-1"></a>    .fuel_consumed_mmbtu.<span class="bu">sum</span>()</span>
<span id="cb53-7"><a href="#cb53-7" tabindex="-1"></a>    .unstack(<span class="st">"energy_source_code"</span>).plot()</span>
<span id="cb53-8"><a href="#cb53-8" tabindex="-1"></a>)</span></code></pre>
</div>
<p>Okay, yes, that is dramatic. We can also see that hydro spends a lot
of time offline. Sufficiently so that we can’t really see if it’s
affected by whatever has happened in 2022.</p>
<p>Does this 2022 event show up in the net generation as well?</p>
<div id="challenge6" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p>Adapt our current fuel_consumed_mmbtu plot to show net_generation
instead.</p>
</div>
</div>
</div>
<div id="accordionSolution6" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution6" aria-expanded="false" aria-controls="collapseSolution6">
  <h4 class="accordion-header" id="headingSolution6"> Show me the solution </h4>
</button>
<div id="collapseSolution6" class="accordion-collapse collapse" data-bs-parent="#accordionSolution6" aria-labelledby="headingSolution6">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb54">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" tabindex="-1"></a>(</span>
<span id="cb54-2"><a href="#cb54-2" tabindex="-1"></a>    pr_gen_fuel_monthly</span>
<span id="cb54-3"><a href="#cb54-3" tabindex="-1"></a>    .loc[pr_gen_fuel_monthly.energy_source_code.isin(renewables)]</span>
<span id="cb54-4"><a href="#cb54-4" tabindex="-1"></a>    .groupby([<span class="st">"energy_source_code"</span>, <span class="st">"date"</span>], observed<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb54-5"><a href="#cb54-5" tabindex="-1"></a>    .net_generation_mwh.<span class="bu">sum</span>()</span>
<span id="cb54-6"><a href="#cb54-6" tabindex="-1"></a>    .unstack(<span class="st">"energy_source_code"</span>).plot()</span>
<span id="cb54-7"><a href="#cb54-7" tabindex="-1"></a>)</span></code></pre>
</div>
<p>No, not really :(</p>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="try-a-scatter-plot">Try a scatter plot<a class="anchor" aria-label="anchor" href="#try-a-scatter-plot"></a></h3>
<p>Okay, what else could it be? Maybe a big renewables plant opened or
closed that did things differently than the others? Let’s look for
patterns or clusters in the relationship between net generation and fuel
consumed mmbtus for renewables.</p>
<p>What do we want to see?</p>
<ul><li>a scatter plot with one point for each row</li>
<li>net generation on the x axis</li>
<li>fuel consumed on the y axis</li>
</ul><p>Now let’s get pandas to show it to us.</p>
<div class="codewrapper sourceCode" id="cb55">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" tabindex="-1"></a>renewables_monthly <span class="op">=</span> pr_gen_fuel_monthly.loc[pr_gen_fuel_monthly.energy_source_code.isin(renewables)]</span>
<span id="cb55-2"><a href="#cb55-2" tabindex="-1"></a>(</span>
<span id="cb55-3"><a href="#cb55-3" tabindex="-1"></a>    renewables_monthly.plot</span>
<span id="cb55-4"><a href="#cb55-4" tabindex="-1"></a>    .scatter(x<span class="op">=</span><span class="st">"net_generation_mwh"</span>, y<span class="op">=</span><span class="st">"fuel_consumed_mmbtu"</span>)</span>
<span id="cb55-5"><a href="#cb55-5" tabindex="-1"></a>)</span></code></pre>
</div>
<p>Check: does this show us a scatter plot with netgen on the x and fuel
consumed on the y? Yes, and we can even see there are at least two
distinct patterns. It’s pretty blobular though, and that makes it tough
to see whether there are only two or if more are hiding here in this top
one. This is an appropriate time for refinement: the current graph
settings aren’t giving us all the information we want.</p>
<p>We can reduce the size of each point to see if that gives us clearer
separation.</p>
<div class="codewrapper sourceCode" id="cb56">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" tabindex="-1"></a>(</span>
<span id="cb56-2"><a href="#cb56-2" tabindex="-1"></a>    renewables_monthly.plot</span>
<span id="cb56-3"><a href="#cb56-3" tabindex="-1"></a>    .scatter(x<span class="op">=</span><span class="st">"net_generation_mwh"</span>, y<span class="op">=</span><span class="st">"fuel_consumed_mmbtu"</span>, s<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb56-4"><a href="#cb56-4" tabindex="-1"></a>)</span></code></pre>
</div>
<p>Is that three lines? Three lines for three energy sources? Awfully
suspicious.</p>
<p>This is another appropriate time for refinement: we can add color to
show whether each line is for a different energy source.</p>
<div class="codewrapper sourceCode" id="cb57">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" tabindex="-1"></a>(</span>
<span id="cb57-2"><a href="#cb57-2" tabindex="-1"></a>    renewables_monthly.plot</span>
<span id="cb57-3"><a href="#cb57-3" tabindex="-1"></a>    .scatter(x<span class="op">=</span><span class="st">"net_generation_mwh"</span>, y<span class="op">=</span><span class="st">"fuel_consumed_mmbtu"</span>, s<span class="op">=</span><span class="fl">0.1</span>, c<span class="op">=</span><span class="st">"energy_source_code"</span>)</span>
<span id="cb57-4"><a href="#cb57-4" tabindex="-1"></a>)</span></code></pre>
</div>
<p>oh gee thanks pandas, the default colormap is grayscale. That’s not
helping at all.</p>
<div class="codewrapper sourceCode" id="cb58">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" tabindex="-1"></a>(</span>
<span id="cb58-2"><a href="#cb58-2" tabindex="-1"></a>    renewables_monthly.plot</span>
<span id="cb58-3"><a href="#cb58-3" tabindex="-1"></a>    .scatter(x<span class="op">=</span><span class="st">"net_generation_mwh"</span>, y<span class="op">=</span><span class="st">"fuel_consumed_mmbtu"</span>, s<span class="op">=</span><span class="fl">0.1</span>, c<span class="op">=</span><span class="st">"energy_source_code"</span>, colormap<span class="op">=</span><span class="st">"rainbow"</span>)</span>
<span id="cb58-4"><a href="#cb58-4" tabindex="-1"></a>)</span></code></pre>
</div>
<p>Oh do not like that. Instead of each line a different color, there
are colors for all three energy sources on all the lines. So energy
source code does not explain what’s going on here.</p>
<div id="challenge7" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p>Are there any other variables in our data that, when used to color
this plot, clearly separate the lines by color?</p>
</div>
</div>
</div>
<div id="accordionSolution7" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution7" aria-expanded="false" aria-controls="collapseSolution7">
  <h4 class="accordion-header" id="headingSolution7"> Show me the solution </h4>
</button>
<div id="collapseSolution7" class="accordion-collapse collapse" data-bs-parent="#accordionSolution7" aria-labelledby="headingSolution7">
<div class="accordion-body">
<p>Disappointingly, <code>date</code> is the only one that really does
it:</p>
<div class="codewrapper sourceCode" id="cb59">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" tabindex="-1"></a>(</span>
<span id="cb59-2"><a href="#cb59-2" tabindex="-1"></a>    renewables_monthly</span>
<span id="cb59-3"><a href="#cb59-3" tabindex="-1"></a>    .plot.scatter(x<span class="op">=</span><span class="st">"net_generation_mwh"</span>, y<span class="op">=</span><span class="st">"fuel_consumed_mmbtu"</span>, s<span class="op">=</span><span class="fl">0.2</span>, c<span class="op">=</span><span class="st">"date"</span>, colormap<span class="op">=</span><span class="st">"rainbow"</span>)</span>
<span id="cb59-4"><a href="#cb59-4" tabindex="-1"></a>)</span></code></pre>
</div>
<p>But at least it clearly identifies three lines. This feels like a
policy change effect – a coordinated change throughout Puerto Rico in
how fuel consumption is reported for renewables (which as we know from
the annual data, is already pretty weird).</p>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="try-plotting-the-heat-rate">Try plotting the heat rate<a class="anchor" aria-label="anchor" href="#try-plotting-the-heat-rate"></a></h3>
<p>We’ve probably extracted all the information we can out of this
scatter plot. Sometimes viewing the same data from another angle can
reveal further insights. Let’s try that now: What are the slopes of
these lines?</p>
<p>Fuel consumed per MWH generated is the heat rate, and we can compute
that directly:</p>
<div class="codewrapper sourceCode" id="cb60">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" tabindex="-1"></a>(</span>
<span id="cb60-2"><a href="#cb60-2" tabindex="-1"></a>    renewables_monthly</span>
<span id="cb60-3"><a href="#cb60-3" tabindex="-1"></a>    .assign(heat_rate<span class="op">=</span>renewables_monthly.fuel_consumed_mmbtu<span class="op">/</span>renewables_monthly.net_generation_mwh)</span>
<span id="cb60-4"><a href="#cb60-4" tabindex="-1"></a>    .plot.scatter(x<span class="op">=</span><span class="st">"date"</span>, y<span class="op">=</span><span class="st">"heat_rate"</span>, s<span class="op">=</span><span class="fl">0.5</span>, c<span class="op">=</span><span class="st">"date"</span>, colormap<span class="op">=</span><span class="st">"rainbow"</span>)</span>
<span id="cb60-5"><a href="#cb60-5" tabindex="-1"></a>)</span></code></pre>
</div>
<p>Oh hey, more subtle than we thought. It looks like whatever constant
everyone was using to compute fuel consumption changed a little bit each
year, with a big gap for Maria, and then suddenly decided once and for
all in 2022.</p>
<div id="callout1" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div class="callout-inner">
<div class="callout-content">
<p>This was a real policy change, and it affected more than Puerto
Rico!</p>
<p>Starting in 2023 (in which reports on 2022 data were published), the
EIA changed how it assesses noncombustible renewable energy
contributions. The old way used a fossil fuel equivalency approach and
was adjusted each year using an average heat rate; the new way uses a
captured energy approach and uses a constant heat conversion factor.</p>
<p>For more information, see this <a href="https://www.cleanenergytransition.org/post/understanding-how-the-eia-is-measuring-noncombustible-renewables?u" class="external-link">CleanEnergyTransition
explainer</a>.</p>
</div>
</div>
</div>
<p>The colormap made it easy to see how the different heatrate values
corresponded to our line chart from before, but it’s making these little
stragglers hard to see. Now that we have established some continuity
from the previous plot, we can drop the colormap and focus on the
stragglers.</p>
<div class="codewrapper sourceCode" id="cb61">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" tabindex="-1"></a>(</span>
<span id="cb61-2"><a href="#cb61-2" tabindex="-1"></a>    renewables_monthly</span>
<span id="cb61-3"><a href="#cb61-3" tabindex="-1"></a>    .assign(heat_rate<span class="op">=</span>renewables_monthly.fuel_consumed_mmbtu<span class="op">/</span>renewables_monthly.net_generation_mwh)</span>
<span id="cb61-4"><a href="#cb61-4" tabindex="-1"></a>    .plot.scatter(x<span class="op">=</span><span class="st">"date"</span>, y<span class="op">=</span><span class="st">"heat_rate"</span>, s<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb61-5"><a href="#cb61-5" tabindex="-1"></a>)</span></code></pre>
</div>
<p>Are those individual plants or some other effect?</p>
<div class="codewrapper sourceCode" id="cb62">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" tabindex="-1"></a>(</span>
<span id="cb62-2"><a href="#cb62-2" tabindex="-1"></a>    renewables_monthly</span>
<span id="cb62-3"><a href="#cb62-3" tabindex="-1"></a>    .assign(heat_rate<span class="op">=</span>renewables_monthly.fuel_consumed_mmbtu<span class="op">/</span>renewables_monthly.net_generation_mwh)</span>
<span id="cb62-4"><a href="#cb62-4" tabindex="-1"></a>    .assign(plant_factor<span class="op">=</span>renewables_monthly.plant_name_eia.astype(<span class="st">"category"</span>))</span>
<span id="cb62-5"><a href="#cb62-5" tabindex="-1"></a>    .plot.scatter(x<span class="op">=</span><span class="st">"date"</span>, y<span class="op">=</span><span class="st">"heat_rate"</span>, s<span class="op">=</span><span class="fl">0.5</span>, c<span class="op">=</span><span class="st">"plant_factor"</span>, colormap<span class="op">=</span><span class="st">"rainbow"</span>)</span>
<span id="cb62-6"><a href="#cb62-6" tabindex="-1"></a>)</span></code></pre>
</div>
<p>This colormap is a little too squished to tell us exactly which plant
is the troublemaker, but it does give us enough to suggest that it’s
only one or two plants. If we wanted to figure out exactly which ones,
we could split the data by year, use <code>.describe()</code> to get the
median ratio for each year, then select all the rows that had a
different ratio. We’ll leave that for future research!</p>
<p>In the meantime, let’s review: We were able to use timeseries plots
to identify a weird effect in the data, and then use two other
visualizations to narrow down the cause and extent of the weirdness. We
now know that any models that make use of fuel consumed or heat rate
will need to account for the changes in how renewables were handled in
pre- and post-2022 data. Any models that compare or rely on differences
in heat rates between plants will probably need to exclude renewables
entirely.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<span class="callout-header">Key Points</span>
<div class="callout-inner">
<div class="callout-content">
<ul><li>Different kinds of data – indexing, categorical, numeric, time
series – are suited to different kinds of summarization and
visualization.</li>
<li>Divide-and-conquer strategies that split data by type or by purpose
can help you get to know tables that have a lot of columns (common in
energy data).</li>
<li>Successful strategies for assessing data problems alternate between
noticing your expectations about the data and checking to see if the
data match your expectations – and sometimes, updating your expectations
based on what you find!</li>
<li>Visualization is not just for reports, papers, and talks! If you
incorporate plotting into your exploration &amp; troubleshooting toolbox
you’ll be able to identify and diagnose data problems much more quickly
than if you wait for your model to exhibit strange behavior.</li>
</ul></div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</div>
</div>
</div>



      </div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="scraping-data.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="assumptions.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="scraping-data.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Scraping Data
        </a>
        <a class="chapter-link float-end" href="assumptions.html" rel="next">
          Next: Making assumptions...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/catalyst-cooperative/open-energy-data-for-all/edit/main/episodes/visual-data-exploration.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/catalyst-cooperative/open-energy-data-for-all/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/catalyst-cooperative/open-energy-data-for-all/" class="external-link">Source</a></p>
				<p><a href="https://github.com/catalyst-cooperative/open-energy-data-for-all/blob/main/CITATION.cff" class="external-link">Cite</a> | <a href="mailto:hello@catalyst.coop">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.17.1" class="external-link">sandpaper (0.17.1)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.9" class="external-link">pegboard (0.7.9)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.7" class="external-link">varnish (1.0.7)</a></p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "LearningResource",
  "@id": "https://catalyst-cooperative.github.io/open-energy-data-for-all/visual-data-exploration.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/LearningResource/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, energy, PUDL, catalyst",
  "name": "Visual Data Exploration",
  "creativeWorkStatus": "active",
  "url": "https://catalyst-cooperative.github.io/open-energy-data-for-all/visual-data-exploration.html",
  "identifier": "https://catalyst-cooperative.github.io/open-energy-data-for-all/visual-data-exploration.html",
  "dateCreated": "2024-10-23",
  "dateModified": "2025-09-09",
  "datePublished": "2025-09-09"
}

  </script><script>
		feather.replace();
	</script></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

