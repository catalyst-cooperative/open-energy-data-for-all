<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Open Energy Data For All: Modularization</title><meta name="viewport" content="width=device-width, initial-scale=1"><script src="../assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="../assets/styles.css"><script src="../assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="../favicons/incubator/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicons/incubator/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="../favicons/incubator/favicon-16x16.png"><link rel="manifest" href="../favicons/incubator/site.webmanifest"><link rel="mask-icon" href="../favicons/incubator/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="black"></head><body>
    <header id="top" class="navbar navbar-expand-md top-nav incubator"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="incubator-logo" alt="Foundational data and software skills for energy data analysis." src="../assets/images/incubator-logo.svg"><span class="badge text-bg-danger">
          <abbr title="This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.">
            <a href="https://docs.carpentries.org/resources/curriculum/lesson-life-cycle.html" class="external-link alert-link">
              <i aria-hidden="true" class="icon" data-feather="alert-octagon" style="border-radius: 5px"></i>
              Pre-Alpha
            </a>
            <span class="visually-hidden">This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.</span>
          </abbr>
        </span>

      </div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text"><li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul></li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='../modularization.html';">Learner View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Foundational data and software skills for energy data analysis." src="../assets/images/incubator-logo-sm.svg"></div>
    <div class="lesson-title-md">
      Open Energy Data For All
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            Open Energy Data For All
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/instructor-notes.html">Instructor Notes</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/images.html">Extract All Images</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"><hr><li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul></li>
      </ul></div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="../instructor/aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Open Energy Data For All
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 75%" class="percentage">
    75%
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: 75%" aria-valuenow="75" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text"><li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul></li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="../modularization.html">Learner View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->

            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Schedule</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="introduction.html">1. Introduction</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="working-with-diverse-filetypes.html">2. Handling diverse filetypes in Pandas</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="accessing-remote-data.html">3. Accessing remote data</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="scraping-data.html">4. Scraping Data</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="coming-soon.html">5. More Topics Coming Soon</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapsecurrent" aria-expanded="true" aria-controls="flush-collapsecurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        6. Modularization
        </span>
      </button>
    </div><!--/div.accordion-header-->

    <div id="flush-collapsecurrent" class="accordion-collapse collapse show" aria-labelledby="flush-headingcurrent" data-bs-parent="#accordionFlushcurrent">
      <div class="accordion-body">
        <ul><li><a href="#a-plain-language-approach-to-code-reorganization">A plain language approach to code reorganization</a></li>
<li><a href="#a-plain-language-approach-to-function-design">A plain language approach to function design</a></li>
        </ul></div><!--/div.accordion-body-->
    </div><!--/div.accordion-collapse-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="../instructor/key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="../instructor/instructor-notes.html">Instructor Notes</a>
                      </li>
                      <li>
                        <a href="../instructor/images.html">Extract All Images</a>
                      </li>
                      <hr><li><a class="dropdown-item" href="reference.html">Reference</a></li>
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources"><a href="../instructor/aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">

            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="../instructor/coming-soon.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="../instructor/index.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="../instructor/coming-soon.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: More Topics Coming
        </a>
        <a class="chapter-link float-end" href="../instructor/index.html" rel="next">
          Home
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Modularization</h1>
        <p>Last updated on 2025-08-27 |

        <a href="https://github.com/catalyst-cooperative/open-energy-data-for-all/edit/main/episodes/modularization.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>



        <p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 30 minutes</p>

        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>How can I re-use code I’ve already written to address similar
problems?</li>
<li>How can I reduce duplication in my code?</li>
<li>How can I clearly communicate what my code is doing?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>Use a “plain language” strategy to help decide how best to design
your functions</li>
<li>Structure code to isolate discrete, inspectable steps</li>
<li>Design code modules for clarity and reuse</li>
</ul></div>
</div>
</div>
</div>
</div>
<p>As we explore our data, assert assumptions about it and transform it
to meet those assumptions, it’s easy to quickly write hundreds of lines
of code. Yet as our code grows, it can get increasingly repetitive,
confusing, and challenging to explain to others. In this lesson, we’ll
explore practical approaches to <strong>modularizing</strong> our code -
breaking it into smaller chunks we can reuse, test, and combine to
transform our data.</p>
<section><h2 class="section-heading" id="a-plain-language-approach-to-code-reorganization">A plain language approach to code reorganization<a class="anchor" aria-label="anchor" href="#a-plain-language-approach-to-code-reorganization"></a></h2>
<hr class="half-width"><p>We can start by looking at a single cell of code from the
<code>etl.ipynb</code> notebook:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># Pivot fuel_consumed_for_electricity MMBTU columns</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>fuel_elec_mmbtu_cols <span class="op">=</span> index_cols <span class="op">+</span> [col <span class="cf">for</span> col <span class="kw">in</span> pr_gen_fuel.columns <span class="cf">if</span> <span class="st">"fuel_consumed_for_electricity_mmbtu"</span> <span class="kw">in</span> col]</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>fuel_elec_mmbtu <span class="op">=</span> pr_gen_fuel.loc[:, fuel_elec_mmbtu_cols]</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="co">## Melt the fuel_consumed columns</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>fuel_elec_mmbtu_melt <span class="op">=</span> fuel_elec_mmbtu.melt(</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>    id_vars<span class="op">=</span>index_cols,</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>    var_name<span class="op">=</span><span class="st">"month"</span>,</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>    value_name<span class="op">=</span><span class="st">"fuel_consumed_for_electricity_mmbtu"</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a>)</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>fuel_elec_mmbtu_melt[<span class="st">"month"</span>] <span class="op">=</span> fuel_elec_mmbtu_melt[<span class="st">"month"</span>].<span class="bu">str</span>.replace(<span class="st">"fuel_consumed_for_electricity_mmbtu_"</span>, <span class="st">""</span>)</span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a>fuel_elec_mmbtu_melt <span class="op">=</span> fuel_elec_mmbtu_melt.set_index(index_cols <span class="op">+</span> [<span class="st">"month"</span>])</span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a>fuel_elec_mmbtu_melt</span></code></pre>
</div>
<p>What does this code do? It transforms a table that looks like
this:</p>
<table class="table"><colgroup><col width="12%"><col width="12%"><col width="12%"><col width="12%"><col width="12%"><col width="12%"><col width="12%"><col width="12%"></colgroup><thead><tr class="header"><th align="right">plant_id_eia</th>
<th align="right">plant_name_eia</th>
<th align="right">report_year</th>
<th align="right">prime_mover_code</th>
<th align="right">energy_source_code</th>
<th align="right">fuel_unit</th>
<th align="right">fuel_consumed_for_electricity_mmbtu_january</th>
<th align="right">fuel_consumed_for_electricity_mmbtu_february</th>
</tr></thead><tbody><tr class="odd"><td align="right">61034</td>
<td align="right">EcoElectrica</td>
<td align="right">2017</td>
<td align="right">CA</td>
<td align="right">NG</td>
<td align="right">mcf</td>
<td align="right">4773.0</td>
<td align="right">0.0</td>
</tr><tr class="even"><td align="right">61034</td>
<td align="right">EcoElectrica</td>
<td align="right">2017</td>
<td align="right">CT</td>
<td align="right">NG</td>
<td align="right">mcf</td>
<td align="right">2195139.0</td>
<td align="right">2044214.0</td>
</tr></tbody></table><p>into a table that looks like this:</p>
<table style="width:100%;" class="table"><colgroup><col width="11%"><col width="11%"><col width="11%"><col width="11%"><col width="11%"><col width="11%"><col width="11%"><col width="11%"><col width="11%"></colgroup><thead><tr class="header"><th align="right"></th>
<th align="right">plant_id_eia</th>
<th align="right">plant_name_eia</th>
<th align="right">report_year</th>
<th align="right">prime_mover_code</th>
<th align="right">energy_source_code</th>
<th align="right">fuel_unit</th>
<th align="right">month</th>
<th align="right">fuel_consumed_for_electricity_mmbtu</th>
</tr></thead><tbody><tr class="odd"><td align="right">1801</td>
<td align="right">61034</td>
<td align="right">EcoElectrica</td>
<td align="right">2017</td>
<td align="right">CA</td>
<td align="right">NG</td>
<td align="right">mcf</td>
<td align="right">january</td>
<td align="right">4773.0</td>
</tr><tr class="even"><td align="right">1351</td>
<td align="right">61034</td>
<td align="right">EcoElectrica</td>
<td align="right">2017</td>
<td align="right">CA</td>
<td align="right">NG</td>
<td align="right">mcf</td>
<td align="right">february</td>
<td align="right">0.0</td>
</tr><tr class="odd"><td align="right">1802</td>
<td align="right">61034</td>
<td align="right">EcoElectrica</td>
<td align="right">2017</td>
<td align="right">CT</td>
<td align="right">NG</td>
<td align="right">mcf</td>
<td align="right">january</td>
<td align="right">2195139.0</td>
</tr><tr class="even"><td align="right">1352</td>
<td align="right">61034</td>
<td align="right">EcoElectrica</td>
<td align="right">2017</td>
<td align="right">CT</td>
<td align="right">NG</td>
<td align="right">mcf</td>
<td align="right">february</td>
<td align="right">2044214.0</td>
</tr></tbody></table><p>Or, in words: this code takes a table with data stored in one column
per month and stacks all the fields for a single variable
(fuel_consumed_for_electricity_mmbtu), returning a table with one month
column and one value column for this variable in order to make it easier
to plot our data over time.</p>
<div id="challenge-1-identifying-duplicated-code" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="challenge-1-identifying-duplicated-code" class="callout-inner">
<h3 class="callout-title">Challenge 1: Identifying duplicated code</h3>
<div class="callout-content">
<p>Open <code>notebooks/etl.ipynb</code>. Do you see any code that
performs this same task? What differences do you note between the code
itself?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>Cells 6, 7, 8, and 9 all do the same thing. Note that each cell does
this for a different variable (e.g., “fuel_consumed_units” instead of
“fuel_consumed_for_electricity_mmbtu”). In cell 9, we also see that the
way we’re selecting the columns is different:
<code>if col.startswith()</code> instead of
<code>if x in col</code>.</p>
</div>
</div>
</div>
</div>
<p>We’re doing <em>almost</em> the same thing five times! Imagine you
find an error in your first code cell - now you have to copy paste the
code into each cell where similar code appears. Or, image you want to do
this for 25 columns rather than five. What if instead of repeating this
code, we replaced it with single function we could re-use each time?</p>
<p>We can imagine writing a function called
<code>melt_monthly_vars</code> to replace our repetitive code. Then, our
many lines of code might look something like this:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="kw">def</span> melt_monthly_vars(df, variable_name):</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>    <span class="co">#some code here</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>    <span class="cf">return</span> df_melt</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>fuel_elec_mmbtu_melt <span class="op">=</span> melt_monthly_vars(pr_gen_fuel, <span class="st">"fuel_consumed_electricity_mmbtu"</span>)</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>fuel_elec_units_melt <span class="op">=</span> melt_monthly_vars(pr_gen_fuel, <span class="st">"fuel_consumed_electricity_units"</span>)</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>fuel_mmbtu_melt <span class="op">=</span> melt_monthly_vars(pr_gen_fuel, <span class="st">"fuel_consumed_mmbtu"</span>)</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>...</span></code></pre>
</div>
<p>Yet, as we just saw, this redundant code isn’t <em>identical</em>
across all variables: the cell working with
<code>net_generation_mwh</code> selects cells differently than the
others.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>net_gen_cols <span class="op">=</span> index_cols <span class="op">+</span> [col <span class="cf">for</span> col <span class="kw">in</span> pr_gen_fuel.columns <span class="cf">if</span> col.startswith(<span class="st">"net_generation_mwh"</span>)]</span></code></pre>
</div>
<p><em>Should</em> it get combined into this
<code>melt_monthly_vars</code>?</p>
<p>As we think about how to organize our code into discrete and reusable
steps (or to <em>modularize</em> it), it doesn’t take long to run into
these types of tricky questions. One strategy to help us figure out
which code we can modularize is a <strong>plain language
approach</strong>.</p>
<p>Often, we start by writing our code first and adding comments or
documentation at the end. In contrast, starting by briefly outlining
what a piece of our code <em>should do</em> and <em>why</em> can be
incredibly valuable.</p>
<p>Let’s go back to the description we wrote earlier:</p>
<p><em>“This code takes a table with data stored in one column per month
and stacks all the fields for a single variable<em>
</em>(fuel_consumed_for_electricity_mmbtu), returning a table with one
month column and one value column for this variable in<em> </em>order to
make it easier to plot our data over time.”</em></p>
<p>Yes, the code definitely does this! Whatever code we use to write our
<code>melt_monthly_vars</code> function, it should definitely work for
this case.</p>
<p>Let’s take another example from our notebook:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="co"># Plant 62410 has two 2020 data entries but one is null</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="co"># Drop the bad row</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>pr_gen_fuel_final <span class="op">=</span> pr_gen_fuel_clean.loc[</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>    <span class="op">~</span>((pr_gen_fuel_clean.plant_id_eia <span class="op">==</span> <span class="dv">62410</span>)</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>    <span class="op">&amp;</span> (pr_gen_fuel_clean.date.dt.year <span class="op">==</span> <span class="dv">2020</span>)</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>    <span class="op">&amp;</span> (pr_gen_fuel_clean.fuel_consumed_for_electricity_mmbtu.isnull()))</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>]</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a><span class="co"># drop after 2025-03-01 (for now) as these values should not exist</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a>pr_gen_fuel_final <span class="op">=</span> pr_gen_fuel_final.loc[pr_gen_fuel_clean.date <span class="op">&lt;</span> pd.Timestamp(<span class="st">"2025-03-01"</span>)]</span></code></pre>
</div>
<div id="challenge-2-writing-plain-language-descriptions" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="challenge-2-writing-plain-language-descriptions" class="callout-inner">
<h3 class="callout-title">Challenge 2: Writing plain language
descriptions</h3>
<div class="callout-content">
<p>Write a plain language description (1-2 sentences) for each of these
two lines of code. Should they be combined into one
<code>drop_bad_values()</code> function?</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<ol style="list-style-type: decimal"><li>This code drops a specific row that has been identified as a “bad”
(in this case, duplicated and empty) value.</li>
<li>This code drops all data reported with invalid timestamps.</li>
</ol><p>Though both of these lines are dropping low-quality records, their
intent is very different. The first line targets a very specific known
bad value, while the second drops a potentially large number of records
based on valid values in a single column. Though both may address “bad”
data, they shouldn’t get combined into a single function.</p>
</div>
</div>
</div>
</div>
<p>As we saw in this challenge, understanding the intent of our code is
necessary to effectively reorganizing it.</p>
<p>When is code a <em>good</em> candidate for modularization?</p>
<ul><li>In plain language, it’s a discrete step.</li>
<li>You find yourself copy-pasting the same lines of code over and over
again.</li>
<li>You want to do pretty much the same thing in many different contexts
(e.g., on other columns, on other datasets).</li>
<li>It’s a complex task (e.g., an involved multi-line transformation)
that requires some extra explanation</li>
<li>You want to be able to test it (we’ll cover this shortly)</li>
</ul><p>When is code a <em>bad</em> candidate for modularization?</p>
<ul><li>In plain language, it’s actually more than one step (e.g.,
converting data types <em>and</em> dropping rows)</li>
<li>You never anticipate reusing it (e.g., a completely bespoke
transformation step)</li>
<li>It’s already a modularized function. For example, Pandas’ .replace()
method can already take multiple input values flexibly, so there’s no
need to reproduce someone else’s work here.</li>
</ul><p>Modularizing our code can take some time! Being strategic about when
and where to pull code out for this kind of treatment takes some
practice, but can save a lot of time and pain in the long run.</p>
<div id="discussion1" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<span class="callout-header">Discussion</span>
<div class="callout-inner">
<div class="callout-content">
<p>Which other parts of this code are good candidates for
modularization?</p>
</div>
</div>
</div>
<div id="accordionInstructor1" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor1" aria-expanded="false" aria-controls="collapseInstructor1">
  <h3 class="accordion-header" id="headingInstructor1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Instructor Note </h3>
</button>
<div id="collapseInstructor1" class="accordion-collapse collapse" data-bs-parent="#accordionInstructor1" aria-labelledby="headingInstructor1">
<div class="accordion-body">
<p>The code that handles the data type transformations for both the
plant frame and the generation fuel table can probably be modularized.
We could consider writing a function that maps Y/N to boolean columns,
for example.</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="a-plain-language-approach-to-function-design">A plain language approach to function design<a class="anchor" aria-label="anchor" href="#a-plain-language-approach-to-function-design"></a></h2>
<hr class="half-width"><div id="callout1" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div class="callout-inner">
<div class="callout-content">
<p>What’s a <strong>function</strong>? A function is a reusable piece of
code that can be treated as a black box by the rest of your
workflow.</p>
<p>What makes a good function?:</p>
<ul><li>It has one task (can be composed of multiple other functions)</li>
<li>Someone other than the person who wrote it can understand what it
does</li>
<li>It can be adaptable (e.g., we can run this transformation function
on a new year of data).</li>
<li>It can be tested (we’ll talk about this next module!)</li>
</ul></div>
</div>
</div>
<p>Plain language not only helps us to identify meaningful similarities
and differences across our code, but it can also serve as an important
starting place for function design:</p>
<ul><li>There are many ways to do most tasks. Using plain language
descriptions focuses us on the desired outcome, and helps us assess
whether different ways of doing the same thing might help meet our goals
better.</li>
<li>Plain language helps us break down the discrete steps involved in a
task and the expected outcome.</li>
<li>When our underlying data changes or we try to reuse our code in a
different context, plain language descriptions can help us pay attention
to what the code we’ve written can and can’t be used to do.</li>
<li>Plain language helps provide important context about <em>why</em>
we’ve written this code and what it does.</li>
</ul><p>When we’re taught how to write a function, lessons typically focus on
the basics:</p>
<ul><li>A function should have a name</li>
<li>A function should have inputs</li>
<li>A function should have an output (return something)</li>
<li>Function and variable names should be informative, but not unwieldy.
<code>i</code> is bad, but so is
<code>raw_puerto_rico_generation_fuel_data_from_eia_923</code>.</li>
</ul><div id="accordionInstructor2" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor2" aria-expanded="false" aria-controls="collapseInstructor2">
  <h3 class="accordion-header" id="headingInstructor2">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Instructor Note </h3>
</button>
<div id="collapseInstructor2" class="accordion-collapse collapse" data-bs-parent="#accordionInstructor2" aria-labelledby="headingInstructor2">
<div class="accordion-body">
<p>Start with the code for the net generation melt. First, swap out the
variable name for a variable that is called <code>variable_name</code>.
Then, rename the variables to be more generic (as below). Check that the
startwith() method works for all the columns by showing that all the
other columns we’re interested in also start with their variable
names.</p>
<p>We can use this to demonstrate that we can get the same method to
work for all 5 cases with one additional variable.</p>
</div>
</div>
</div>
</div>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="kw">def</span> melt_monthly_vars(pr_gen_fuel, variable_name):</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>    var_cols <span class="op">=</span> index_cols <span class="op">+</span> [col <span class="cf">for</span> col <span class="kw">in</span> pr_gen_fuel.columns <span class="cf">if</span> col.startswith(variable_name)]</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>    var_df <span class="op">=</span> pr_gen_fuel.loc[:, var_cols]</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>    <span class="co">## Melt the fuel_consumed columns</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>    var_melt <span class="op">=</span> var_df.melt(</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>        id_vars<span class="op">=</span>index_cols,</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>        var_name<span class="op">=</span><span class="st">"month"</span>,</span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>        value_name<span class="op">=</span>variable_name</span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>    )</span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>    var_melt[<span class="st">"month"</span>] <span class="op">=</span> var_melt[<span class="st">"month"</span>].<span class="bu">str</span>.replace(<span class="ss">f"</span><span class="sc">{</span>variable_name<span class="sc">}</span><span class="ss">_"</span>, <span class="st">""</span>)</span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a>    var_melt <span class="op">=</span> var_melt.set_index(index_cols <span class="op">+</span> [<span class="st">"month"</span>])</span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a>    <span class="cf">return</span> var_melt</span></code></pre>
</div>
<div class="section level3">
<h3 id="docstrings">Docstrings<a class="anchor" aria-label="anchor" href="#docstrings"></a></h3>
<p>We can attach our plain language summary of the function directly to
our code by using a docstring. Unlike an in-line comment which uses the
hash symbol (e.g., <code># melt the vars</code>), a docstring uses
triple quotation marks and is written right after the definition of a
function, module, method or class.</p>
<p>A docstring can contain the following information:</p>
<ul><li>A one-line summary of your function.</li>
<li>A paragraph with a longer description (optional)</li>
<li>A list of input arguments, and what they are expected to be</li>
<li>A list of returned objects, and what they are expected to be</li>
</ul><div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="kw">def</span> melt_monthly_vars(pr_gen_fuel, variable_name):</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>    <span class="co">"""Melt many columns of monthly data for a single variable into a month column and a value column.</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="co">    This code takes a table with data stored in one column per month and stacks all the fields for a single variable (fuel_consumed_for_electricity_mmbtu), returning a table with one month column and one value column for this variable in</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="co">    order to make it easier to plot our data over time. Note that this drops the other variables of data.</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="co">        pr_gen_fuel: EIA 923 Puerto Rico generation fuel data.</span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a><span class="co">        variable_name: The variable to be melted.</span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a><span class="co">        var_melt: A dataframe containing only index columns, a month column and the melted variable data.</span></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a>    var_cols <span class="op">=</span> index_cols <span class="op">+</span> [col <span class="cf">for</span> col <span class="kw">in</span> pr_gen_fuel.columns <span class="cf">if</span> col.startwith(variable_name)]</span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a>    var_df <span class="op">=</span> pr_gen_fuel.loc[:, var_cols]</span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a></span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a>    <span class="co">## Melt the fuel_consumed columns</span></span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a>    var_melt <span class="op">=</span> var_df.melt(</span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a>        id_vars<span class="op">=</span>index_cols,</span>
<span id="cb6-20"><a href="#cb6-20" tabindex="-1"></a>        var_name<span class="op">=</span><span class="st">"month"</span>,</span>
<span id="cb6-21"><a href="#cb6-21" tabindex="-1"></a>        value_name<span class="op">=</span>variable_name</span>
<span id="cb6-22"><a href="#cb6-22" tabindex="-1"></a>    )</span>
<span id="cb6-23"><a href="#cb6-23" tabindex="-1"></a>    var_melt[<span class="st">"month"</span>] <span class="op">=</span> var_melt[<span class="st">"month"</span>].<span class="bu">str</span>.replace(<span class="ss">f"</span><span class="sc">{</span>variable_name<span class="sc">}</span><span class="ss">_"</span>, <span class="st">""</span>)</span>
<span id="cb6-24"><a href="#cb6-24" tabindex="-1"></a>    var_melt <span class="op">=</span> var_melt.set_index(index_cols <span class="op">+</span> [<span class="st">"month"</span>])</span>
<span id="cb6-25"><a href="#cb6-25" tabindex="-1"></a>    <span class="cf">return</span> var_melt</span></code></pre>
</div>
<p>Now in two months, when you return to your code and wonder what it
does, you can simply call:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="bu">help</span>(melt_monthly_vars)</span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="type-hints">Type hints<a class="anchor" aria-label="anchor" href="#type-hints"></a></h3>
<p>In our docstring, we’re already implying some things about what we
should and shouldn’t be able to pass into our variables (for example,
should we be able to pass a number in as <code>variable_name</code>?).
<strong>Type hints</strong> help us know exactly what data types our
functions take. We can specify one or more datatypes expected as the
input and output of the code as follows:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="kw">def</span> melt_monthly_vars(pr_gen_fuel: pd.DataFrame, variable_name: <span class="bu">str</span>) <span class="op">-&gt;</span> pd.DataFrame:</span></code></pre>
</div>
<p>In this case, take a Pandas DataFrame and a string and return another
Pandas DataFrame. Multiple types can be formatted as follows:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="kw">def</span> my_cool_function(list_of_ints: <span class="bu">list</span>[<span class="bu">int</span>], str_or_int_or_none: <span class="bu">str</span><span class="op">|</span><span class="bu">int</span><span class="op">|</span><span class="va">None</span>) <span class="op">-&gt;</span> <span class="bu">list</span>[<span class="bu">int</span><span class="op">|</span><span class="bu">str</span>]:</span></code></pre>
</div>
<p>While Python won’t raise an error if you pass a different datatype
in, this provides a helpful form of documentation to yourself and others
about what types of data you expect to work with this function, and what
the format of the output is intended to be.</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="kw">def</span> melt_monthly_vars(pr_gen_fuel: pd.DataFrame, variable_name: <span class="bu">str</span>) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>    <span class="co">"""Melt many columns of monthly data for a single variable into a month column and a value column.</span></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a><span class="co">    This code takes a table with data stored in one column per month and stacks all the fields for a single variable (fuel_consumed_for_electricity_mmbtu), returning a table with one month column and one value column for this variable in</span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a><span class="co">    order to make it easier to plot our data over time. Note that this drops the other variables of data.</span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a><span class="co">        pr_gen_fuel: EIA 923 Puerto Rico generation fuel data.</span></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a><span class="co">        variable_name: The variable to be melted.</span></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a><span class="co">        var_melt: A dataframe containing only index columns, a month column and the melted variable data.</span></span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a>    var_cols <span class="op">=</span> index_cols <span class="op">+</span> [col <span class="cf">for</span> col <span class="kw">in</span> pr_gen_fuel.columns <span class="cf">if</span> col.startwith(variable_name)]</span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a>    var_df <span class="op">=</span> pr_gen_fuel.loc[:, var_cols]</span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a></span>
<span id="cb10-17"><a href="#cb10-17" tabindex="-1"></a>    <span class="co">## Melt the fuel_consumed columns</span></span>
<span id="cb10-18"><a href="#cb10-18" tabindex="-1"></a>    var_melt <span class="op">=</span> var_df.melt(</span>
<span id="cb10-19"><a href="#cb10-19" tabindex="-1"></a>        id_vars<span class="op">=</span>index_cols,</span>
<span id="cb10-20"><a href="#cb10-20" tabindex="-1"></a>        var_name<span class="op">=</span><span class="st">"month"</span>,</span>
<span id="cb10-21"><a href="#cb10-21" tabindex="-1"></a>        value_name<span class="op">=</span>variable_name</span>
<span id="cb10-22"><a href="#cb10-22" tabindex="-1"></a>    )</span>
<span id="cb10-23"><a href="#cb10-23" tabindex="-1"></a>    var_melt[<span class="st">"month"</span>] <span class="op">=</span> var_melt[<span class="st">"month"</span>].<span class="bu">str</span>.replace(<span class="ss">f"</span><span class="sc">{</span>variable_name<span class="sc">}</span><span class="ss">_"</span>, <span class="st">""</span>)</span>
<span id="cb10-24"><a href="#cb10-24" tabindex="-1"></a>    var_melt <span class="op">=</span> var_melt.set_index(index_cols <span class="op">+</span> [<span class="st">"month"</span>])</span>
<span id="cb10-25"><a href="#cb10-25" tabindex="-1"></a>    <span class="cf">return</span> var_melt</span></code></pre>
</div>
<div id="challenge-3-putting-it-all-together" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<span class="callout-header">Discussion</span>
<div id="challenge-3-putting-it-all-together" class="callout-inner">
<h3 class="callout-title">Challenge 3: putting it all together!</h3>
<div class="callout-content">
<p>In a group, identify one task in the <code>etl.ipynb</code> that you
think is a good candidate for modularization. In plain language,
identify what you want the function you’re writing to accomplish. Then,
try and write a generalizeable function that accomplishes that step.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="kw">def</span> my_cool_function(<span class="bu">input</span>: Type) <span class="op">-&gt;</span> Type:</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>    <span class="co">""" This function does something.</span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a><span class="co">    Any more notes can go here.</span></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a><span class="co">    Args:</span></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a><span class="co">        input: What the input is</span></span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a><span class="co">        Something useful.</span></span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a>    <span class="co"># your code here</span></span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a>    <span class="cf">return</span> output</span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionInstructor3" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor3" aria-expanded="false" aria-controls="collapseInstructor3">
  <h3 class="accordion-header" id="headingInstructor3">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Instructor Note </h3>
</button>
<div id="collapseInstructor3" class="accordion-collapse collapse" data-bs-parent="#accordionInstructor3" aria-labelledby="headingInstructor3">
<div class="accordion-body">
<p>Ask each team to paste their function into the codi and explain why
they chose it. Pick one or two of these to test.</p>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<span class="callout-header">Key Points</span>
<div class="callout-inner">
<div class="callout-content">
<ul><li>TODO</li>
</ul></div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</div>
</section></div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="../instructor/coming-soon.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="../instructor/index.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="../instructor/coming-soon.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: More Topics Coming
        </a>
        <a class="chapter-link float-end" href="../instructor/index.html" rel="next">
          Home
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/catalyst-cooperative/open-energy-data-for-all/edit/main/episodes/modularization.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/catalyst-cooperative/open-energy-data-for-all/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/catalyst-cooperative/open-energy-data-for-all/" class="external-link">Source</a></p>
				<p><a href="https://github.com/catalyst-cooperative/open-energy-data-for-all/blob/main/CITATION.cff" class="external-link">Cite</a> | <a href="mailto:hello@catalyst.coop">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.17.1" class="external-link">sandpaper (0.17.1)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.9" class="external-link">pegboard (0.7.9)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.7" class="external-link">varnish (1.0.7)</a></p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "LearningResource",
  "@id": "https://catalyst-cooperative.github.io/open-energy-data-for-all/instructor/modularization.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/LearningResource/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, energy, PUDL, catalyst",
  "name": "Modularization",
  "creativeWorkStatus": "active",
  "url": "https://catalyst-cooperative.github.io/open-energy-data-for-all/instructor/modularization.html",
  "identifier": "https://catalyst-cooperative.github.io/open-energy-data-for-all/instructor/modularization.html",
  "dateCreated": "2024-10-23",
  "dateModified": "2025-08-27",
  "datePublished": "2025-08-27"
}

  </script><script>
		feather.replace();
	</script></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

