<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<title>Open Energy Data For All: All in One View</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="../assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="../assets/styles.css">
<script src="../assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="../favicons/incubator/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicons/incubator/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../favicons/incubator/favicon-16x16.png">
<link rel="manifest" href="../favicons/incubator/site.webmanifest">
<link rel="mask-icon" href="../favicons/incubator/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="white">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="black">
</head>
<body>
    <header id="top" class="navbar navbar-expand-md top-nav incubator"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="incubator-logo" alt="Foundational data and software skills for energy data analysis." src="../assets/images/incubator-logo.svg"><span class="badge text-bg-danger">
          <abbr title="This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.">
            <a href="https://docs.carpentries.org/resources/curriculum/lesson-life-cycle.html" class="external-link alert-link">
              <i aria-hidden="true" class="icon" data-feather="alert-octagon" style="border-radius: 5px"></i>
              Pre-Alpha
            </a>
            <span class="visually-hidden">This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.</span>
          </abbr>
        </span>

      </div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text">
<li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul>
</li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
<li><button class="dropdown-item" type="button" onclick="window.location.href='../aio.html';">Learner View</button></li>
        </ul>
</div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Foundational data and software skills for energy data analysis." src="../assets/images/incubator-logo-sm.svg">
</div>
    <div class="lesson-title-md">
      Open Energy Data For All
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item">
          <span class="lesson-title">
            Open Energy Data For All
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/instructor-notes.html">Instructor Notes</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/images.html">Extract All Images</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
<hr>
<li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul>
</li>
      </ul>
</div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="../instructor/aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div>
<!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Open Energy Data For All
</div>

<aside class="col-md-12 lesson-progress"><div style="width: %" class="percentage">
    %
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: %" aria-valuenow="" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text">
<li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul>
</li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="../aio.html">Learner View</a>
                      </div>
                    </div>
                  </div>
<!--/div.accordion-item-->
                </div>
<!--/div.accordion-flush-->
              </div>
<!--div.sidenav-view-selector -->
            </div>
<!--/div.col -->

            <hr>
</div>
<!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Schedule</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="introduction.html">1. Introduction</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="working-with-diverse-filetypes.html">2. Handling diverse filetypes in Pandas</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="accessing-remote-data.html">3. Accessing remote data</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="scraping-data.html">4. Scraping Data</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="visual-data-exploration.html">5. Visual Data Exploration</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="assumptions.html">6. Making assumptions about your data</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="coming-soon.html">7. More Topics Coming Soon</a>
    </div>
<!--/div.accordion-header-->

  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width">
<div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul>
<li>
                        <a href="../instructor/key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="../instructor/instructor-notes.html">Instructor Notes</a>
                      </li>
                      <li>
                        <a href="../instructor/images.html">Extract All Images</a>
                      </li>
                      <hr>
<li><a class="dropdown-item" href="reference.html">Reference</a></li>
                    </ul>
</div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources">
<a href="../instructor/aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none">
<div class="d-grid gap-1">

            </div>
          </div>
<!-- /div.accordion -->
        </div>
<!-- /div.sidebar-inner -->
      </nav>
</div>
<!-- /div.sidebar -->
  </div>
<!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-extra.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <main id="main-content" class="main-content"><div class="container lesson-content">
        
        
<section id="aio-introduction"><p>Content from <a href="introduction.html">Introduction</a></p>
<hr>
<p>Last updated on 2025-05-15 |

        <a href="https://github.com/catalyst-cooperative/open-energy-data-for-all/edit/main/episodes/introduction.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 37 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>Working with data sucks. How can I make sure no one else has to
suffer this misery?</li>
<li>What can I do to help my work have lasting impact?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Discuss the benefits of open data principles.</li>
<li>Identify key challenges to using data in research</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="accordionInstructor1" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor1" aria-expanded="false" aria-controls="collapseInstructor1">
  <h3 class="accordion-header" id="headingInstructor1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Instructor Note </h3>
</button>
<div id="collapseInstructor1" class="accordion-collapse collapse" aria-labelledby="headingInstructor1" data-bs-parent="#accordionInstructor1">
<div class="accordion-body">
<p>Intro exercise: As people trickle in: * online: in the chat, write
your name and one thing you’re excited to learn about in the course. *
in person: if small enough, ask one by one. If bigger, do the same thing
on a sticky note.</p>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="greetings">Greetings<a class="anchor" aria-label="anchor" href="#greetings"></a>
</h3>
<p>Welcome to Open Energy Data for All!</p>
<div id="accordionInstructor2" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor2" aria-expanded="false" aria-controls="collapseInstructor2">
  <h3 class="accordion-header" id="headingInstructor2">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Instructor Note </h3>
</button>
<div id="collapseInstructor2" class="accordion-collapse collapse" aria-labelledby="headingInstructor2" data-bs-parent="#accordionInstructor2">
<div class="accordion-body">
<p>Deliver this as if you are in an infomercial, and as if everyone is
on board with the character you are playing.</p>
</div>
</div>
</div>
</div>
<ul>
<li>Have you ever struggled with all the weird little auxiliary bits of
writing research software?</li>
<li>Does it ever seem like those weird little auxiliary bits are, like,
all of the work you do, and the actual interesting energy analysis you
want to do falls by the wayside?</li>
<li>Do you ever feel like there must be a better way to do your
research?</li>
</ul>
<p>That’s all normal. There’s a lot to working with data that doesn’t
get covered in class, and people are usually left to learn through
personal struggle. Drawing on our experiences working with real-world
energy data, we’ll focus on a few practical skills that can help close
that gap.</p>
<div id="accordionInstructor3" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor3" aria-expanded="false" aria-controls="collapseInstructor3">
  <h3 class="accordion-header" id="headingInstructor3">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Instructor Note </h3>
</button>
<div id="collapseInstructor3" class="accordion-collapse collapse" aria-labelledby="headingInstructor3" data-bs-parent="#accordionInstructor3">
<div class="accordion-body">
<p>Logistics:</p>
<ul>
<li>My name is $name and I come from $background. Your other instructors
will be $list (ask them for quick intro).</li>
<li>Most sessions are structured as sets of short explanations or
demonstrations, interspersed with exercises. Be prepared to alternate
listening-mode with thinking-mode and doing-mode.</li>
<li>Ask questions by using the “raise hand” indicator or typing into
chat.</li>
<li>Follow along on the website and/or use it to catch up if you need to
space out or step out: <a href="https://docs.catalyst.coop/open-energy-data-for-all/" class="external-link uri">https://docs.catalyst.coop/open-energy-data-for-all/</a>
</li>
</ul>
<p>Any other questions on what to expect or how to participate?</p>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="the-energy-data-landscape">The energy data landscape<a class="anchor" aria-label="anchor" href="#the-energy-data-landscape"></a>
</h3>
<p>Working with energy data can be hard and frustrating. Data problems
can wreck a research project before it starts, or crop up unexpectedly
near the finish line. Why is energy data be so hard to work with?</p>
<ul>
<li>
<strong>Energy data can be hard to access:</strong> When three
federal agencies, state agencies, and Independent System Operators
(ISOs) all publish overlapping data about boilers, generators,
smokestacks, plants and so on, it can be hard to know where to start.
Changes in data structure and format, the large variety of file types,
and the sheer size of some datasets all pose challenges. Where data is
regularly updated, it can be tricky to keep your workflow up to date,
and make sure that your collaborators are working with the same version
of the data you’re using.</li>
<li>
<strong>Energy data can be messy and unpredictable:</strong> Why is
this coal plant labelled as retired one year and operating the next?
Energy data often requires substantial cleaning before it is ready for
analysis, and it’s common that even mid-way through a research process a
model or analysis will reveal problems that weren’t obvious at first.
Commercial data promises to be analysis-ready, but hides assumptions and
transformations in a black box, and imposes restrictions on the
reproducibility and openness of your research - if you can afford
it!</li>
</ul>
</div>
<div class="section level3">
<h3 id="a-new-way">A new way…<a class="anchor" aria-label="anchor" href="#a-new-way"></a>
</h3>
<p>What if instead of each one of us reproducing the same frustrating
data wrangling tasks on our own, we found a different way? What would a
collaborative, open, and reproducible energy research ecosystem look
like?</p>
<p><strong>Collaborative:</strong> How can you bring in other people
starting early on in the project? It’d be nice if your other team
members could review your work, provide feedback, and contribute to
parts of the analysis. Then if you have to disappear for a while, other
people can carry the project forward.</p>
<p><strong>Open and transparent:</strong> What are the inputs, what are
the outputs, and how did you get from A to B? When you’re talking to a
potential collaborator, a new teammate, or just getting back into the
project after a break, being able to see all the steps and assumptions
you’ve made along the way can save you a lot of pain. Whether to meet
publishing requirements or to contribute to open-source science, you
want to be able to share your code and data without hesitation.</p>
<p><strong>Reproducible:</strong> How can researchers in other labs can
build on the work that you’re about to do, and confirm your results?
Maybe you end up getting a new job, leaving someone else in the lab to
keep the project going. In your new role, you might find that you
yourself want to build on all your old work.</p>
<div class="section level4">
<h4 id="what-we-will-cover">What we will cover<a class="anchor" aria-label="anchor" href="#what-we-will-cover"></a>
</h4>
<p>How do we get there? Often, we assume that the skills needed to
actually enact these principles are learned naturally through research
experience, but this is not always effective in practice. Gaps in these
areas can create roadblocks to conducting effective, reproducible and
open research, even for experienced researchers.</p>
<div id="accordionInstructor4" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor4" aria-expanded="false" aria-controls="collapseInstructor4">
  <h3 class="accordion-header" id="headingInstructor4">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Instructor Note </h3>
</button>
<div id="collapseInstructor4" class="accordion-collapse collapse" aria-labelledby="headingInstructor4" data-bs-parent="#accordionInstructor4">
<div class="accordion-body">
<p>Modify for whatever subset is being presented.</p>
</div>
</div>
</div>
</div>
<p>This course is focused on practical solutions to roadblocks you may
encounter in dealing with data, code, and collaboration. We will be
following the arc of an open data analysis project in Python,
structuring the course into three sections:</p>
<p>Roadblocks to data acquisition:</p>
<ul>
<li>My data is in a format I’ve never worked before</li>
<li>The data I want to work with is published through an Application
Programming Interface (API), and I don’t know how to download it</li>
</ul>
<p>Roadblocks to data cleaning &amp; processing:</p>
<ul>
<li>There’s something unexpected about my input data, but I’m not sure
what</li>
<li>The code runs on some of my data, but errors on other input
data</li>
<li>When I re-run my code I get different results, and I’m not sure
why</li>
<li>I have no idea which part of my code is causing a particular
problem</li>
<li>My data changes format or content over time</li>
<li>My data is too big to work with on a desktop computer</li>
</ul>
<p>Roadblocks to collaboration:</p>
<ul>
<li>I’m not sure how to make it simple for collaborators to run and
contribute to my code</li>
<li>I need to publish my code and/or data for a paper I’m submitting to,
but I’m not sure how best to do so</li>
<li>A colleague wants to build on my existing code, but I’m not sure how
to clearly document what I’ve done to make it possible for them to adapt
it</li>
<li>I wrote this code myself six months ago, and I do not recognize it,
nor can I remember what I was trying to do</li>
</ul>
<p>The next episode will discuss reading data in unexpected file
formats.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<span class="callout-header">Key Points</span>
<div class="callout-inner">
<div class="callout-content">
<ul>
<li>Open data principles such as reproducibility, transparency, and
collaboration make it easier to share, interpret, and build upon
research projects.</li>
<li>Enacting these values doesn’t ‘just happen’ - it requires specific
skills and strategies.</li>
</ul>
</div>
</div>
</div>
<div id="accordionInstructor5" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor5" aria-expanded="false" aria-controls="collapseInstructor5">
  <h3 class="accordion-header" id="headingInstructor5">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Instructor Note </h3>
</button>
<div id="collapseInstructor5" class="accordion-collapse collapse" aria-labelledby="headingInstructor5" data-bs-parent="#accordionInstructor5">
<div class="accordion-body">
<p>Don’t cover this, unless you have a lot of extra time or this is high
priority for your students. Instead, direct students to the course
website for tips on locating and identifying appropriate datasets for
open research projects.</p>
</div>
</div>
</div>
</div>
<p>Strategies for finding the ‘right’ data are highly dependent on your
specific research field, so we don’t delve into this in the course.
However, below you’ll find some resources and aspects of data that are
important to consider as you progress</p>
</div>
</div>
<div class="section level3">
<h3 id="additional-resources-strategies-for-finding-appropriate-research-data">Additional resources: strategies for finding appropriate research
data<a class="anchor" aria-label="anchor" href="#additional-resources-strategies-for-finding-appropriate-research-data"></a>
</h3>
<p>In conducting open research, it is best to start right at the
beginning, with how we choose our datasets. This is not something we’ll
cover in detail anywhere else, but we can give some rough guidelines
here. Consider the following attributes of a potential data source:</p>
<ul>
<li>
<strong>Relevancy:</strong> Does the data contain the variables you
need to answer your question? Does the spatial and temporal scale of the
data match your research needs? For example, data at the utility level
probably won’t be sufficient to answer questions about boiler-level
operations.</li>
<li>
<strong>Licensing:</strong> People often assume that any content
they can download from the internet is freely available for use, but
this is not true. By default, all creative works are protected by
copyright, and if you try to republish something copyrighted, you can
run into trouble. If a specific license is set for a dataset, sometimes
that might make it free to use, and other times it might set some
additional restrictions. Verify that a dataset’s license meets your
needs as soon as possible in the research process.</li>
<li>
<strong>Documentation:</strong> Is the data published with
descriptions of any processing done or notable caveats, explanations of
variable definitions, and contact information for any further
questions?</li>
<li>
<strong>Level and type of processing:</strong> The more processed a
dataset is, the more you’re depending on others’ judgement. If you trust
those people, and they make it clear what they’ve done and why, and the
result is a dataset that’s much easier to use, this can be a great
trade-off. Pre-processed datasets may combine multiple datasets
together, use extensive validation techniques, or handle missing and
outlying values - depending on your research needs, these can save
valuable time and effort or enable you to ask questions that would
otherwise be out of scope for a research project.</li>
<li>
<strong>Format:</strong> Data contained in poorly scanned PDFs will
require much more extensive processing to use than data contained in
spreadsheets or computer-optimized data formats such as Parquet. If you
require multiple years of data for your research, look out for changes
in data formats over time.</li>
</ul>
<p>We also have several recommendations to give you a start finding
appropriate data for your own research project, depending on your area
of interest:</p>
<ul>
<li>For national-scale research, federal agencies such as the EIA, EPA
and FERC all publish free and regularly-updated data.</li>
<li>For local/state-level research: some states maintain their own data
portals (e.g., the <a href="https://akenergygateway.alaska.edu/" class="external-link">Alaska
Energy Data Gateway</a>), and some ISOs publish regularly-updated
operational data (e.g., <a href="https://www.caiso.com/todays-outlook" class="external-link">CAISO’s hourly
data</a>).</li>
<li>For analysis-ready data: projects such as the <a href="https://catalystcoop-pudl.readthedocs.io/en/latest/index.html" class="external-link">Public
Utility Data Liberation (PUDL) project</a>, <a href="https://github.com/PowerGenome/PowerGenome?tab=readme-ov-file" class="external-link">PowerGenome</a>,
Gridstatus, and others publish pre-processed data that addresses many of
the common foundational challenges that make federal energy data hard to
work with.</li>
</ul>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</div></section><section id="aio-working-with-diverse-filetypes"><p>Content from <a href="working-with-diverse-filetypes.html">Handling diverse filetypes in Pandas</a></p>
<hr>
<p>Last updated on 2025-06-12 |

        <a href="https://github.com/catalyst-cooperative/open-energy-data-for-all/edit/main/episodes/working-with-diverse-filetypes.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 55 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div id="accordionInstructor1" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor1" aria-expanded="false" aria-controls="collapseInstructor1">
  <h3 class="accordion-header" id="headingInstructor1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Instructor Note </h3>
</button>
<div id="collapseInstructor1" class="accordion-collapse collapse" data-bs-parent="#accordionInstructor1" aria-labelledby="headingInstructor1">
<div class="accordion-body">
<p>In preparation for this lesson:</p>
<ul>
<li>In Jupyter Notebooks, open the 2-diverse-filetypes.ipynb
notebook</li>
<li>In another Jupyter Notebooks tab, open the directory view to make it
possible to visualize the xml file</li>
<li>Open the <code>data/eia923_2022.xlsx</code> file on your computer’s
spreadsheet software (e.g., Excel)</li>
<li>Open the lesson folder in your local file browser, to make it easy
to open files in a text editor throughout the lesson.</li>
</ul>
</div>
</div>
</div>
</div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I read in different tabular file formats to a familiar data
type in Python?</li>
<li>What are some common errors that occur when importing data, and how
can I troubleshoot them?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Import tabular data from Excel, JSON, XML and Parquet formats to
pandas dataframes using the <code>pandas</code> library</li>
<li>Use <code>help</code> and function documentation to select and set
parameters in function calls.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="untangling-a-data-pile">Untangling a data pile<a class="anchor" aria-label="anchor" href="#untangling-a-data-pile"></a>
</h2>
<hr class="half-width">
<p>To illustrate the centrality of these problems, let’s imagine the
following scenario:</p>
<p>You’re poking around your research lab’s collaborative drive when you
find a folder containing data, code and some notes from a former
postdoctoral researcher. They were investigating patterns in the
emissions intensity of electricity production in Puerto Rico as
exploratory work for a potential research project, but wound up pursuing
another idea instead.</p>
<p>As you prepare for your qualifying exams, you’re interested in
picking up on their work and developing it further. You find the
<code>data</code> folder that the postdoc was using to store data inputs
to his model. It’s a bit of a mess!</p>
<p>Every file in the folder has the same name (“eia923_2022”) but a
different file extension. To make sense of this undocumented pile of
files, we’ll need to read in each file and compare them.</p>
</section><section><h2 class="section-heading" id="eia-923-data">EIA 923 data<a class="anchor" aria-label="anchor" href="#eia-923-data"></a>
</h2>
<hr class="half-width">
<p>The Energy Information Administration (EIA)’s <a href="https://www.eia.gov/electricity/data/eia923" class="external-link">Form 923</a> is known
as the Power Plant Operations Report. The data include electric power
generation, energy source consumption, end of reporting period fossil
fuel stocks, as well as the quality and cost of fossil fuel receipts at
the power plant and prime mover level (with a subset of +10MW
steam-electric plants reporting at the boiler and generator level).
Information is available for non-utility plants starting in 1970 and
utility plants beginning in 1999. The Form EIA-923 has evolved over the
years, beginning as an environmental add-on in 2007 and ultimately
eclipsing the information previously recorded in EIA-906, EIA-920, FERC
423, and EIA-423 by 2008.</p>
<p>Given your interest in generation and fuel consumption data for your
research, the EIA Form 923 data is a great starting point for data
exploration.</p>
</section><section><h2 class="section-heading" id="get-ready">Get ready<a class="anchor" aria-label="anchor" href="#get-ready"></a>
</h2>
<hr class="half-width">
<p>Open up the notebook for this lesson by running</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">$</span> uv run jupyter notebook</span></code></pre>
</div>
<p>from the <code>open-energy-data-for-all</code> directory. Then in the
Jupyter browser, open
<code>notebooks/2-diverse-filetypes.ipynb</code>.</p>
<div id="accordionInstructor2" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor2" aria-expanded="false" aria-controls="collapseInstructor2">
  <h3 class="accordion-header" id="headingInstructor2">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Instructor Note </h3>
</button>
<div id="collapseInstructor2" class="accordion-collapse collapse" data-bs-parent="#accordionInstructor2" aria-labelledby="headingInstructor2">
<div class="accordion-body">
<p>Remind people of the setup instructions: <a href="https://docs.catalyst.coop/open-energy-data-for-all/#setup" class="external-link uri">https://docs.catalyst.coop/open-energy-data-for-all/#setup</a>
Ask for a green sticky or check mark when everyone has completed this
step. If after a few minutes people are still having trouble, ask them
to message one of the helpers for support. Give them the option to debug
in a seperate room if needed, or follow along without coding.</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="reading-excel-files-with-pandas">Reading Excel files with Pandas<a class="anchor" aria-label="anchor" href="#reading-excel-files-with-pandas"></a>
</h2>
<hr class="half-width">
<p>One of the most popular libraries used to work with tabular data in
Python is called the <a href="https://pandas.pydata.org/" class="external-link">Python Data
Analysis Library</a> (or simply, Pandas). Pandas has functions to handle
reading in a diversity of file types, from CSVs and Excel spreadsheets
to more complex data formats such as XML and Parquet. Each read function
offers a variety of parameters designed to handle common complexities
specific to the file type on import. For a refresher on Pandas, Pandas
DataFrames and reading in files, see the <a href="https://datacarpentry.github.io/python-ecology-lesson/instructor/02-starting-with-data.html" class="external-link">Starting
with Data</a> lesson.</p>
<div id="accordionInstructor3" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor3" aria-expanded="false" aria-controls="collapseInstructor3">
  <h3 class="accordion-header" id="headingInstructor3">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Instructor Note </h3>
</button>
<div id="collapseInstructor3" class="accordion-collapse collapse" data-bs-parent="#accordionInstructor3" aria-labelledby="headingInstructor3">
<div class="accordion-body">
<p>We recommend skipping the below call-out unless people run into
filepath issues.</p>
</div>
</div>
</div>
</div>
<div id="identifying-file-paths" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div id="identifying-file-paths" class="callout-inner">
<h3 class="callout-title">Identifying file paths</h3>
<div class="callout-content">
<p>In order to read data into Pandas or any Python function, we’ll need
to identify the <em>path</em> to that file. The path tells the code
where that file lives. There are two ways to specify the path to any
file on your computer:</p>
<ul>
<li>
<strong>Absolute path</strong>: An absolute path specifies a
location from the root of the filesystem.</li>
<li>
<strong>Relative path</strong>: A relative path specifies a location
starting from the current location. The relative path is just a subset
of the absolute path.</li>
</ul>
<p>For example, to get to the <code>eia923_2022.json</code> file in the
<code>data</code> folder from a notebook in the
<code>open-energy-data-for-all</code> folder, we can either specify:</p>
<ul>
<li>
<strong>Absolute path</strong>:
<code>/home/user/Desktop/path/to/open-energy-data-for-all/folder/data/eia923_2022.json</code>
</li>
<li>
<strong>Relative path</strong>:
<code>data/eia923_2022.json</code>
</li>
</ul>
</div>
</div>
</div>
<div class="section level3">
<h3 id="handling-spreadsheet-formatting-on-read-in">Handling spreadsheet formatting on read-in<a class="anchor" aria-label="anchor" href="#handling-spreadsheet-formatting-on-read-in"></a>
</h3>
<p>Of all the files in the <code>data</code> folder, you decide to start
with the Excel spreadsheet. To read in an Excel spreadsheet using
<code>pandas</code>, you will use the <code>read_excel()</code>
function:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>pd.read_excel(<span class="st">'data/eia923_2022.xlsx'</span>)</span></code></pre>
</div>
<p>That took a while! Luckily,<code>read_excel()</code> offers built-in
functionality to handle various Excel formatting challenges. Let’s see
if there’s a way to quickly explore a smaller subset of the data. While
we can always look up documentation online, we can also access a
function’s documentation right in Python. To identify which parameter
might be able to help us, we can use the <code>help()</code> function to
pull up the function documentation:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="bu">help</span>(pd.read_excel)</span></code></pre>
</div>
<p>For each parameter, the documentation provides the name of the
parameter, the format for the parameter input (e.g., list, string, int),
the default value if no value is provided, and an explanation of what
the parameter does.</p>
<p>We can see that the <code>nrows</code> parameter provides the
following documentation:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>nrows : int, default None
    Number of rows to parse.</code></pre>
</div>
<p>So, if we only want to parse the first 100 rows of the data, we can
call:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>pd.read_excel(<span class="st">'data/eia923_2022.xlsx'</span>, nrows<span class="op">=</span><span class="dv">100</span>)</span></code></pre>
</div>
<p>That’s better. But unfortunately, something doesn’t look quite right!
When opening the file in a spreadsheet software, you see that the first
few rows look like this:</p>
<div id="accordionInstructor4" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor4" aria-expanded="false" aria-controls="collapseInstructor4">
  <h3 class="accordion-header" id="headingInstructor4">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Instructor Note </h3>
</button>
<div id="collapseInstructor4" class="accordion-collapse collapse" data-bs-parent="#accordionInstructor4" aria-labelledby="headingInstructor4">
<div class="accordion-body">
<p>Go ahead and open the <code>eia923_2022.xlsx</code> file in your
local spreadsheet software (e.g., Excel, OpenOffice).</p>
</div>
</div>
</div>
</div>
<figure><img src="../fig/excelheader.png" alt="Snapshot of the Excel file showing the first 6 rows contain metadata, blank spaces and column names." class="figure mx-auto d-block"><div class="figcaption">The first few rows of the eia923_2022.xlsx
file</div>
</figure><p>To read the spreadsheet in correctly, we want to ignore these first
five rows.</p>
<div id="challenge-1-handling-excel-formatting-on-read-in" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="challenge-1-handling-excel-formatting-on-read-in" class="callout-inner">
<h3 class="callout-title">Challenge 1: handling Excel formatting on
read-in</h3>
<div class="callout-content">
<p>Looking at the documentation for <code>pd.read_excel()</code>,
identify the parameter needed to ignore the first few rows of the
spreadsheet. Then, using <code>pd.read_excel()</code>, read in the
<code>eia923_2022.xlsx</code> file using this parameter to skip any rows
that don’t contain the column headers. Store the result in a variable
called <code>eia923_excel_df</code>.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>eia923_excel_df <span class="op">=</span> pd.read_excel(<span class="st">'data/eia923_2022.xlsx'</span>, skiprows<span class="op">=</span><span class="dv">5</span>)</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Each row contains monthly generation data for each plant’s prime
mover. While a subset of plants fill out Form 923 at the boiler and
generator, a large proportion of plants only report at this more
aggregated level. For more on the nuances of the Form 923 data, see
PUDL’s <a href="https://catalystcoop-pudl.readthedocs.io/en/latest/data_sources/eia923.html" class="external-link">data
source page for EIA-923</a>.</p>
</div>
</section><section><h2 class="section-heading" id="reading-in-json-files">Reading in JSON files<a class="anchor" aria-label="anchor" href="#reading-in-json-files"></a>
</h2>
<hr class="half-width">
<p>JavaScript Object Notation (JSON) is a lightweight file format based
on name-value pairs, similar to Python dictionaries. JSON is often used
to send data to and from web applications, and is one of the most common
formats available when you’re accessing data from an Application
Programming Interface (API). JSON data can be found saved as either
<code>.json</code> or <code>.txt</code> files.</p>
<div class="section level3">
<h3 id="nested-content-in-json-files">Nested content in JSON files<a class="anchor" aria-label="anchor" href="#nested-content-in-json-files"></a>
</h3>
<p>Pandas <code>read_*()</code> methods assume tabular data. When a JSON
file represents a table and nothing else, we can use
<code>pd.read_json()</code> to read it in directly. Most often, we know
a JSON file contains a table when we see a list of dictionaries, or a
dictionary of lists.</p>
<p>However, JSON is a flexible format, and JSON files can be organized
all kinds of ways. Unlike Excel or CSV spreadsheets, many JSON files
don’t just contain a table. Instead, most JSONs contain data in a
<em>nested</em> format.</p>
<p>Nested JSON contains multiple levels of data:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>{
  "response": {
    "data": [
      {
        "period": "2022-12",
        "plantCode": "6761"
      },
      {
        "period": "2022-12",
        "plantCode": "54152"
      }
    ]
  }
}</code></pre>
</div>
<p>To successfully extract tabular data from nested JSON, we need to
identify which part of the structure contains the tabular data we’re
looking for. Here, the <code>response</code> contains another name-value
pair called <code>data</code>, and <code>data</code> contains a list
with two records, each of which has two name-value pairs
(<code>period</code> and <code>plantCode</code>).</p>
<p>The <code>data</code> contained in this JSON file can be represented
as a table! In this case, each dictionary corresponds to one row of the
data, and each name (e.g., “period”) corresponds to a column name. This
is the “list of dictionaries” approach to expressing a table in JSON
format that we mentioned above.</p>
<div id="callout2" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div class="callout-inner">
<div class="callout-content">
<p>JSONs can include many levels of nesting, including different levels
of nesting for similar records or other formatting that doesn’t obey the
principles of tabular structure (where each row represents a single
record, and each column represents a single variable). We focus on
extracting tabular data from these nested JSONs in this lesson, but some
JSON files may not contain tabular data at all.</p>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="reading-in-json-files-using-json-load">Reading in JSON files using <code>json.load()</code>
<a class="anchor" aria-label="anchor" href="#reading-in-json-files-using-json-load"></a>
</h3>
<p>To better visualize our JSON file, let’s read it into Python without
changing its format. To do this, we use the <code>json</code> package,
and the <code>load</code> method.</p>
<p>While Pandas handles opening a file in the <code>read_*()</code>
methods, <code>json.load()</code> does not - so, we first need to read
the file into Python. To do so, we use the <code>open()</code>
function.</p>
<div id="accordionInstructor5" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor5" aria-expanded="false" aria-controls="collapseInstructor5">
  <h3 class="accordion-header" id="headingInstructor5">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Instructor Note </h3>
</button>
<div id="collapseInstructor5" class="accordion-collapse collapse" data-bs-parent="#accordionInstructor5" aria-labelledby="headingInstructor5">
<div class="accordion-body">
<p>We recommend skipping the below call-out unless students ask more
about what’s actually going on or you’re ahead on schedule - it’s an
aside that we don’t necessarily need to get into.</p>
</div>
</div>
</div>
</div>
<div id="callout3" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div class="callout-inner">
<div class="callout-content">
<p>When we <code>open()</code> a file in Python, we should always close
it after we’ve extracted the data we need. Closing a file frees up
system resources and ensures that we aren’t accidentally modifying our
original file.</p>
<p>To automatically handle file opening and closing, we use a
<em>context manager</em>. Using the word <code>with</code>, we put all
the code we want to run on the opened file into an indented block.</p>
</div>
</div>
</div>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'data/eia923_2022.json'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>    eia923_json <span class="op">=</span> json.load(<span class="bu">file</span>)</span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>eia923_json</span></code></pre>
</div>
<p>The first part of the result looks like this:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>{'response': {'warnings': [{'warning': 'incomplete return',
    'description': 'The API can only return 5000 rows in JSON format.  Please consider constraining your request with facet, start, or end, or using offset to paginate results.'},
   {'warning': 'another warning', 'description': 'Hey! Watch out!'}],
  'total': '6949',
  'dateFormat': 'YYYY-MM',
  'frequency': 'monthly',
  'data': [{'period': '2020-11',
    'plantCode': '61034',
    'plantName': 'EcoElectrica',
    'fuel2002': 'ALL',
    'fuelTypeDescription': 'Total',
    'state': 'PR',
    'stateDescription': None,
    'primeMover': 'ALL',
    'generation': '299985',
    'gross-generation': '314449',
    'generation-units': 'megawatthours',
    'gross-generation-units': 'megawatthours'},
    ...</code></pre>
</div>
<p>By using <code>json.load()</code>, we’ve read our file into a Python
dictionary. Now, we can use <code>.keys()</code> to see a list of all
the keys in the first level of the dictionary - this is a quick and
helpful way to get a sense for what is contained in different parts of
the JSON file, without having to scroll through the entire output.</p>
<p>To see the value of any particular key, we can call it in square
brackets by name:</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>eia923_json[<span class="st">'response'</span>]</span></code></pre>
</div>
<p>This returns yet another dictionary with a list of keys. To look more
closely at the <code>warnings</code> the file contains, we can add
another square bracket:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>eia923_json[<span class="st">'response'</span>][<span class="st">'warnings'</span>]</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[{'warning': 'incomplete return',
  'description': 'The API can only return 5000 rows in JSON format.  Please consider constraining your request with facet, start, or end, or using offset to paginate results.'},
 {'warning': 'another warning', 'description': 'Hey! Watch out!'}]</code></pre>
</div>
<p>Now that we’ve found the path to our data table in the JSON file, we
can use <code>pd.DataFrame()</code> to transform it into a Pandas
DataFrame:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>pd.DataFrame(eia923_json[<span class="st">'response'</span>,<span class="st">'warnings'</span>])</span></code></pre>
</div>
<p>The function returns a DataFrame that looks like this:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>|           warning |                                       description |
|------------------:|--------------------------------------------------:|
| incomplete return | The API can only return 5000 rows in JSON form... |
|   another warning |                                   Hey! Watch out! |</code></pre>
</div>
<p>The first row of this table is letting us know that when the postdoc
queried and saved this data from the API, he only got the first 5,000
rows of data. We’ll tackle this problem in a later episode, but for now
let’s investigate the data that we do have saved locally.</p>
<div id="challenge-2-find-that-table" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="challenge-2-find-that-table" class="callout-inner">
<h3 class="callout-title">Challenge 2: find that table!</h3>
<div class="callout-content">
<p>Fill in the blanks in the code below to read in the <code>data</code>
from the <code>eia923_2022.json</code> file into a Pandas DataFrame.</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'data/eia923_2022.json'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>    eia923_json <span class="op">=</span> ...</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>eia923_json_df <span class="op">=</span> pd.DataFrame(eia923_json[...])</span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionHint1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint1" aria-expanded="false" aria-controls="collapseHint1">
  <h4 class="accordion-header" id="headingHint1"> Give me a hint </h4>
</button>
<div id="collapseHint1" class="accordion-collapse collapse" data-bs-parent="#accordionHint1" aria-labelledby="headingHint1">
<div class="accordion-body">
<p>First, read in the file using <code>open()</code> and
<code>json.load()</code>. Once you’ve read in the file, you can iterate
through the <code>.keys()</code> of the dictionary to find the path to
the <code>data</code> portion of the file.</p>
</div>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'data/eia923_2022.json'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a>    eia923_json <span class="op">=</span> json.load(<span class="bu">file</span>)</span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a>eia923_json_df <span class="op">=</span> pd.DataFrame(eia923_json[<span class="st">'response'</span>][<span class="st">'data'</span>])</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="deciphering-xml">Deciphering XML<a class="anchor" aria-label="anchor" href="#deciphering-xml"></a>
</h2>
<hr class="half-width">
<p>eXtensible Markup Language (XML) is a plain text file that uses tags
to describe the structure and content of the data they contain. For
example, the following might be a way to represent a note from Saul R.
Panel to Dr. Watts apologizing for leaving the project in an incomplete
state:</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">XML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode xml" tabindex="0"><code class="sourceCode xml"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>&lt;<span class="kw">note</span>&gt;</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>  &lt;<span class="kw">from</span>&gt;Saul R. Panel&lt;/<span class="kw">from</span>&gt;</span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>  &lt;<span class="kw">to</span>&gt;Dr. Watts&lt;/<span class="kw">to</span>&gt;</span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a>  &lt;<span class="kw">heading</span>&gt;Note about project&lt;/<span class="kw">heading</span>&gt;</span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a>  &lt;<span class="kw">body</span>&gt;Sorry for leaving the project in an incomplete state!&lt;/<span class="kw">body</span>&gt;</span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a>&lt;/<span class="kw">note</span>&gt;</span></code></pre>
</div>
<p>In JSON, the equivalent information could be formatted as:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>{
  "note": {
    "from": "Saul R. Panel",
    "to": "Dr. Watts",
    "heading": "Note about project",
    "body": "Sorry for leaving the project in an incomplete state!"
  }
}</code></pre>
</div>
<p>Like other markup languages (e.g., HTML), XML wraps around data,
providing information about the structure, format, and relationships
between components. Each tag provides metadata about what the piece of
data it contains represents - for instance <code>&lt;row&gt;</code> will
contain a row of data, while
<code>&lt;plantCode&gt;243&lt;/plantCode&gt;</code> will means that the
plant code is 243.</p>
<p>Each tag in XML shares similarities with a key in a JSON file: - both
provide metadata about what the corresponding value <em>is</em> (e.g., a
note, net generation in watts) - both provide information about nested
relationships (e.g., the note contains a heading and a body)</p>
<p>However, unlike JSON, XML tags: - can have additional attributes
(e.g.,
<code>&lt;data type="float" precision=3 variable_name="net-generation-mw"&gt;3.142&lt;/data&gt;</code>),
providing a way to share more complex metadata about a given data point
and to search for tags matching additional filters (e.g., all data with
a particular variable name).</p>
<p>While XML is harder and slower to read than JSON, it also has more
capabilities. You might be likely to see an XML file if the data you’re
looking at:</p>
<ul>
<li>is old! XML was invented in 1998 and is still widely in use in older
data distribution methods.</li>
<li>has deeply nested hierarchies of relationships, like FERC’s
accounting data.</li>
<li>is large and complex! For instance, JSON can only handle strings,
numbers and booleans, while XML can also be used to share images, charts
and graphs.</li>
<li>is distributed through an RSS feed. For instance, FERC publishes
filings on a rolling basis using an RSS feed and the XML data
format.</li>
</ul></section><section><h2 class="section-heading" id="using-pd-read_xml">Using <code>pd.read_xml()</code>
<a class="anchor" aria-label="anchor" href="#using-pd-read_xml"></a>
</h2>
<hr class="half-width">
<p>Like with our other data types, we can use <code>pd.read_xml()</code>
to parse XML files into Pandas DataFrames. <code>pd.read_xml()</code> is
designed to ingest tabular data nested in XML files, not to coerce
highly nested data into a table format. To use this method, we’ll need
to identify where in our XML file the data is structured into a
table-like format and can be easily extracted to a DataFrame. For more
on <code>pd.read_xml()</code>, see the <a href="https://pandas.pydata.org/docs/reference/api/pandas.read_xml.html#pandas.read_xml#notes" class="external-link">Pandas
documentation</a>.</p>
<p>Let’s try to explore the XML file that the postdoc left behind:</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a>pd.read_xml(<span class="st">'data/eia923_2022.xml'</span>)</span></code></pre>
</div>
<p>Hm, that doesn’t look quite right. Each tag has been assigned as a
column name, and the value inside has been added as a row.</p>
<p>If we open up the XML file in a text editor or browser, we can see
that a nested series of tags can help us identify the part of the table
we want to read in.</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">XML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode xml" tabindex="0"><code class="sourceCode xml"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a>&lt;<span class="kw">response</span>&gt;</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>    &lt;<span class="kw">warnings</span>&gt;</span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a>        &lt;<span class="kw">row</span>&gt;</span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a>            &lt;<span class="kw">warning</span>&gt;incomplete return&lt;/<span class="kw">warning</span>&gt;</span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a>            &lt;<span class="kw">description</span>&gt;The API can only return 300 rows in XML format.  Please consider constraining your request with facet, start, or end, or using offset to paginate results.&lt;/<span class="kw">description</span>&gt;</span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a>        &lt;/<span class="kw">row</span>&gt;</span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a>        &lt;<span class="kw">row</span>&gt;</span>
<span id="cb20-8"><a href="#cb20-8" tabindex="-1"></a>            &lt;<span class="kw">warning</span>&gt;another warning&lt;/<span class="kw">warning</span>&gt;</span>
<span id="cb20-9"><a href="#cb20-9" tabindex="-1"></a>            &lt;<span class="kw">description</span>&gt;Hey! Watch out!&lt;/<span class="kw">description</span>&gt;</span>
<span id="cb20-10"><a href="#cb20-10" tabindex="-1"></a>        &lt;/<span class="kw">row</span>&gt;</span>
<span id="cb20-11"><a href="#cb20-11" tabindex="-1"></a>    &lt;/<span class="kw">warnings</span>&gt;</span>
<span id="cb20-12"><a href="#cb20-12" tabindex="-1"></a>    &lt;<span class="kw">total</span>&gt;6949&lt;/<span class="kw">total</span>&gt;</span>
<span id="cb20-13"><a href="#cb20-13" tabindex="-1"></a>    &lt;<span class="kw">dateFormat</span>&gt;YYYY-MM&lt;/<span class="kw">dateFormat</span>&gt;</span>
<span id="cb20-14"><a href="#cb20-14" tabindex="-1"></a>    &lt;<span class="kw">frequency</span>&gt;monthly&lt;/<span class="kw">frequency</span>&gt;</span>
<span id="cb20-15"><a href="#cb20-15" tabindex="-1"></a>    ...</span></code></pre>
</div>
<p>For example, the same warnings table we were working with before is
in the <response> tag, then the <warnings> tag. Each row of the data is
also wrapped in a <row> tag.</row></warnings></response></p>
<p>To drill down to the section of the file we are actually interested
in, we can use the <code>xpath</code> parameter, which lets you use tags
to specify where in the XML file to look for a table.</p>
<p>The <code>xpath</code> query we’re looking for is formatted as
follows:</p>
<ul>
<li>// are used at the beginning to note that we want to select all
items with the tags specified</li>
<li>Then, like specifying which directory we want to access in a
terminal, slashes are used to specify the path to the desired tag.</li>
</ul>
<p>So to get all the <code>&lt;row&gt;</code>s of the
<code>&lt;warnings&gt;</code> table, we call:</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a>pd.read_xml(<span class="st">'data/eia923_2022.xml'</span>, xpath <span class="op">=</span> <span class="st">"//response/warnings/row"</span>)</span></code></pre>
</div>
<div id="challenge-3-reading-in-xml-data" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="challenge-3-reading-in-xml-data" class="callout-inner">
<h3 class="callout-title">Challenge 3: Reading in XML data</h3>
<div class="callout-content">
<p>Read in all the rows of the <code>data</code> table in
<code>eia923_2022.xml</code> into a Pandas DataFrame, using
<code>pd.read_xml</code> and the <code>xpath</code> parameter. Store the
result in a variable called <code>eia923_xml_df</code>.</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">PY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode py" tabindex="0"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a>eia923_xml_df <span class="op">=</span> pd.read_xml(<span class="st">'data/eia923_2022.xml'</span>, xpath <span class="op">=</span> <span class="st">"//response/data/row"</span>)</span></code></pre>
</div>
<p>The data is found following the following tags:
<code>&lt;response&gt;&lt;data&gt;&lt;row&gt;</code></p>
<p>The <code>&lt;data&gt;</code> is split into two seperate chunks of
data seperated by <code>&lt;row&gt;</code> tags, which tells us that
everything between these tags corresponds to a single row of data. Then,
we know that the <code>&lt;period&gt;</code>,
<code>&lt;plantCode&gt;</code> and <code>&lt;plantName&gt;</code> tags
are telling us what variable the values correspond to - or in other
words, what the column name is that corresponds to each tag. We use the
xpath parameter to grab all <code>&lt;row&gt;</code>’s of data in the
XML file.</p>
</div>
</div>
</div>
</div>
<div id="callout4" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div class="callout-inner">
<div class="callout-content">
<p><code>xpath</code> can be used to make more complex queries (e.g.,
only picking <code>&lt;note&gt;</code>’s written after a certain date),
but we won’t cover more advanced usage of <code>xpath</code> in this
tutorial. See this <a href="https://carpentries-incubator.github.io/lc-webscraping/02-xpath/index.html" class="external-link">Library
Carpentries tutorial</a> for more about <code>xpath</code>.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="pd-read_parquet">
<code>pd.read_parquet()</code><a class="anchor" aria-label="anchor" href="#pd-read_parquet"></a>
</h2>
<hr class="half-width">
<p>There’s one more file left in the <code>data</code> folder the
postdoc left behind - a Parquet file! You can think of Parquet files as
spreadsheet storage optimized for computers. Like an Excel file, it’s
very difficult for a human to read the plain text of the file, as it is
designed to be read efficiently by software.</p>
<p>Parquet files: - are designed to efficiently process and store large
volumes of data, making them about 50x faster than using
<code>pd.read_csv()</code> on comparable file sizes. - are saved with
data organized into chunks (e.g., one chunk per month), making it
possible to quickly load data from some part of the dataset without
loading everything into memory. - are supported by many existing tools,
including <code>Pandas</code>.</p>
<div id="callout5" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div class="callout-inner">
<div class="callout-content">
<p>To get into the technical weeds of Parquet files, see the <a href="https://parquet.apache.org/docs/overview/" class="external-link">Parquet
documentation</a>. For a desktop viewer similar to Excel, we recommend
checking out <a href="https://www.tadviewer.com/" class="external-link">Tad</a>.</p>
</div>
</div>
</div>
<p>We can read a Parquet file to a Pandas DataFrame using
<code>pd.read_parquet()</code>, almost identical to how we would read in
a CSV:</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">PY<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode py" tabindex="0"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a>eia923_parquet_df <span class="op">=</span> pd.read_parquet(<span class="st">'data/eia923_2022.parquet'</span>)</span></code></pre>
</div>
<div id="accordionInstructor6" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor6" aria-expanded="false" aria-controls="collapseInstructor6">
  <h3 class="accordion-header" id="headingInstructor6">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Instructor Note </h3>
</button>
<div id="collapseInstructor6" class="accordion-collapse collapse" data-bs-parent="#accordionInstructor6" aria-labelledby="headingInstructor6">
<div class="accordion-body">
<p>Below is an optional challenge that is likely to get cut for time. It
is intended to refresh students’ data exploration skills, and build
intuition around comparing datasets. Plus, it’s a nice ice-breaker. This
may be appropriate if you’re only teaching the first two episodes, or if
you’re particularly interested in developing the data exploration and
comparison skills of your cohort.</p>
</div>
</div>
</div>
</div>
<div id="challenge-4-comparing-datasets" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="challenge-4-comparing-datasets" class="callout-inner">
<h3 class="callout-title">Challenge 4: Comparing datasets</h3>
<div class="callout-content">
<p>Pick two datasets we’ve just read in, and compare them. How are they
similar, and how are they different? Share your reflections with a
peer.</p>
</div>
</div>
</div>
<div id="accordionHint2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint2" aria-expanded="false" aria-controls="collapseHint2">
  <h4 class="accordion-header" id="headingHint2"> Give me a hint </h4>
</button>
<div id="collapseHint2" class="accordion-collapse collapse" data-bs-parent="#accordionHint2" aria-labelledby="headingHint2">
<div class="accordion-body">
<ul>
<li>
<code>df.info()</code> provides a high level summary of the data,
including the columns available, their data types, the number of
non-null values in each column, and the overall number of rows in the
DataFrame.</li>
<li>Inspect a column in a DataFrame <code>df</code> by using
<code>df[column_name]</code>.</li>
<li>To quickly see what values are contained in a column, you can use
<code>df[column_name].unique()</code> to get a list of unique values in
the column.</li>
<li>Try using <code>df.iloc[0]</code> to get the values from the first
row of the data.</li>
<li>
<code>df.head(n)</code> returns the first n rows of the data, and
<code>df.tail(n)</code> returns the last n rows.</li>
</ul>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<span class="callout-header">Key Points</span>
<div class="callout-inner">
<div class="callout-content">
<ul>
<li>
<code>pandas</code> has functionality to read in many data formats
(e.g., XML, JSON, Parquet) into Pandas DataFrames in Python. We can take
advantage of this to transform many kinds of structured and
semi-structured data into similarly formatted data.</li>
<li>The <code>help</code> function can be used to access function
documentation, providing avenues to resolve problems on import of
various data types.</li>
<li>When semi-structured data contains tabular data, we can extract the
tabular data into a Pandas Dataframe.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-accessing-remote-data"><p>Content from <a href="accessing-remote-data.html">Accessing remote data</a></p>
<hr>
<p>Last updated on 2025-06-25 |

        <a href="https://github.com/catalyst-cooperative/open-energy-data-for-all/edit/main/episodes/accessing-remote-data.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 0 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I consistently work with the most up-to-date data
available?</li>
<li>How can I work with data from a web API?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Read remote files into <code>pandas</code> dataframes</li>
<li>Investigate the inputs to and outputs from an API</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="introduction-to-remote-data">Introduction to remote data<a class="anchor" aria-label="anchor" href="#introduction-to-remote-data"></a>
</h2>
<hr class="half-width">
<div id="accordionInstructor1" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor1" aria-expanded="false" aria-controls="collapseInstructor1">
  <h3 class="accordion-header" id="headingInstructor1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Instructor Note </h3>
</button>
<div id="collapseInstructor1" class="accordion-collapse collapse" aria-labelledby="headingInstructor1" data-bs-parent="#accordionInstructor1">
<div class="accordion-body">
<p>Prep checklist:</p>
<ul class="task-list">
<li><label><input type="checkbox">make a sticky note that includes the
research question: “What was the net electricity generation from natural
gas, plant-by-plant, in Puerto Rico from 2020-2023?”</label></li>
</ul>
</div>
</div>
</div>
</div>
<p>Often times you will want to read data that’s not already on your
computer. Whether that’s data that’s stored in a cloud bucket like
Amazon S3, data that’s behind a Web API, or just data that’s on the EIA
website, we can use a common suite of tools to access this
<strong>remote data</strong>. We’ll show you how.</p>
</section><section><h2 class="section-heading" id="reading-remote-files">Reading remote files<a class="anchor" aria-label="anchor" href="#reading-remote-files"></a>
</h2>
<hr class="half-width">
<div class="section level3">
<h3 id="using-requests">Using <code>requests</code>
<a class="anchor" aria-label="anchor" href="#using-requests"></a>
</h3>
<p>The <a href="https://requests.readthedocs.io/en/latest/user/quickstart/" class="external-link"><code>requests</code>
library</a> is the general way of working with remote data within
Python. It lets us download files from URLs, and also will be a
fundamental piece of how we work with Web APIs. Let’s import it, and set
up a URL to work with a JSON file. This file includes a bunch of data
from EIA 923 in JSON format.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>json_example_url <span class="op">=</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co">"https://raw.githubusercontent.com/catalyst-cooperative/open-energy-data-for-all/refs/heads/main/data/eia923_2022.json"</span></span></code></pre>
</div>
<p>To read a URL we use the <a href="https://requests.readthedocs.io/en/latest/api/#requests.get" class="external-link"><code>requests.get()</code>
method</a>, which returns a <a href="https://requests.readthedocs.io/en/latest/api/#requests.Response" class="external-link"><code>requests.Response</code>
object</a>. Let’s try using it!</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>response <span class="op">=</span> requests.get(json_example_url)</span></code></pre>
</div>
<p>The <code>Response</code> object has many useful methods and
properties - see <code>help(response)</code>. We’ll focus on three: *
<code>response.status_code</code>, which shows you a high level status
of what happened * <code>response.text</code>, which shows you the full
response * <code>response.json()</code>, which parses the response text
into a Python list or dictionary, assuming the response is indeed in
JSON.</p>
<p>First, let’s check out <code>response.status_code</code>. This shows
the <a href="https://en.wikipedia.org/wiki/List_of_HTTP_status_codes" class="external-link">HTTP
status code</a> - it’s a three digit number that tells you how the
request went. For example, if you make a request for something that
doesn’t exist, you’ll get a <code>404</code> status code.</p>
<p>In general, status codes that start with <code>2</code> mean
everything went fine; <code>4xx</code> means you messed up somehow;
<code>5xx</code> means the computer that’s responding to your request
ran into some sort of error. Or, <code>4xx</code> is your fault,
<code>5xx</code> is their fault.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>response.status_code</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="fl">200</span></span></code></pre>
</div>
<p>Great, the request wasn’t a total failure! Now let’s check to see
what the content looks like:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>response.text</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>'{"response":{"warnings":[{"warning":"incomplete return","description":"The API can only return 5000 '...</code></pre>
</div>
<p>Looks like JSON to me! We could parse that text ourselves, but we
might as well just use the built-in functionality of
<code>response.json()</code>.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>eia923_2022_json <span class="op">=</span> response.json()</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>eia923_2022_json[<span class="st">"response"</span>][<span class="st">"data"</span>]</span></code></pre>
</div>
<p>This seems to be a list of records, with “period”, “plantCode”,
“plantName”, etc. as columns.</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[{'period': '2020-11',
  'plantCode': '61034',
  'plantName': 'EcoElectrica',
  'fuel2002': 'ALL',
  'fuelTypeDescription': 'Total',
  'state': 'PR',
  'stateDescription': None,
  'primeMover': 'ALL',
  'generation': '299985',
  'gross-generation': '314449',
  'generation-units': 'megawatthours',
  'gross-generation-units': 'megawatthours'},
 {'period': '2020-11',
  'plantCode': '61034',
  'plantName': 'EcoElectrica',
  'fuel2002': 'NG',
  'fuelTypeDescription': 'Natural Gas',
  'state': 'PR',
  'stateDescription': None,
  'primeMover': 'ALL',
  'generation': '299985',
  'gross-generation': '314449',
  'generation-units': 'megawatthours',
  'gross-generation-units': 'megawatthours'},</code></pre>
</div>
<div id="challenge1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p>Can you take the raw XML data at the following URL and turn it into a
string in python?</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>xml_url <span class="op">=</span> <span class="st">"https://raw.githubusercontent.com/catalyst-cooperative/open-energy-data-for-all/refs/heads/main/data/eia923_2022.xml"</span></span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>response <span class="op">=</span> requests.get(xml_url)</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>raw_xml <span class="op">=</span> response.text</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<span class="callout-header">Key Points</span>
<div class="callout-inner">
<div class="callout-content">
<ul>
<li>
<code>requests</code> is useful when you need to access remote
data</li>
<li>
<code>response.status_code</code> tells you if the request succeeded
or why it failed.</li>
<li>
<code>response.text</code> gives you the raw response, if you need
to check that the data is formatted how you expect</li>
<li>
<code>response.json()</code> will parse the response as JSON, which
is handy</li>
</ul>
</div>
</div>
</div>
<div id="discussion1" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<span class="callout-header">Discussion</span>
<div class="callout-inner">
<div class="callout-content">
<p>What are some advantages and disadvantages you can imagine for using
remote data vs. saving the data to your hard drive (aka <strong>local
data</strong>)?</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<p>Some non-exhaustive ideas:</p>
<p>Remote data pros:</p>
<ul>
<li>if someone else updates the data, you always have the most recent
version</li>
<li>you don’t need to manage multiple versions of the same data on your
hard drive</li>
<li>if you send your code to someone else, you don’t also have to
package the data with it</li>
</ul>
<p>Local data pros:</p>
<ul>
<li>you can keep track of different versions of the same data, even if
the publisher doesn’t</li>
<li>you only need to download the data once, and then you can read from
your disk in the future, which is faster</li>
<li>if someone else updates the data, your data doesn’t change until you
actively download a new version</li>
<li>you can access this without internet!</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="intro-to-web-apis">Intro to web APIs<a class="anchor" aria-label="anchor" href="#intro-to-web-apis"></a>
</h2>
<hr class="half-width">
<p>Web APIs - lots of data is locked up behind them, and they can save
you a bunch of work if you know how to use them. Unfortunately, they can
be intimidating to work with and the topic is often shrouded in
mystery.</p>
<p>Fortunately, you already have the basic skills you need to handle
APIs:</p>
<ul>
<li>documentation reading</li>
<li>using <code>requests</code> to interact with URLs</li>
</ul>
<p>This is because every web API is just a fancy bundle of URLs. Here’s
an example.</p>
<div class="section level3">
<h3 id="apis-as-fancy-urls">APIs as fancy URLs<a class="anchor" aria-label="anchor" href="#apis-as-fancy-urls"></a>
</h3>
<p>Suppose someone asks you, “how much natural gas was consumed for
electricity generation, totalled across all sectors, in Puerto Rico, for
each year between 2020 and 2023?”</p>
<p>You <em>could</em> go find the EIA 923 spreadsheets for 2020-2023,
download the individual files, do a bunch of filtering and reshaping of
the data, and get an answer.</p>
<p>But, in this case, the EIA has another way - their web API. Web APIs
are collections of fancy URLs that allow them to be much more flexible
than merely downloading individual files. They can save you a lot of
work, if you become good at using them.</p>
<p>For example, to answer that question, you can request this URL:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>response <span class="op">=</span> requests.get(<span class="st">"https://api.eia.gov/v2/electricity/electric-power-operational-data/data?data[]=consumption-for-eg&amp;facets[fueltypeid][]=NG&amp;facets[sectorid][]=99&amp;facets[location][]=PR&amp;frequency=annual&amp;start=2020&amp;end=2023&amp;api_key=3zjKYxV86AqtJWSRoAECir1wQFscVu6lxXnRVKG8"</span>)</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>response <span class="op">=</span> requests.get(example_api_url)</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>response.json()</span></code></pre>
</div>
<p>Which gives you:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>{'response': {'total': '4',
  'dateFormat': 'YYYY',
  'frequency': 'annual',
  'data': [{'period': '2020',
    'location': 'PR',
    'stateDescription': 'Puerto Rico',
    'sectorid': '99',
    'sectorDescription': 'All Sectors',
    'fueltypeid': 'NG',
    'fuelTypeDescription': 'natural gas',
    'consumption-for-eg': '47834.384',
    'consumption-for-eg-units': 'thousand Mcf'},
   {'period': '2021',
    'location': 'PR',
    'stateDescription': 'Puerto Rico',
    'sectorid': '99',
    'sectorDescription': 'All Sectors',
    'fueltypeid': 'NG',
    'fuelTypeDescription': 'natural gas',
    'consumption-for-eg': '70999.964',
    'consumption-for-eg-units': 'thousand Mcf'},
   {'period': '2022',
    'location': 'PR',
    'stateDescription': 'Puerto Rico',
    'sectorid': '99',
    'sectorDescription': 'All Sectors',
    'fueltypeid': 'NG',
    'fuelTypeDescription': 'natural gas',
    'consumption-for-eg': '50696.82',
    'consumption-for-eg-units': 'thousand Mcf'},
   {'period': '2023',
    'location': 'PR',
    'stateDescription': 'Puerto Rico',
    'sectorid': '99',
    'sectorDescription': 'All Sectors',
    'fueltypeid': 'NG',
    'fuelTypeDescription': 'natural gas',
    'consumption-for-eg': '66022.717',
    'consumption-for-eg-units': 'thousand Mcf'}],
  'description': 'Monthly and annual electric power operations by state, sector, and energy source.\n    Source: Form EIA-923'},
 'request': {'command': '/v2/electricity/electric-power-operational-data/data/',
  'params': {'data': ['consumption-for-eg'],
   'facets': {'fueltypeid': ['NG'], 'sectorid': ['99'], 'location': ['PR']},
   'frequency': 'annual',
   'start': '2020',
   'end': '2023',
   'api_key': '3zjKYxV86AqtJWSRoAECir1wQFscVu6lxXnRVKG8'}},
 'apiVersion': '2.1.8',
 'ExcelAddInVersion': '2.1.0'}</code></pre>
</div>
</div>
<div class="section level3">
<h3 id="the-structure-of-an-api-call">The structure of an API call<a class="anchor" aria-label="anchor" href="#the-structure-of-an-api-call"></a>
</h3>
<p>While that URL can seem impossibly complicated at first, we can break
it down into a few parts:</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>example_api_url <span class="op">=</span> (</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>    <span class="st">"https://api.eia.gov"</span> <span class="co"># "host": the high-level name of the API you're accessing</span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>    <span class="st">"/v2/electricity/electric-power-operational-data/data"</span> <span class="co"># "route": the specific aspect of the API you're accessing</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>    <span class="st">"?"</span> <span class="co"># separator that indicates "everything after this will be a name-value pair"</span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>    <span class="st">"data[]=consumption-for-eg"</span> <span class="co"># name: data[], value: consumption-for-eg ("consumption for electricity generation")</span></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a>    <span class="st">"&amp;"</span> <span class="co"># separator between each pair</span></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a>    <span class="st">"facets[fueltypeid][]=NG"</span> <span class="co"># only natural gas data</span></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a>    <span class="st">"&amp;"</span></span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a>    <span class="st">"facets[sectorid][]=99"</span> <span class="co"># total across all sectors</span></span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a>    <span class="st">"&amp;"</span></span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a>    <span class="st">"facets[location][]=PR"</span> <span class="co"># in Puerto Rico</span></span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a>    <span class="st">"&amp;"</span></span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a>    <span class="st">"frequency=annual"</span> <span class="co"># per year</span></span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a>    <span class="st">"&amp;"</span></span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a>    <span class="st">"start=2020"</span> <span class="co"># starting in 2020</span></span>
<span id="cb13-16"><a href="#cb13-16" tabindex="-1"></a>    <span class="st">"&amp;"</span></span>
<span id="cb13-17"><a href="#cb13-17" tabindex="-1"></a>    <span class="st">"end=2023"</span> <span class="co"># ending in 2023</span></span>
<span id="cb13-18"><a href="#cb13-18" tabindex="-1"></a>    <span class="st">"&amp;"</span></span>
<span id="cb13-19"><a href="#cb13-19" tabindex="-1"></a>    <span class="st">"api_key=3zjKYxV86AqtJWSRoAECir1wQFscVu6lxXnRVKG8"</span> <span class="co"># a password to prove you have access to the API</span></span>
<span id="cb13-20"><a href="#cb13-20" tabindex="-1"></a>)</span></code></pre>
</div>
<div id="callout1" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div class="callout-inner">
<div class="callout-content">
<p>The API key we’re using in this lesson is a public one that EIA
provides, but it would be polite to request your own API key by clicking
the register button on the <a href="https://www.eia.gov/opendata/" class="external-link">EIA
open data portal</a> if you plan on using the API a lot.</p>
<p>Many other APIs will not have a public key, so you’ll have to
register in one way or another to get one.</p>
</div>
</div>
</div>
<p><strong>Every web API behaves differently, but you only need to be
able to do two things to figure any API out:</strong></p>
<ul>
<li>read their documentation</li>
<li>make requests to the API &amp; interpret responses</li>
</ul>
<p>You can read, and you can use <code>requests</code> to make requests.
We’ll walk through building a similarly complicated query as we just
saw, by applying those two skills.</p>
<div id="keypoints2" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<span class="callout-header">Key Points</span>
<div class="callout-inner">
<div class="callout-content">
<ul>
<li>web APIs can be thought of as bundles of fancy URLs</li>
<li>each web API is different, but if you can read the documentation and
make requests to URLs, you can figure them out</li>
</ul>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="case-study-eia-api">Case study: EIA API<a class="anchor" aria-label="anchor" href="#case-study-eia-api"></a>
</h2>
<hr class="half-width">
<p>Let’s take a deeper dive into the EIA API! You can find the <a href="https://www.eia.gov/opendata/documentation.php" class="external-link">API documentation
here</a>. We’ll be flipping back and forth between reading the
documentation (to get ideas for what to try) and making actual API
requests (to understand the actual behavior of the API).</p>
<div id="caution1" class="callout caution">
<div class="callout-square">
<i class="callout-icon" data-feather="alert-triangle"></i>
</div>
<span class="callout-header">Caution</span>
<div class="callout-inner">
<div class="callout-content">
<p>Unfortunately, the EIA API documentation is confusingly formatted and
<em>particularly</em> hard to read. So we will just include screenshots
of the relevant parts.</p>
</div>
</div>
</div>
<p>Let’s focus on a slightly different question than we had before - now
that we know the aggregated information, we want to drill down.</p>
<p><strong>“What was the net electricity generation from natural gas,
plant-by-plant, in Puerto Rico from 2020-2023?”</strong></p>
<div class="section level3">
<h3 id="trying-out-an-api-request">Trying out an API request<a class="anchor" aria-label="anchor" href="#trying-out-an-api-request"></a>
</h3>
<p>Our first goal is to figure out how to start interacting with the
API, and how to map any examples in the documentation to real Python
code.</p>
<p>When scrolling through the documentation, we’ll notice a bunch of
example URLs. Let’s pick a fairly simple one to get started,
<code>https://api.eia.gov/v2/electricity&amp;api_key=xxxxxx</code>:</p>
<p>We’ll need the API key in a lot of places, so we store that in a
variable, and then put it into the URL using an “f-string.”</p>
<div id="callout2" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div class="callout-inner">
<div class="callout-content">
<p>F-strings are a compact way to put variables inside strings - the
following string would output <code>hello world!</code>:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>variable <span class="op">=</span> <span class="st">"world"</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>fstring <span class="op">=</span> <span class="ss">f"hello </span><span class="sc">{</span>variable<span class="sc">}</span><span class="ss">!"</span></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a><span class="bu">print</span>(fstring)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>api_key <span class="op">=</span> <span class="st">"3zjKYxV86AqtJWSRoAECir1wQFscVu6lxXnRVKG8"</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>electricity_response <span class="op">=</span> requests.get(<span class="ss">f"https://api.eia.gov/v2/electricity?api_key=</span><span class="sc">{</span>api_key<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>electricity_response.json()</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>{'response': {'id': 'electricity',
  'name': 'Electricity',
  'description': 'EIA electricity survey data',
  'routes': [{'id': 'retail-sales',
    'name': 'Electricity Sales to Ultimate Customers',
    'description': 'Electricity sales to ultimate customer by state and sector (number of customers, average price, revenue, and megawatthours of sales).  \n    Sources: Forms EIA-826, EIA-861, EIA-861M'},
   {'id': 'electric-power-operational-data',
    'name': 'Electric Power Operations (Annual and Monthly)',
    'description': 'Monthly and annual electric power operations by state, sector, and energy source.\n    Source: Form EIA-923'},
   {'id': 'rto',
    'name': 'Electric Power Operations (Daily and Hourly)',
    'description': 'Hourly and daily electric power operations by balancing authority.  \n    Source: Form EIA-930'},
   {'id': 'state-electricity-profiles',
    'name': 'State Specific Data',
    'description': 'State Specific Data'},
   {'id': 'operating-generator-capacity',
    'name': 'Inventory of Operable Generators',
    'description': 'Inventory of operable generators in the U.S.\n    Source: Forms EIA-860, EIA-860M'},
   {'id': 'facility-fuel',
    'name': 'Electric Power Operations for Individual Power Plants (Annual and Monthly)',
    'description': 'Annual and monthly electric power operations for individual power plants, by energy source and prime mover\n    Source: Form EIA-923'}]},
 'request': {'command': '/v2/electricity/',
  'params': {'api_key': '3zjKYxV86AqtJWSRoAECir1wQFscVu6lxXnRVKG8'}},
 'apiVersion': '2.1.8',
 'ExcelAddInVersion': '2.1.0'}</code></pre>
</div>
<p>It looks like there’s no actual data here… what’s going on? Let’s
take a look at the docs.</p>
<div id="challenge2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p><a href="https://www.eia.gov/opendata/documentation.php#Examiningametadatarequ" class="external-link">In
this section</a>, the docs say:</p>
<blockquote>
<p>Discovering datasets should be much easier in APIv2 because the API
now self-documents and organizes itself in a data hierarchy. Parent
datasets have child datasets, which may have children of their own, and
so on. To investigate what datasets are available, we request a parent
node. The API will respond with the child datasets (routes) for the path
we’ve requested.</p>
</blockquote>
<p>If we’re looking for yearly data about fuel consumption at the plant
level, what route should we request next? Please request it using
<code>requests.get</code> below.</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<p><code>facility-fuel</code>!</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>facility_fuel <span class="op">=</span> requests.get(<span class="ss">f"https://api.eia.gov/v2/electricity/facility-fuel?api_key=</span><span class="sc">{</span>api_key<span class="sc">}</span><span class="ss">"</span>).json()</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>facility_fuel</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>{'response': {'id': 'facility-fuel',
  'name': 'Electric Power Operations for Individual Power Plants (Annual and Monthly)',
  'description': 'Annual and monthly electric power operations for individual power plants, by energy source and prime mover\n    Source: Form EIA-923',
  'frequency': [{'id': 'monthly',
    'description': 'One data point for each month.',
    'query': 'M',
    'format': 'YYYY-MM'},
   {'id': 'quarterly',
    'description': 'One data point every 3 months.',
    'query': 'Q',
    'format': 'YYYY-"Q"Q'},
   {'id': 'annual',
    'description': 'One data point for each calendar year.',
    'query': 'A',
    'format': 'YYYY'}],
  'facets': [{'id': 'plantCode', 'description': 'Plant ID and Name'},
   {'id': 'fuel2002', 'description': 'Energy Source'},
   {'id': 'state', 'description': 'State'},
   {'id': 'primeMover', 'description': 'Prime Mover'}],
  'data': {'generation': {'alias': 'Net Generation', 'units': 'megawatthours'},
   'gross-generation': {'alias': 'Gross Generation', 'units': 'megawatthours'},
   'generation': {'alias': 'Consumption of Fuels for Electricity Generation and Useful Thermal Output (Physical Units)'},
   'generation-btu': {'alias': 'Consumption of Fuels for Electricity Generation and Useful Thermal Output (BTUs)',
    'units': 'MMBtu'},
   'consumption-for-eg': {'alias': 'Consumption of Fuels for Electricity Generation (Physical Units)'},
   'consumption-for-eg-btu': {'alias': 'Consumption of Fuels for Electricity Generation (BTUs)',
    'units': 'MMBtu'},
   'average-heat-content': {'alias': 'Average Heat Content of Consumed Fuels'}},
  'startPeriod': '2001-01',
  'endPeriod': '2024-11',
  'defaultDateFormat': 'YYYY-MM',
  'defaultFrequency': 'monthly'},
 'request': {'command': '/v2/electricity/facility-fuel/',
  'params': {'api_key': '3zjKYxV86AqtJWSRoAECir1wQFscVu6lxXnRVKG8'}},
 'apiVersion': '2.1.8',
 'ExcelAddInVersion': '2.1.0'}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="getting-actual-data">Getting actual data<a class="anchor" aria-label="anchor" href="#getting-actual-data"></a>
</h3>
<p>Requesting <code>electricity/facility-fuel</code> still doesn’t give
us any data, but it seems like we’re getting closer - there’s a
<code>data</code> field in the response, and also some
<code>frequency</code> and <code>facets</code> information that looks
relevant.</p>
<p>What next? Through some more <a href="https://www.eia.gov/opendata/documentation.php#Facets" class="external-link">documentation
reading</a>, we can find some explanation of this <code>data</code>
field and a helpful example URL:</p>
<figure><img src=".././fig/ep-3/data-endpoint.png" alt="Screenshot of documentation, with relevant text reproduced below" class="figure mx-auto d-block"><div class="figcaption">Screenshot of documentation, with relevant text
reproduced below</div>
</figure><blockquote>
<p>In earlier examples, when we asked about the metadata, the API
responded with these available data points [under the ‘data’ key]:</p>
<p>[…]</p>
<p>Remember, in addition to specifying the column in the data[]
parameter, we must also specify /data as the last node in the route:</p>
<p><code>https://api.eia.gov/v2/electricity/retail-sales/data/?api_key=XXXXXX&amp;data[]=price</code></p>
</blockquote>
<p>Given the above example, and the output for the
<code>facility-fuels</code> metadata, we can get the net generation
data:</p>
<p>First, let’s see what data is available using that ‘data’ key they
mentioned:</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a>base_url <span class="op">=</span> <span class="st">"https://api.eia.gov/v2/electricity"</span></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>facility_fuels_metadata <span class="op">=</span> requests.get(<span class="ss">f"</span><span class="sc">{</span>base_url<span class="sc">}</span><span class="ss">/facility-fuel?api_key=</span><span class="sc">{</span>api_key<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a>facility_fuels_metadata.json()[<span class="st">"response"</span>][<span class="st">"data"</span>]</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>{'generation': {'alias': 'Net Generation', 'units': 'megawatthours'},
 'gross-generation': {'alias': 'Gross Generation', 'units': 'megawatthours'},
 'total-consumption': {'alias': 'Consumption of Fuels for Electricity Generation and Useful Thermal Output (Physical Units)'},
 'total-consumption-btu': {'alias': 'Consumption of Fuels for Electricity Generation and Useful Thermal Output (BTUs)',
  'units': 'MMBtu'},
 'consumption-for-eg': {'alias': 'Consumption of Fuels for Electricity Generation (Physical Units)'},
 'consumption-for-eg-btu': {'alias': 'Consumption of Fuels for Electricity Generation (BTUs)',
  'units': 'MMBtu'},
 'average-heat-content': {'alias': 'Average Heat Content of Consumed Fuels'}}</code></pre>
</div>
<p><code>"generation"</code> looks like what we want - let’s try using
it!</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a>net_generation <span class="op">=</span> requests.get(<span class="ss">f"</span><span class="sc">{</span>base_url<span class="sc">}</span><span class="ss">/facility-fuel/data?data[]=generation&amp;api_key=</span><span class="sc">{</span>api_key<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a>net_generation.json()</span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="filtering-the-data">Filtering the data<a class="anchor" aria-label="anchor" href="#filtering-the-data"></a>
</h3>
<p>That data we got above is generation data, but there are still some
problems:</p>
<ul>
<li>it includes all fuel types</li>
<li>it includes all states</li>
<li>it includes all years</li>
<li>it’s monthly, not yearly</li>
</ul>
<p>Let’s tackle these one at a time, starting with the fuel types.</p>
<p>We can read the documentation a bit more, and find <a href="https://www.eia.gov/opendata/documentation.php#Frequency" class="external-link">this
section</a> talking about:</p>
<blockquote>
<p>Facets enable us to filter the data of concern to us, shrinking the
size of the returns to a more manageable size.</p>
<p>For example, our retail sales of electricity has the location and
sector facets. If we query the route (without specifying /data), the API
will tell us the facets that are relevant to that route.</p>
</blockquote>
<p>So we learn two things:</p>
<ol style="list-style-type: decimal">
<li>“facets” is a word associated with filtering your data.</li>
<li>let’s check out that metadata to figure out what facets are
available!</li>
</ol>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a>facility_fuels_metadata.json()[<span class="st">"response"</span>]</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>...
 'facets': [{'id': 'plantCode', 'description': 'Plant ID and Name'},
  {'id': 'fuel2002', 'description': 'Energy Source'},
  {'id': 'state', 'description': 'State'},
  {'id': 'primeMover', 'description': 'Prime Mover'}],
...</code></pre>
</div>
<p>Looks like <code>fuel2002</code> is the facet we want to use… but how
do we use it? ? A quick search in the docs for <code>&amp;facet</code>
will give us this example:</p>
<blockquote>
<p><code>http://api.eia.gov/v2/electricity/retail-sales/data/?api_key=xxxxxx&amp;facets[stateid][]=CO&amp;facets[sectorid][]=RES&amp;frequency=monthly</code></p>
</blockquote>
<p>Let’s try copying this pattern.</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a>gas_only <span class="op">=</span> requests.get(</span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a>    <span class="ss">f"</span><span class="sc">{</span>base_url<span class="sc">}</span><span class="ss">/facility-fuel/data?data[]=generation&amp;facets[fuel2002][]=gas&amp;api_key=</span><span class="sc">{</span>api_key<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a>)</span></code></pre>
</div>
<p>As we accumulate more and more parameters, this starts to get pretty
unwieldy to read - fortunately, <code>requests</code> allows us to pass
in the parameters as a dictionary alongside the request:</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a>gas_only <span class="op">=</span> requests.get(</span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a>    <span class="ss">f"</span><span class="sc">{</span>base_url<span class="sc">}</span><span class="ss">/facility-fuel/data"</span>,</span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a>    params<span class="op">=</span>{</span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a>        <span class="st">"data[]"</span>: <span class="st">"generation"</span>,</span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a>        <span class="st">"facets[fuel2002][]"</span>: <span class="st">"gas"</span>,</span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a>        <span class="st">"api_key"</span>: api_key</span>
<span id="cb25-7"><a href="#cb25-7" tabindex="-1"></a>    },</span>
<span id="cb25-8"><a href="#cb25-8" tabindex="-1"></a>)</span>
<span id="cb25-9"><a href="#cb25-9" tabindex="-1"></a></span>
<span id="cb25-10"><a href="#cb25-10" tabindex="-1"></a>gas_only.json()</span></code></pre>
</div>
<p>It returns this un-helpful empty result, though… maybe “gas” isn’t
the right value to pass in. We’ve reached the limits of guessing again,
time to look at the documentation!</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>{'response': {'total': '0',
  'dateFormat': 'YYYY-MM',
  'frequency': 'monthly',
  'data': [],
  'description': 'Annual and monthly electric power operations for individual power plants, by energy source and prime mover\n    Source: Form EIA-923'},
 'request': {'command': '/v2/electricity/facility-fuel/data/',
  'params': {'data': ['generation'],
   'facets': {'fuel2002': ['gas']},
   'api_key': '3zjKYxV86AqtJWSRoAECir1wQFscVu6lxXnRVKG8'}},
 'apiVersion': '2.1.8',
 'ExcelAddInVersion': '2.1.0'}</code></pre>
</div>
<p>If we look in the docs, there’s a <a href="https://www.eia.gov/opendata/documentation.php#Returningmetadatavssp" class="external-link">section</a>
where we can see an example for figuring out the possible values, which
we can adapt for our needs:</p>
<blockquote>
<p>To determine what the appropriate values for those are, we query on
that facet itself Let’s try asking for all available sectors by
specifying the <code>sectorid</code> facet:</p>
<p><code>https://api.eia.gov/v2/electricity/retail-sales/facet/sectorid/?api_key=xxxxxx</code></p>
</blockquote>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a>fueltypes <span class="op">=</span> requests.get(<span class="ss">f"</span><span class="sc">{</span>base_url<span class="sc">}</span><span class="ss">/facility-fuel/facet/fuel2002?api_key=</span><span class="sc">{</span>api_key<span class="sc">}</span><span class="ss">"</span>).json()</span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a>fueltypes</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>{'response': {'totalFacets': 47,
  'facets': [{'id': 'NG', 'name': 'Natural Gas'},
   {'id': 'LIG', 'name': 'Coal'},
   {'id': 'WDL', 'name': 'Wood Waste Solids'},
   {'id': 'MWH', 'name': 'Other'},
...</code></pre>
</div>
<p>So we can see that the <code>NG</code> value corresponds to “Natural
Gas”. Let’s try again with that:</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a>gas_only <span class="op">=</span> requests.get(</span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a>    <span class="ss">f"</span><span class="sc">{</span>base_url<span class="sc">}</span><span class="ss">/facility-fuel/data"</span>,</span>
<span id="cb29-3"><a href="#cb29-3" tabindex="-1"></a>    params<span class="op">=</span>{</span>
<span id="cb29-4"><a href="#cb29-4" tabindex="-1"></a>        <span class="st">"data[]"</span>: <span class="st">"generation"</span>,</span>
<span id="cb29-5"><a href="#cb29-5" tabindex="-1"></a>        <span class="st">"facets[fuel2002][]"</span>: <span class="st">"NG"</span>,</span>
<span id="cb29-6"><a href="#cb29-6" tabindex="-1"></a>        <span class="st">"api_key"</span>: api_key</span>
<span id="cb29-7"><a href="#cb29-7" tabindex="-1"></a>    },</span>
<span id="cb29-8"><a href="#cb29-8" tabindex="-1"></a>)</span>
<span id="cb29-9"><a href="#cb29-9" tabindex="-1"></a></span>
<span id="cb29-10"><a href="#cb29-10" tabindex="-1"></a>gas_only.json()</span></code></pre>
</div>
<p>It does seem to filter the outputs to only natural gas data!</p>
<div id="challenge3" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p>So we’ve handled the fuel type - let’s split into breakout groups to
handle the other issues with the data:</p>
<ul>
<li>we would like to filter this to Colorado data only</li>
<li>we would like to filter this to data for 2020, 2021, 2022, and
2023</li>
<li>we would like the data to be reported yearly, not monthly</li>
</ul>
<p>For each group, pick one of those bullets and follow these steps:</p>
<ol style="list-style-type: decimal">
<li>Look at the metadata. See what parameters might help you get the
right data back.</li>
<li>Figure out what values you want to pass in.</li>
<li>Try doing that and see if it fixed the problem.</li>
</ol>
<p>Once we’re all done we can come back and make the full API request
together.</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4"> Show me the solution </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" aria-labelledby="headingSolution4" data-bs-parent="#accordionSolution4">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a>annual_ng_pr_2020_2023 <span class="op">=</span> requests.get(</span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a>    <span class="st">"</span><span class="sc">{base_url}</span><span class="st">/facility-fuel/data"</span>,</span>
<span id="cb30-3"><a href="#cb30-3" tabindex="-1"></a>    params<span class="op">=</span>{</span>
<span id="cb30-4"><a href="#cb30-4" tabindex="-1"></a>        <span class="st">"data[]"</span>: <span class="st">"generation"</span>,</span>
<span id="cb30-5"><a href="#cb30-5" tabindex="-1"></a>        <span class="st">"frequency"</span>: <span class="st">"annual"</span>,</span>
<span id="cb30-6"><a href="#cb30-6" tabindex="-1"></a>        <span class="st">"facets[fuel2002][]"</span>: <span class="st">"NG"</span>,</span>
<span id="cb30-7"><a href="#cb30-7" tabindex="-1"></a>        <span class="st">"facets[state][]"</span>: <span class="st">"PR"</span>,</span>
<span id="cb30-8"><a href="#cb30-8" tabindex="-1"></a>        <span class="st">"start"</span>: <span class="st">"2020-01-01"</span>,</span>
<span id="cb30-9"><a href="#cb30-9" tabindex="-1"></a>        <span class="st">"end"</span>: <span class="st">"2023-12-31"</span>,</span>
<span id="cb30-10"><a href="#cb30-10" tabindex="-1"></a>        <span class="st">"api_key"</span>: api_key</span>
<span id="cb30-11"><a href="#cb30-11" tabindex="-1"></a>    },</span>
<span id="cb30-12"><a href="#cb30-12" tabindex="-1"></a>)</span>
<span id="cb30-13"><a href="#cb30-13" tabindex="-1"></a></span>
<span id="cb30-14"><a href="#cb30-14" tabindex="-1"></a>annual_ng_pr_2020_2023.json()</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Now you’ve worked through the documentation, played with an API, and
built up a complicated API query from scratch! And you’ve answered your
earlier question of <strong>“what was the net generation from natural
gas, plant-by-plant, in Puerto Rico from 2020-2023?”</strong></p>
<p>That was a lot of work, but now you’ve gained some experience in the
general skill of API learning which should serve you well.</p>
<div id="keypoints3" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<span class="callout-header">Key Points</span>
<div class="callout-inner">
<div class="callout-content">
<ul>
<li>
<code>requests</code> is a swiss-army knife for accessing remote
data</li>
<li>web APIs are just collections of fancy URLs, which you can interact
with via <code>requests</code>
</li>
<li>to learn an API, you need to read the documentation and experiment
with the API to see how it responds</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</div>
</section></section><section id="aio-scraping-data"><p>Content from <a href="scraping-data.html">Scraping Data</a></p>
<hr>
<p>Last updated on 2025-06-25 |

        <a href="https://github.com/catalyst-cooperative/open-energy-data-for-all/edit/main/episodes/scraping-data.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 0 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do I avoid the tedium/error-prone-ness of clicking lots of links
or making lots of API requests by hand?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Use pagination to get all available data</li>
<li>Automatically download files from a long listing of links on a
page</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<hr class="half-width">
<p>Now we’ve learned about how to download data from websites and from
APIs. But some questions linger…</p>
<ul>
<li><p>often there are webpages with lots of links to data you want…
copy-pasting each link into our code is a pain, and hardly better than
just clicking each link to download the data. Is there a better
way?</p></li>
<li><p>you might also remember seeing that ‘warning’ from the EIA API
about only returning 5000 rows at a time… how can we get more?</p></li>
</ul>
<p>The thread connecting these two questions/problems is that sometimes
your data lives behind <em>many</em> URLs, not just one. So you have to
go get a bunch of separate data and glue it all together.</p>
</section><section><h2 class="section-heading" id="web-scraping">Web scraping<a class="anchor" aria-label="anchor" href="#web-scraping"></a>
</h2>
<hr class="half-width">
<p>Let’s start by downloading files from a webpage that has many links -
the good old EIA website.</p>
<p>For all the benefits of the API, some of the EIA 923 data is only
available through the downloadable spreadsheets - and the spreadsheets
are only available by clicking through the list of links on the <a href="https://www.eia.gov/electricity/data/eia923/" class="external-link">EIA 923
page</a>:</p>
<figure><img src=".././fig/ep-4/eia-923-spreadsheets.png" alt="Screenshot of the EIA 923 data page. A listing of each year's files is in the right sidebar." class="figure mx-auto d-block"><div class="figcaption">Screenshot of the EIA 923 data page. A listing
of each year’s files is in the right sidebar.</div>
</figure><p>There’s only a couple dozen, so we could probably get away with just
downloading the files by clicking the links. But, you can imagine how it
could quickly get out of hand with multiple pages or many more links.
We’ll keep it simple for now and just stick with the EIA 923 page as an
example.</p>
<div class="section level3">
<h3 id="example-eia-923906">Example: EIA 923/906<a class="anchor" aria-label="anchor" href="#example-eia-923906"></a>
</h3>
<p>First, let’s import the libraries we’ll need to use. Of course we’ll
use our workhorse <code>requests</code>. We’ll also need a library
called “Beautiful Soup” that helps us work with <em>website data</em> in
particular. It’s imported as <code>bs4</code>.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="im">import</span> bs4</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co"># while we're doing the imports, might as well store the URL in a variable.</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>eia_923_url <span class="op">=</span> <span class="st">"https://www.eia.gov/electricity/data/eia923/"</span></span></code></pre>
</div>
<p>To get the links, first we need to get the webpage itself - that’s
where the links are. Let’s see what the webpage looks like!</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>eia_923_response <span class="op">=</span> requests.get(eia_923_url)</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>eia_923_response.text</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>'&lt;!doctype html&gt;\r\n&lt;html&gt;\r\n\r\n&lt;head&gt;\r\n\t&lt;title&gt;\r\n\t\tForm EIA-923 detailed data with previous form data (EIA-906/920) -\r\n\t\tU.S. Energy Information Administration (EIA)\t&lt;/title&gt;\r\n\t&lt;meta property="og:title" content="Form EIA-923 detailed data with previous form data (EIA-906/920) - U.S. Energy Information Administration (EIA)"&gt;\r\n\t&lt;meta property="og:url" content="https://www.eia.gov/electricity/data/eia923/index.php"&gt;\r\n\t&lt;meta name="url" content="https://www.eia.gov/electricity/data/eia923/index.php"&gt;\r\n\t&lt;meta name="description" content="Clean Air Act Data Browser" /&gt;\r\n\t...</code></pre>
</div>
<p>OK, so that looks like some XML, which we saw a couple episodes ago -
notice the many angle brackets containing words that seem to be trying
to tell us something. We can use those <em>tags</em> to understand the
content of the file, and then filter through it to find what we actually
need.</p>
<p>This is actually a <em>special type</em> of XML called HTML, which is
what most webpages are described in (see the <code>doctype html</code>
tag). HTML is a vast and chaotic world, with exceptions to every rule.
Fortunately, <code>bs4</code> is here to help tame the chaos a bit. The
core of the library is the <code>BeautifulSoup</code> class, which takes
in a website’s HTML and adds some useful functionality to it:</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>eia_923_soup <span class="op">=</span> bs4.BeautifulSoup(eia_923_response.text)</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>eia_923_soup</span></code></pre>
</div>
<p>The first thing you’ll notice is that the output looks neater:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;
		Form EIA-923 detailed data with previous form data (EIA-906/920) -
		U.S. Energy Information Administration (EIA)	&lt;/title&gt;
&lt;meta content="Form EIA-923 detailed data with previous form data (EIA-906/920) - U.S. Energy Information Administration (EIA)" property="og:title"/&gt;</code></pre>
</div>
<p>We’ll also be able to filter through this complicated set of
tags.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>eia_923_soup.find_all(<span class="st">"title"</span>)</span></code></pre>
</div>
<p>To get all the links, we need to get all the <code>a</code> tags -
that’s where links in HTML usually live:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>eia_923_all_a_tags <span class="op">=</span> eia_923_soup.find_all(<span class="st">"a"</span>)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[&lt;a name="top"&gt;&lt;/a&gt;,
 &lt;a href="http://x.com/eiagov/" target="_blank"&gt;&lt;span class="ico-sticker twitter"&gt;&lt;/span&gt;&lt;/a&gt;,
 &lt;a class="addthis_button_tweet"&gt;&lt;/a&gt;,
 &lt;a href="https://www.facebook.com/eiagov" target="_blank"&gt;&lt;span class="ico-sticker facebook"&gt;&lt;/span&gt;&lt;/a&gt;,
 &lt;a class="addthis_button_facebook_like at300b" fb:like:layout="button_count"&gt;&lt;/a&gt;,
 ...
 &lt;a class="ico zip" href="xls/f923_2024.zip" title="2024"&gt;&lt;span&gt;ZIP&lt;/span&gt;&lt;/a&gt;,
 &lt;a class="ico zip" href="archive/xls/f923_2023.zip" title="2023"&gt;&lt;span&gt;ZIP&lt;/span&gt;&lt;/a&gt;,
 &lt;a class="ico zip" href="archive/xls/f923_2022.zip" title="2022"&gt;&lt;span&gt;ZIP&lt;/span&gt;&lt;/a&gt;,
 &lt;a class="ico zip" href="archive/xls/f923_2021.zip" title="2021"&gt;&lt;span&gt;ZIP&lt;/span&gt;&lt;/a&gt;,
 &lt;a class="ico zip" href="archive/xls/f923_2020.zip" title="2020"&gt;&lt;span&gt;ZIP&lt;/span&gt;&lt;/a&gt;,
 ...</code></pre>
</div>
<p>OK, so we see a big list of tags, some of which appear to be links to
form 923 ZIP files. The URLs for those are included in an
<code>href</code> attribute. Almost every URL you’ll want to use will
live in one of these <code>href</code> attributes.</p>
<p>We can filter based on attributes like this:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>eia_923_a_hrefs <span class="op">=</span> eia_923_soup.find_all(<span class="st">"a"</span>, href<span class="op">=</span><span class="va">True</span>)</span></code></pre>
</div>
<p>This shows us only the <code>a</code> tags with <code>href</code>s
defined:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[&lt;a href="http://x.com/eiagov/" target="_blank"&gt;&lt;span class="ico-sticker twitter"&gt;&lt;/span&gt;&lt;/a&gt;,
 &lt;a href="https://www.facebook.com/eiagov" target="_blank"&gt;&lt;span class="ico-sticker facebook"&gt;&lt;/span&gt;&lt;/a&gt;,
 &lt;a class="eia-accessibility" href="#page-sub-nav"&gt;Skip to sub-navigation&lt;/a&gt;,
 &lt;a class="logo" href="/"&gt;
 &lt;h1&gt;U.S. Energy Information Administration - EIA - Independent Statistics and Analysis&lt;/h1&gt;
 &lt;/a&gt;,
 &lt;a class="nav-primary-item-link menu-toggle" href="javascript:;"&gt;</code></pre>
</div>
<p>And then you can filter those only for the ones that point at actual
ZIP files:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>eia_923_zip_tags <span class="op">=</span> []</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="cf">for</span> a <span class="kw">in</span> eia_923_a_hrefs:</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>    <span class="cf">if</span> a[<span class="st">"href"</span>].lower().endswith(<span class="st">".zip"</span>):</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>        eia_923_zip_tags.append(a)</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>eia_923_zip_tags</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[&lt;a class="ico zip" href="xls/f923_2024.zip" title="2024"&gt;&lt;span&gt;ZIP&lt;/span&gt;&lt;/a&gt;,
 &lt;a class="ico zip" href="archive/xls/f923_2023.zip" title="2023"&gt;&lt;span&gt;ZIP&lt;/span&gt;&lt;/a&gt;,
 &lt;a class="ico zip" href="archive/xls/f923_2022.zip" title="2022"&gt;&lt;span&gt;ZIP&lt;/span&gt;&lt;/a&gt;,
 &lt;a class="ico zip" href="archive/xls/f923_2021.zip" title="2021"&gt;&lt;span&gt;ZIP&lt;/span&gt;&lt;/a&gt;,
 ...
 &lt;a class="ico zip" href="archive/xls/f906920_2003.zip" title="2003"&gt;&lt;span&gt;ZIP&lt;/span&gt;&lt;/a&gt;,
 &lt;a class="ico zip" href="archive/xls/f906920_2002.zip" title="2002"&gt;&lt;span&gt;ZIP&lt;/span&gt;&lt;/a&gt;,
 &lt;a class="ico zip" href="archive/xls/f906920_2001.zip" title="2001"&gt;&lt;span&gt;ZIP&lt;/span&gt;&lt;/a&gt;,
 &lt;a class="ico zip" href="archive/xls/f906nonutil2000.zip" title="2000"&gt;&lt;span&gt;ZIP&lt;/span&gt;&lt;/a&gt;,
 &lt;a class="ico zip" href="archive/xls/f906nonutil1999.zip" title="1999"&gt;&lt;span&gt;ZIP&lt;/span&gt;&lt;/a&gt;,
 &lt;a class="ico zip" href="archive/xls/f906nonutil1989.zip" title="1989-1998"&gt;&lt;span&gt;ZIP&lt;/span&gt;&lt;/a&gt;]</code></pre>
</div>
<p>We probably want to skip those Form 906 links too.</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>eia_923_zip_tags <span class="op">=</span> []</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="cf">for</span> a <span class="kw">in</span> eia_923_a_hrefs:</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>    <span class="cf">if</span> a[<span class="st">"href"</span>].lower().endswith(<span class="st">".zip"</span>) <span class="kw">and</span> <span class="st">"f923"</span> <span class="kw">in</span> a[<span class="st">"href"</span>]:</span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>        eia_923_zip_tags.append(a)</span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>eia_923_zip_tags</span></code></pre>
</div>
<div id="challenge-get-all-the-relevant-a-tags-from-eia-906" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="challenge-get-all-the-relevant-a-tags-from-eia-906" class="callout-inner">
<h3 class="callout-title">Challenge: get all the relevant <code>a</code>
tags from EIA 906</h3>
<div class="callout-content">
<p>Lots of the data that is collected in EIA 923 was collected in EIA
906 in the past.</p>
<p>We’ll have you work through the scraping steps on the 906 data to get
a sense of how this all works.</p>
<p>Let’s get the relevant <code>a</code> tags from the <a href="https://www.eia.gov/electricity/data/eia923/eia906u.php" class="external-link">EIA 906
page</a>:</p>
<p>Start with the skeleton code outlined below - we expect a variable
called <code>eia_906_xls_tags</code> at the end, which holds all the
tags that refer to the actual 1970-2000 data files.</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>eia_906_url <span class="op">=</span> <span class="st">"https://www.eia.gov/electricity/data/eia923/eia906u.php"</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="co"># get the page contents</span></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a><span class="co"># turn it into a collection of tags</span></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a><span class="co"># filter them down to the tags that contain the links to XLS data - for all years 1970-2000</span></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a>eia_906_xls_tags <span class="op">=</span> []</span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>eia_906_url <span class="op">=</span> <span class="st">"https://www.eia.gov/electricity/data/eia923/eia906u.php"</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>eia_906_response <span class="op">=</span> requests.get(eia_906_url)</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>eia_906_soup <span class="op">=</span> bs4.BeautifulSoup(eia_906_response.text)</span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>eia_906_a_hrefs <span class="op">=</span> eia_906_soup.find_all(<span class="st">"a"</span>, href<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a>eia_906_xls_tags <span class="op">=</span> []</span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a><span class="cf">for</span> a <span class="kw">in</span> eia_906_a_hrefs:</span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">".xls"</span> <span class="kw">in</span> a[<span class="st">"href"</span>].lower():</span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a>        eia_906_xls_tags.append(a)</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="downloading-the-data">Downloading the data<a class="anchor" aria-label="anchor" href="#downloading-the-data"></a>
</h3>
<p>OK, now we have our tags, time to use them to download the data!
Let’s try it with one tag first:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>eia_906_one_link <span class="op">=</span> eia_906_xls_tags[<span class="dv">0</span>]</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>eia_906_one_response <span class="op">=</span> requests.get(eia_906_one_link[<span class="st">"href"</span>])</span></code></pre>
</div>
<p>Oh no! We get an error:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>MissingSchema: Invalid URL '/electricity/data/eia923/archive/xls/utility/f7592000mu.xls': No scheme supplied. Perhaps you meant https:///electricity/data/eia923/archive/xls/utility/f7592000mu.xls?</code></pre>
</div>
<p>Looks like the URL in the <code>href</code> is incomplete. It turns
out that this is a <em>relative path</em> - much like the relative paths
you had to deal with when loading data on your computer. The full URL we
want is
<code>https://www.eia.gov/electricity/data/eia923/archive/xls/utility/f7592000mu.xls</code>
- which combines the URL of the page we got the link from
(<code>https://www.eia.gov/electricity/data/eia923/eia906u.php</code>)
with the fragment we got in the <code>href</code>
(<code>/electricity/data/eia923/archive/xls/utility/f7592000mu.xls</code>).</p>
<p>This is a super common thing to have to do, so there’s a useful bit
of the Python standard library for this:
<code>urllib.parse.urljoin</code>:</p>
<pre><code>from urllib.parse import urljoin

eia_906_one_full_url = urljoin(eia_906_url, eia_906_one_link["href"])
eia_906_one_response = requests.get(eia_906_one_full_url)</code></pre>
<p>We can also do the string concatenation ourselves with
<code>eia_906_url + "..."</code>, but there are a surprising amount of
details to get wrong here so it’s nice to just use the function that
works.</p>
<p>Finally, we can take a look at the actual dataframe using
<code>pandas</code>:</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>eia_906_one_df <span class="op">=</span> pd.read_excel(eia_906_one_response.content)</span></code></pre>
</div>
<p>Note that we use <code>.content</code> here instead of
<code>.text</code> - this is because an Excel file is not designed to be
read directly as text.</p>
<p>You can bypass this manual download-then-read process, actually, with
<code>pd.read_excel</code> - it can handle reading directly from a
URL:</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a>eia_906_one_df <span class="op">=</span> pd.read_excel(eia_906_one_full_url)</span></code></pre>
</div>
<div id="challenge-get-the-form-906-file-contents" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="challenge-get-the-form-906-file-contents" class="callout-inner">
<h3 class="callout-title">Challenge: get the Form 906 file contents</h3>
<div class="callout-content">
<p>OK, so now we know how to scrape a bunch of URLs from a webpage.
Let’s read the Form 906 files into our program! Since they’re XLS files,
we can read them directly from a URL using
<code>pandas.read_excel</code>.</p>
<p>Try making a list, <code>eia_906_dataframes</code>, that includes all
of the data files from the <a href="https://www.eia.gov/electricity/data/eia923/eia906u.php" class="external-link">EIA 906
page</a> - start with the (minimal) scaffold below!</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a>eia_906_dataframes <span class="op">=</span> []</span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a><span class="co"># loop through the eia_906_xls_tags and make a pd.DataFrame for each one</span></span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="cf">for</span> a <span class="kw">in</span> eia_906_xls_tags:</span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a>    full_url <span class="op">=</span> urljoin(eia_906_url, a[<span class="st">"href"</span>])</span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a>    eia_906_dataframes.append(pd.read_excel(full_url))</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Once we’ve completed the challenge above, we have a list of a bunch
of dataframes. To bring them all into one dataframe, we can use
<code>pd.concat</code>, which “concatenates” several dataframes
together:</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a>mega_906 <span class="op">=</span> pd.concat(eia_906_dataframes)</span></code></pre>
</div>
<p>If you use <code>DataFrame.info()</code> you can quickly see that
some columns (YEAR, FIPST, UTILNAME) are more populated than others
(MULTIST, GEN01, etc):</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a>mega_906.info()</span></code></pre>
</div>
<p>And if you start to dig into the data a bit, such as pulling out the
various values of <code>YEAR</code>, you see that you have
<em>plenty</em> of data cleaning to do before this is really usable for
analysis. But at least you have all of the data in one dataframe now!
We’ll go over some more tips for exploratory data analysis in the next
episode.</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a>mega_906.YEAR.value_counts()</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>YEAR
96      10507
97      10468
1999    10296
2000     9617
74       6429
73       6363
75       6362
76       6307
72       6198
71       6130
70       6100
81       5692
85       5692
80       5678
82       5669
84       5661
83       5650
87       5647
86       5634
77       5627
78       5594
79       5554
98       5470
89       5263
88       5241
95       5119
1998     5118
93       5109
91       5107
94       5102
92       5100
90       5074
99         40
0          14
Name: count, dtype: int64</code></pre>
</div>
<div id="discussion1" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<span class="callout-header">Discussion</span>
<div class="callout-inner">
<div class="callout-content">
<p>Why might you choose to do all this instead of just manually
collecting links?</p>
<ul>
<li>If it’s a lot of effort to get to each link</li>
<li>If the data is frequently updated</li>
<li>If I have to download all the files multiple times</li>
<li>If I have to combine everything into one big dataset
programmatically anyways</li>
</ul>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="pagination">Pagination<a class="anchor" aria-label="anchor" href="#pagination"></a>
</h2>
<hr class="half-width">
<p>Another time you’ll need lots of URLs is when APIs don’t give you
everything all at once. Let’s look at an example request to the EIA API
we saw last time:</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a>eia_api_base_url <span class="op">=</span> <span class="st">"https://api.eia.gov/v2/electricity"</span></span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a>api_key <span class="op">=</span> <span class="st">"3zjKYxV86AqtJWSRoAECir1wQFscVu6lxXnRVKG8"</span></span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" tabindex="-1"></a>first_page <span class="op">=</span> requests.get(</span>
<span id="cb27-5"><a href="#cb27-5" tabindex="-1"></a>    <span class="ss">f"</span><span class="sc">{</span>eia_api_base_url<span class="sc">}</span><span class="ss">/facility-fuel/data"</span>,</span>
<span id="cb27-6"><a href="#cb27-6" tabindex="-1"></a>    params<span class="op">=</span>{</span>
<span id="cb27-7"><a href="#cb27-7" tabindex="-1"></a>        <span class="st">"data[]"</span>: <span class="st">"generation"</span>,</span>
<span id="cb27-8"><a href="#cb27-8" tabindex="-1"></a>        <span class="st">"facets[state][]"</span>: <span class="st">"PR"</span>,</span>
<span id="cb27-9"><a href="#cb27-9" tabindex="-1"></a>        <span class="st">"sort[0][column]"</span>: <span class="st">"period"</span>,</span>
<span id="cb27-10"><a href="#cb27-10" tabindex="-1"></a>        <span class="st">"sort[0][direction]"</span>: <span class="st">"desc"</span>,</span>
<span id="cb27-11"><a href="#cb27-11" tabindex="-1"></a>        <span class="st">"sort[1][column]"</span>: <span class="st">"plantCode"</span>,</span>
<span id="cb27-12"><a href="#cb27-12" tabindex="-1"></a>        <span class="st">"sort[1][direction]"</span>: <span class="st">"desc"</span>,</span>
<span id="cb27-13"><a href="#cb27-13" tabindex="-1"></a>        <span class="st">"api_key"</span>: api_key</span>
<span id="cb27-14"><a href="#cb27-14" tabindex="-1"></a>    }</span>
<span id="cb27-15"><a href="#cb27-15" tabindex="-1"></a>).json()[<span class="st">"response"</span>]</span></code></pre>
</div>
<p>There’s a lot of info in here so let’s just look at the keys to
start.</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a>first_page.keys()</span></code></pre>
</div>
<p>The data lives in the <code>"data"</code> key, so let’s take a quick
look at that:</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a>pd.DataFrame(first_page[<span class="st">"data"</span>])</span></code></pre>
</div>
<p>Seems like it’s sensible data, but 5000 rows is a suspiciously round
(and small) number. Is there anything funny going on?</p>
<p>Ooh! There’s a warning - what is it?</p>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a>first_page[<span class="st">"warnings"</span>]</span></code></pre>
</div>
<pre><code>The API can only return 5000 rows in JSON format.  Please consider constraining your request with facet, start, or end, or using offset to paginate results.</code></pre>
<p>So if we want a dataset that’s bigger than 5000 rows, we’ll need to
make multiple requests. Instead of scraping many URLs from a page, we’ll
be generating the URLs ourselves.</p>
<p>This process of “get N rows, then the next N rows, etc.” is called
“pagination” - like going to the next page of Google results.</p>
<p>We’ll go to the <a href="https://www.eia.gov/opendata/documentation.php" class="external-link">docs</a> to look
at this <code>offset</code> parameter:</p>
<blockquote>
<p>Offset stipulates the row number the API should begin its return
with, out of all the eligible rows our query would otherwise
provide.</p>
<p>[…]</p>
<p><code>https://api.eia.gov/v2/electricity/retail_sales/data?api_key=xxxxxx&amp;data[]=price&amp;facets[sectorid][]=RES&amp;facets[stateid][]=CO&amp;frequency=monthly&amp;sort[0][column]=period&amp;sort[0][direction]=desc&amp;offset=24</code></p>
<p>In the above example, the API will skip over the first 24 eligible
rows (offset=24), which translates into 24 months
(frequency=monthly).</p>
</blockquote>
<p>Let’s try using that. First, let’s pull the common parameters into a
variable so it’s a little easier to work with:</p>
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a>common_params <span class="op">=</span> {</span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a>    <span class="st">"data[]"</span>: <span class="st">"generation"</span>,</span>
<span id="cb32-3"><a href="#cb32-3" tabindex="-1"></a>    <span class="st">"facets[state][]"</span>: <span class="st">"PR"</span>,</span>
<span id="cb32-4"><a href="#cb32-4" tabindex="-1"></a>    <span class="st">"sort[0][column]"</span>: <span class="st">"period"</span>,</span>
<span id="cb32-5"><a href="#cb32-5" tabindex="-1"></a>    <span class="st">"sort[0][direction]"</span>: <span class="st">"desc"</span>,</span>
<span id="cb32-6"><a href="#cb32-6" tabindex="-1"></a>    <span class="st">"sort[1][column]"</span>: <span class="st">"plantCode"</span>,</span>
<span id="cb32-7"><a href="#cb32-7" tabindex="-1"></a>    <span class="st">"sort[1][direction]"</span>: <span class="st">"desc"</span>,</span>
<span id="cb32-8"><a href="#cb32-8" tabindex="-1"></a>    <span class="st">"api_key"</span>: api_key</span>
<span id="cb32-9"><a href="#cb32-9" tabindex="-1"></a>}</span>
<span id="cb32-10"><a href="#cb32-10" tabindex="-1"></a></span>
<span id="cb32-11"><a href="#cb32-11" tabindex="-1"></a>next_page <span class="op">=</span> requests.get(</span>
<span id="cb32-12"><a href="#cb32-12" tabindex="-1"></a>  <span class="ss">f"</span><span class="sc">{</span>base_url<span class="sc">}</span><span class="ss">/facility-fuel/data"</span>, params<span class="op">=</span>common_params <span class="op">|</span> {<span class="st">"offset"</span>: <span class="dv">5000</span>}</span>
<span id="cb32-13"><a href="#cb32-13" tabindex="-1"></a>).json()[<span class="st">"response"</span>]</span></code></pre>
</div>
<p>If we look at <em>that</em> we can see that we do indeed get the next
several months of data:</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a>pd.DataFrame(next_page[<span class="st">"data"</span>])</span></code></pre>
</div>
<p>And if we wanted to grab the first 5 pages, we could use a
<code>for</code> loop combined with the <code>range()</code>
function.</p>
<p><code>range()</code> is super useful - at its simplest, it just
produces, well… a range of numbers.</p>
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">5</span>):</span>
<span id="cb34-2"><a href="#cb34-2" tabindex="-1"></a>    <span class="bu">print</span>(i)</span>
<span id="cb34-3"><a href="#cb34-3" tabindex="-1"></a>    <span class="co"># actually get the page here...</span></span></code></pre>
</div>
<p>If you want to start at a specific number, you can do something
like:</p>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>, <span class="dv">15</span>):</span>
<span id="cb35-2"><a href="#cb35-2" tabindex="-1"></a>    <span class="bu">print</span>(i)</span></code></pre>
</div>
<p>And if you want to count in different increments, you can do:</p>
<div class="codewrapper sourceCode" id="cb36">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">15</span>, <span class="dv">5</span>):</span>
<span id="cb36-2"><a href="#cb36-2" tabindex="-1"></a>    <span class="bu">print</span>(i)</span></code></pre>
</div>
<p>:::: challenge: <code>range</code></p>
<p>If you wanted to set a fresh <code>offset</code> for every page in a
number of rows, how would you do that? Imagine there are 23,456 rows and
each page must be 5000 rows long.</p>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a>total_rows <span class="op">=</span> <span class="dv">23_456</span></span>
<span id="cb37-2"><a href="#cb37-2" tabindex="-1"></a>page_size <span class="op">=</span> <span class="dv">5000</span></span>
<span id="cb37-3"><a href="#cb37-3" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" tabindex="-1"></a><span class="cf">for</span> offset <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, total_rows, page_size):</span>
<span id="cb37-5"><a href="#cb37-5" tabindex="-1"></a>  <span class="bu">print</span>(offset)</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p>::::</p>
<div class="section level3">
<h3 id="how-many-rows-to-get">How many rows to get?<a class="anchor" aria-label="anchor" href="#how-many-rows-to-get"></a>
</h3>
<p>Now that we know how to get multiple pages, we need to know when to
stop getting more pages.</p>
<p>Broadly, there are two strategies:</p>
<ul>
<li>figure out the total number of results ahead of time, and do some
math to figure out how many pages to request</li>
<li>keep getting more pages until you run out of results</li>
</ul>
<p>Both work, and each has its own downsides:</p>
<ul>
<li>the first method only works for APIs that tell you how many results
there are.</li>
<li>the second method can lead to infinite loops if you mess up.</li>
</ul>
<p>Since the EIA API tells you how many results there are, let’s work
with the first option.</p>
<p>Let’s look at the API response again.</p>
<div class="codewrapper sourceCode" id="cb38">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" tabindex="-1"></a>first_page.keys()</span></code></pre>
</div>
<p>That “total” field looks pretty suspicious.</p>
<div class="codewrapper sourceCode" id="cb39">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" tabindex="-1"></a>first_page[<span class="st">"total"</span>]</span></code></pre>
</div>
<p>So there are about 8,000 rows in this dataset. That’s the last piece
you need to be able to do this challenge!</p>
<div id="challenge-pagination" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="challenge-pagination" class="callout-inner">
<h3 class="callout-title">Challenge: pagination</h3>
<div class="callout-content">
<p>OK, now let’s put it all together!</p>
<p>Let’s try to get the net generation data in Puerto Rico that is in
the EIA API.</p>
<p>Start with the following code and modify it to work:</p>
<div class="codewrapper sourceCode" id="cb40">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" tabindex="-1"></a>all_records <span class="op">=</span> []</span>
<span id="cb40-2"><a href="#cb40-2" tabindex="-1"></a><span class="co"># loop through the necessary pages</span></span>
<span id="cb40-3"><a href="#cb40-3" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Getting page starting at </span><span class="sc">{</span>offset<span class="sc">}</span><span class="ss">..."</span>)</span>
<span id="cb40-4"><a href="#cb40-4" tabindex="-1"></a>    page <span class="op">=</span> requests.get(</span>
<span id="cb40-5"><a href="#cb40-5" tabindex="-1"></a>      <span class="ss">f"</span><span class="sc">{</span>eia_api_base_url<span class="sc">}</span><span class="ss">/facility-fuel/data"</span>,</span>
<span id="cb40-6"><a href="#cb40-6" tabindex="-1"></a>      params<span class="op">=</span>{</span>
<span id="cb40-7"><a href="#cb40-7" tabindex="-1"></a>        <span class="co"># what goes here?</span></span>
<span id="cb40-8"><a href="#cb40-8" tabindex="-1"></a>      }</span>
<span id="cb40-9"><a href="#cb40-9" tabindex="-1"></a>    ).json()[<span class="st">"response"</span>]</span>
<span id="cb40-10"><a href="#cb40-10" tabindex="-1"></a>    all_records.append(pd.DataFrame(page[<span class="st">"data"</span>]))</span>
<span id="cb40-11"><a href="#cb40-11" tabindex="-1"></a></span>
<span id="cb40-12"><a href="#cb40-12" tabindex="-1"></a>df <span class="op">=</span> pd.concat(all_records)</span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4"> Show me the solution </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" aria-labelledby="headingSolution4" data-bs-parent="#accordionSolution4">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb41">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" tabindex="-1"></a>all_records <span class="op">=</span> []</span>
<span id="cb41-2"><a href="#cb41-2" tabindex="-1"></a><span class="cf">for</span> offset <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="dv">12_345</span>, <span class="dv">5000</span>):</span>
<span id="cb41-3"><a href="#cb41-3" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Getting page starting at </span><span class="sc">{</span>offset<span class="sc">}</span><span class="ss">..."</span>)</span>
<span id="cb41-4"><a href="#cb41-4" tabindex="-1"></a>    page <span class="op">=</span> requests.get(</span>
<span id="cb41-5"><a href="#cb41-5" tabindex="-1"></a>      <span class="ss">f"</span><span class="sc">{</span>eia_api_base_url<span class="sc">}</span><span class="ss">/facility-fuel/data"</span>,</span>
<span id="cb41-6"><a href="#cb41-6" tabindex="-1"></a>      params<span class="op">=</span>common_params <span class="op">|</span> {<span class="st">"offset"</span>: offset}</span>
<span id="cb41-7"><a href="#cb41-7" tabindex="-1"></a>    ).json()[<span class="st">"response"</span>]</span>
<span id="cb41-8"><a href="#cb41-8" tabindex="-1"></a>    all_records.append(pd.DataFrame(page[<span class="st">"data"</span>]))</span>
<span id="cb41-9"><a href="#cb41-9" tabindex="-1"></a></span>
<span id="cb41-10"><a href="#cb41-10" tabindex="-1"></a>df <span class="op">=</span> pd.concat(all_records) <span class="co"># combines all pages into one big dataframe</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="further-resources">Further resources<a class="anchor" aria-label="anchor" href="#further-resources"></a>
</h3>
<p>We’ve only just scratched the surface of programmatically getting
data from the Internet here. Sometimes, there are obstacles. We can’t
teach you how to overcome all of them, but here is a little
troubleshooting guide of “something weird? maybe try searching for these
keywords.”</p>
<ul>
<li>Links not showing up in your <code>bs4</code> <code>a</code> tags?
<ul>
<li>look at the links using the <em>html inspector</em> in your browser
dev tools.</li>
<li>look at what’s happening when you download files by using the
<em>network tab</em> of your browser dev tools.
<ul>
<li>when you click something to download data, or when you load in data
for a graph, keep an eye on this. you might find some suspicious looking
URLs</li>
</ul>
</li>
</ul>
</li>
<li>The HTML you see in <em>browser dev tools</em> is different from
what you get from <code>requests</code>?
<ul>
<li>sometimes there’s code that your browser runs after the initial
load, which changes the HTML after the fact. <code>requests</code> won’t
catch that, but try <code>playwright</code> which runs that post-load
code. keyword is <code>headless browser automation</code>.</li>
<li>sometimes servers will be mean to you because of who you say you are
(<em>user agent</em>).
<ul>
<li>sometimes they’ll give you some sort of error, or a CAPTCHA</li>
<li>sometimes they will just not give you any response at all</li>
<li>If you suspect that… try telling them you’re a real human instead of
a bot. Look for “spoofing the user agent” to see guides on how to do
this.</li>
</ul>
</li>
</ul>
</li>
<li>Running into rate limits for making too many requests?
<ul>
<li>Try adding some delays in your scraping code so that it’s not
hammering the server so hard. The <code>time.sleep</code> method here is
your friend.</li>
<li>Do double-check the terms &amp; conditions of the website you’re
using - if a website is implementing some rate limit, they probably
don’t want you using automated tools to download the data in the first
place.</li>
<li>You might need a ‘web scraping proxy’ service, which will let you
get around a lot of limits.</li>
</ul>
</li>
<li>Have to download a file to disk instead of turning it into a
DataFrame immediately?
<ul>
<li>Use <code>response.content</code> to get the literal bytes that the
response is made of - this will help with files like ZIP files that
don’t have a nice text representation.</li>
<li>Then use the “wb” mode (“write binary”) to write that data to
disk:</li>
</ul>
<div class="codewrapper sourceCode" id="cb42">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(some_filename, <span class="st">"wb"</span>) <span class="im">as</span> f:</span>
<span id="cb42-2"><a href="#cb42-2" tabindex="-1"></a>    f.write(response.content)</span></code></pre>
</div>
</li>
</ul>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<span class="callout-header">Key Points</span>
<div class="callout-inner">
<div class="callout-content">
<ul>
<li>beautiful soup lets you grab links out of a webpage so that you can
then download them</li>
<li>if you need to get more than one request worth of results from an
API, they usually provide some “pagination” capabilities so you can make
all the requests programmatically.</li>
<li>web scraping is a wide world - if you get stuck, try searching for
some of the keywords above.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</div>
</section></section><section id="aio-visual-data-exploration"><p>Content from <a href="visual-data-exploration.html">Visual Data Exploration</a></p>
<hr>
<p>Last updated on 2025-09-09 |

        <a href="https://github.com/catalyst-cooperative/open-energy-data-for-all/edit/main/episodes/visual-data-exploration.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 110 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do I get ready to do research with data that is new to me?</li>
<li>What should I do when I find something that doesn’t look right?</li>
<li>How can I get a head start on identifying data problems that might
cause headaches later?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Use divide-and-conquer to split a table into manageable pieces</li>
<li>Examine data for anomalies using summarization and
visualization</li>
<li>Articulate the difference between refining plots for exploration and
refining plots for presentation</li>
<li>Execute strategies for locating the cause and extent of
anomalies</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>Now that you have some raw data, how do you get from there to
actually doing research with it?</p>
<p>Maybe you already have a research question; how do you get your data
into a form that can help you answer it? How do you know your data
doesn’t have gremlins hiding in it that will mess up your research?</p>
<p>In this session we will do some initial data explorations and develop
strategies for identifying and diagnosing sneaky data problems –
including the use of data visualization as part of your exploration
toolkit. Plots aren’t just for papers!</p>
<div class="section level1">
<h1 id="what-kinds-of-data-problems-are-common-in-energy-data">What kinds of data problems are common in energy data?<a class="anchor" aria-label="anchor" href="#what-kinds-of-data-problems-are-common-in-energy-data"></a>
</h1>
<p>Data problems come in many different forms, and how you respond to
them will depend on the source of the problem and what kind of impact it
will have on the kinds of modeling and analysis you want to do.</p>
<ul>
<li>
<strong>Problems introduced by the respondent</strong> - typos and
other data entry errors - These can be fixed if they’re simple, or can
be a reason to exclude certain rows if correct values can’t be
reconstructed.</li>
<li>
<strong>Problems introduced by the data aggregator</strong> -
disagreement between documentation you received and the actual forms
filled out by respondents; a bad choice of data format that doesn’t
preserve relationships within the data - These can sometimes be “fixed”
by working out logically what the definition of a column should actually
be, but sometimes not.</li>
<li>
<strong>“Problems” introduced by external forces</strong> - natural
disasters, policy change - These may be retained or excluded depending
on your exact area of research.</li>
<li>
<strong>Problems we created for ourselves</strong> - We’ll talk
about this in a later session.</li>
</ul>
<p>Data problems can occur in a single column, or in the relationship
between columns, or even in the relationship between tables.</p>
</div>
<div class="section level1">
<h1 id="what-is-a-good-general-strategy-for-finding-problems-in-unfamiliar-data">What is a good general strategy for finding problems in unfamiliar
data?<a class="anchor" aria-label="anchor" href="#what-is-a-good-general-strategy-for-finding-problems-in-unfamiliar-data"></a>
</h1>
<p>Data problems aren’t always obvious. To uncover them, we will need to
go looking for them.</p>
<p>There is a pattern to this:</p>
<ul>
<li>Carve off a chunk of data small enough to reason about</li>
<li>Identify what we expect to see from that data</li>
<li>Compare with what we actually see</li>
<li>Justify or explain any differences between what we expect and what
is actually there</li>
</ul>
<p>When we first start out, our expectations will be quite general,
often based on data type – whether the data is numeric, categorical, or
free text. As we become more familiar with the data, our expectations
will become more sophisticated.</p>
</div>
<div class="section level1">
<h1 id="put-it-into-practice">Put it into practice<a class="anchor" aria-label="anchor" href="#put-it-into-practice"></a>
</h1>
<p>Let’s take a look at how these ideas apply to real data.</p>
<p>We’re looking at form EIA-923, which covers electricity generation
and fuel consumption by plant and prime mover on a monthly and annual
basis.</p>
<p>You have one raw file for EIA-923 data from Puerto Rico, and two
processed files which were prepared by your predecessor:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>raw_file <span class="op">=</span> <span class="st">"../data/raw_eia923__puerto_rico_generation_fuel.parquet"</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>annual_file <span class="op">=</span> <span class="st">"../data/pr_gen_fuel_annual.parquet"</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>monthly_file <span class="op">=</span> <span class="st">"../data/pr_gen_fuel_monthly.parquet"</span></span></code></pre>
</div>
<p>(They also left you their source code, but we’ll start with the data
and take a look at the code in another session. Reading the code will be
easier if we are more familiar with the data.)</p>
<p>We will ask ourselves:</p>
<ul>
<li>What kinds of data are there? Can I look at just one kind at a
time?</li>
<li>What do I expect to see from this data?</li>
<li>What do I actually see?</li>
<li>Can I justify or explain any differences between what I expect and
what I actually see?</li>
</ul>
<div class="section level2">
<h2 id="annual-data">Annual data<a class="anchor" aria-label="anchor" href="#annual-data"></a>
</h2>
<p>We’ll start with the annual file.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>pr_gen_fuel_annual <span class="op">=</span> pd.read_parquet(annual_file)</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>pr_gen_fuel_annual</span></code></pre>
</div>
<p>Our predecessor has already taken care of a lot of the cleaning
necessary for this data, so it’s already in usable condition, with nice
specific data types and a tidy arrangement of columns.
<!--  -- we'll dig into their pipeline for that in a later session, but it covered setting appropriate data types, splitting annual data from monthly data, and pivoting the monthly data from a wide to a tidy narrow format. --></p>
<p>We want to focus on uncovering problems that didn’t show up during
cleaning.</p>
<p>There are 24 columns here, which is a little much to reason about all
at once. One way to tackle a problem that seems too large is to break it
up into smaller pieces. There are lots of ways to split up a wide table,
and they’ll all work well enough to get you started:</p>
<ul>
<li>Split up columns by purpose
<ul>
<li>Primary key columns: the columns that uniquely identify each row of
data; closely related to what each row represents</li>
<li>Timeseries columns: the independent and dependent variables you
would plot in a line chart</li>
<li>Grouping columns: the columns you could use to group data together
and see if different groups have different properties</li>
</ul>
</li>
<li>Split up columns by data type
<ul>
<li>Numeric data</li>
<li>Categorical data
<ul>
<li>Identifiers</li>
<li>Codes</li>
<li>True/false (“booleans”)</li>
</ul>
</li>
<li>Free text data</li>
</ul>
</li>
</ul>
<p>Generally, splitting up columns by purpose requires more domain
knowledge, but can also help you understand the meaning of the data more
quickly than looking just based on data type. We’ll use a little of both
so you can see what they’re like.</p>
<div class="section level3">
<h3 id="primary-keys-index-columns">Primary keys &amp; index columns<a class="anchor" aria-label="anchor" href="#primary-keys-index-columns"></a>
</h3>
<p>Let’s start with a primary key. What columns, taken together, have
unique values from row to row? What does each row in this file
represent?</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># 1. carve off a chunk: what is the primary key?</span></span></code></pre>
</div>
<p>If we were familiar with EIA 923 from other research, we might know
that already. If not, we can check the dataset documentation. The
grandfather of this dataframe is an Excel file, which has some
documentation we can look at.</p>
<p>If you want to follow along, you can find the file
<code>eia923_pr.xlsx</code> in the <code>data</code> directory of the
lesson repo.</p>
<figure><img src="../fig/ep-5/eia923-filelayout.png" alt="Excel screenshot showing tab Page 7 File Layout of file data/eia923_pr.xlsx. A table titled Generation and Fuel Data has two columns, Data Elements and Description. The first few rows are visible; contents as follows. Plant ID: EIA Plant Identification number. One to five digit numeric. Combined Heat &amp; Power Plant: Whether or not the plant is a combined heat &amp; power facility (cogenerator). One character alphanumeric, Y or N. Nuclear Unit ID: For nuclear plants only, the unit number. One digit numeric. Nuclear plants are the only type of plants for which data are shown explicitly at the generating unit level. Plant Name: Plant name. Alphanumeric. Operator Name: The name of the entity which operates the plant. Alphanumeric. Operator ID: The EIA operator identification number. Five digit numeric, padded with leading zeros. State: State the facility is located in. Two character alphanumeric (standard state postal codes)." class="figure mx-auto d-block"><div class="figcaption">Excel screenshot showing tab Page 7 File Layout
of data/eia923_pr.xlsx</div>
</figure><p>The documentation doesn’t say what uniquely identifies each entry; we
will have to reason it out. We know each plant has to file with the EIA
every year, so we’ll use that as our initial guess:</p>
<ul>
<li>Plant ID</li>
<li>Year</li>
</ul>
<p>Let’s check. If that’s the primary key, then we expect each pair of
(plant ID, year) values to only occur once in the data frame.
<code>.value_counts()</code> will tell us the number of times each
distinct row occurs in a data frame. If we select only the primary key
columns, then it will tell us how many times each primary key value
occurs. If there are no values that occur more than once, or few enough
that we could believe they were mistakes, then we got it.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="co"># 1. carve off a chunk: what is the primary key?</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>primary_key_columns <span class="op">=</span> [<span class="st">"plant_id_eia"</span>, <span class="st">"report_year"</span>]</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="co"># 2. what do we expect: every pk value occurs no more than once</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>pr_gen_fuel_annual[primary_key_columns].value_counts()</span></code></pre>
</div>
<p>There are 283 rows in the result, so there are 283 primary key values
available. Oh dear there are some that occur five or six times. How
common is that? For easier readability we can add the plant name in.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>primary_key_columns <span class="op">=</span> [<span class="st">"plant_id_eia"</span>, <span class="st">"plant_name_eia"</span>, <span class="st">"report_year"</span>]</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="co"># 2. what do we expect: every pk value occurs no more than once</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>pr_gen_fuel_annual[primary_key_columns].value_counts()</span></code></pre>
</div>
<p>And then filter for just the ones with multiple rows.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>primary_key_columns <span class="op">=</span> [<span class="st">"plant_id_eia"</span>, <span class="st">"plant_name_eia"</span>, <span class="st">"report_year"</span>]</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="co"># 2. what do we expect: every pk value occurs no more than once</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>pk_sizes <span class="op">=</span> pr_gen_fuel_annual[primary_key_columns].value_counts()</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>pk_sizes.loc[pk_sizes<span class="op">&gt;</span><span class="dv">1</span>]</span></code></pre>
</div>
<p>Ninety one! Out of 283. That’s almost a third. We might expect a few
errors but a third is too many; it’s more likely we’re wrong about the
primary key. Let’s look at one example.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co"># 3. what did we find: 1/3 occur more than once</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="co"># 4. explain why: try an example</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>pr_gen_fuel_annual.loc[</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>    (pr_gen_fuel_annual.plant_id_eia <span class="op">==</span> <span class="dv">66127</span>) <span class="op">&amp;</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>    (pr_gen_fuel_annual.report_year <span class="op">==</span> <span class="dv">2022</span>)</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>].transpose()</span></code></pre>
</div>
<p>Looks like these two records differ in
<code>energy_source_code</code>. Let’s add that in, and see if our
revised expectation holds true.</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="co"># 4. explain why: we were missing energy_source_code</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>primary_key_columns <span class="op">=</span> [<span class="st">"plant_id_eia"</span>, <span class="st">"plant_name_eia"</span>, <span class="st">"report_year"</span>, <span class="st">"energy_source_code"</span>]</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="co"># 2. what we expect: no more than once</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>pk_sizes <span class="op">=</span> pr_gen_fuel_annual[primary_key_columns].value_counts()</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>pk_sizes.loc[pk_sizes<span class="op">&gt;</span><span class="dv">1</span>]</span></code></pre>
</div>
<p>Better, but we still have a lot of duplicates.</p>
<div id="challenge1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p>Look at one of the duplicate entries and propose another column to
add to our primary key.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>If we add <code>prime_mover_code</code> to our primary key, we end up
with only one duplicate entry.</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>primary_key_columns <span class="op">=</span> [</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>    <span class="st">'plant_id_eia'</span>, <span class="st">'plant_name_eia'</span>, <span class="st">'report_year'</span>, <span class="st">'energy_source_code'</span>, <span class="st">'prime_mover_code'</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>]</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="co"># 3. what we found: one duplicate</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>pk_sizes <span class="op">=</span> pr_gen_fuel_annual[primary_key_columns].value_counts()</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>pk_sizes.loc[pk_sizes<span class="op">&gt;</span><span class="dv">1</span>]</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>plant_id_eia  plant_name_eia            report_year  prime_mover_code  energy_source_code
62410         Cervecera de Puerto Rico  2020         IC                DFO                   2
dtype: int64</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Only one! That’s plausibly a respondent error or data entry
problem.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="co"># 4. explain why: likely respondent error or data entry problem</span></span></code></pre>
</div>
<p>We can note that plant down as a possible troublemaker to investigate
later.</p>
<p>It’s a good idea to keep notes on the problems you find, or little
bits that look suspicious but would take away from your primary focus if
you chased them immediately. Let’s do that now. We’ll open up a new
document, and make a note of what we found.</p>
<pre class="text"><code># Problems in EIA-923 Puerto Rico data

Primary key occurs twice:
    plant_id_eia  plant_name_eia            report_year  prime_mover_code  energy_source_code
    62410         Cervecera de Puerto Rico  2020         IC                DFO                   2
    dtype: int64</code></pre>
<p>But we have our primary key! That’s five columns we’ve carved off of
the original 24, using the “split columns by purpose” strategy. We wound
up needing a combination of domain knowledge from the documentation, and
empirical knowledge gained by guess-and-check.</p>
<p>Using this approach, we found one duplicate entry that could mess up
our analysis later.</p>
<p>Next let’s take a look at an example of the “split columns by data
type” strategy.</p>
</div>
<div class="section level3">
<h3 id="splitting-columns-by-data-type">Splitting columns by data type<a class="anchor" aria-label="anchor" href="#splitting-columns-by-data-type"></a>
</h3>
<p>Let’s think about how data type affects what we expect to see.</p>
<ul>
<li>
<strong>Numeric data</strong> might be in whole numbers (1, 2, -11,
56,912) or use decimal fractions (3.14, 0.000123, -65,536.2). In
programming, a whole number is often called an “integer” or “int” while
a number with a decimal fraction is often called a “float” (short for
“floating point”, which has to do with minutiae of how fractions are
implemented in binary – we don’t need to know the details for this
course)</li>
<li>
<strong>Categorical data</strong> takes on one of a restricted set
of available values. They might be ID numbers, an alphanumeric string, a
few words, or a few letters meant to abbreviate a longer category name.
If a value appears that is not in the restricted set, that value is
invalid, and likely resulted from a typo or similar error. An
explanation of all the available values for each categorical column is
usually included in the documentation for a data source, but sometimes
you can get a rough idea from context.</li>
<li>
<strong>Free text data</strong> [which we won’t cover today] is
unrestricted, except perhaps in length. It might be a description of an
incident, location, or piece of equipment. A free text value is not
required to match any other entry or registry, and there’s usually no
such thing as an invalid value. Free text typically requires the
application of qualitative research methods before it can be analyzed
further. Unfortunately, in energy data it is common for things like
plant names to be entered as free text – meaning you have to cope with a
variety of spelling and abbreviation choices when trying to match
between data sets.</li>
</ul>
<!--
All data types need to deal with situations where no value is available for that entry.
In pandas, we usually encode an intentionally missing value as `NA`.
Elsewhere in Python, we use `None`.
Other programming languages, software, and systems may make different choices.
Often, one of the first things to do when getting a new data set ready for research is to figure out how missing data was encoded by the data source, and map that to how *you* plan to encode missing data.
 --><p>We can use <code>.dtypes</code> to show the data type of each
column.</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>pr_gen_fuel_annual.dtypes</span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="categorical-data">Categorical data<a class="anchor" aria-label="anchor" href="#categorical-data"></a>
</h3>
<p>We’ll start with categorical data.</p>
<p>Some of the columns have already been labeled as having pandas data
type <code>category</code>. That’s a pandas dtype that automatically
restricts the set of values the column is allowed to take. We can
examine one of the dtypes directly to see the available values for that
column:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>pr_gen_fuel_annual.dtypes[<span class="st">"energy_source_code"</span>]</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>CategoricalDtype(categories=['BIT', 'DFO', 'MWH', 'NG', 'RFO', 'SUN', 'WAT', 'WND'], ordered=False, categories_dtype=object)</code></pre>
</div>
<p>We can glean a little information just from context here – this is an
energy source code, and it looks like it’s a 2- or 3-letter abbreviation
for where the energy came from. NG could be natural gas; SUN feels
likely for solar, WAT for hydro, WND for wind. BIT may be familiar if
you’re from anywhere in Appalachia, for bituminous coal. DFO and RFO are
a mystery to me, but codes like this should be defined in the
documentation for each dataset. Let’s look in the EIA 923 documentation
to see what the others are.</p>
<figure><img src="../fig/ep-5/eia923-reported_fuel_type_code.png" alt="Excel screenshot showing rows 68-94 of tab Page 7 File Layout of data/eia923_pr.xlsx. Row 68 contains the title: Reported Fuel Type Code; and description: The fuel code reported to EIA, two or three letter alphanumeric. There are rows for BIT (bituminous coal), DFO (distillate Fuel Oil including diesel, number 1, number 2, and number 4 fuel oils), NG (natural gas), and RFO (residual fuel oil, including number 5 and 6 fuel oils and bunker c fuel oil)." class="figure mx-auto d-block"><div class="figcaption">Excel screenshot showing tab Page 7 File Layout
of data/eia923_pr.xlsx, rows 68-94</div>
</figure><p>Under Reported Fuel Type Code, there are a lot more options than we
have in the pandas dtype, but that’s okay so long as all the options we
<em>do</em> have in the pandas dtype are listed – and they are. DFO is
distillate fuel oil (like diesel), and RFO is residual fuel oil.</p>
<div id="challenge2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p>Look at <code>reporting_frequency_code</code>, which is another
column with the <code>category</code> dtype. Use the column name, the
available values, and the EIA 923 documentation to get a rough idea of
what the category means.</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<p>The <code>reporting_frequency_code</code> column has 3 available
values:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>pr_gen_fuel_annual.dtypes[<span class="st">"reporting_frequency_code"</span>]</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>CategoricalDtype(categories=['A', 'AM', 'M'], ordered=False, categories_dtype=object)</code></pre>
</div>
<p>The documentation says these indicate respondents that file annually
with only annual totals, respondents that file annually with both annual
and monthly data, and respondents that file monthly data each month.</p>
</div>
</div>
</div>
</div>
<p>Great! Now we know how to start making sense of columns with the
<code>category</code> dtype.</p>
<p>To go deeper, let’s collect all the category columns together so we
can analyse them all at the same time.</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="co"># 1. carve off a chunk: what columns contain categorical data?</span></span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>category_columns <span class="op">=</span> <span class="bu">list</span>(</span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>    pr_gen_fuel_annual.dtypes[</span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>        (pr_gen_fuel_annual.dtypes <span class="op">==</span> <span class="st">"category"</span>)</span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a>    ].index</span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a>)</span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a>category_columns</span></code></pre>
</div>
<p>We can use <code>.describe()</code> to show some basic information
about category data.</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a>pr_gen_fuel_annual[category_columns].describe()</span></code></pre>
</div>
<p>Let’s look at <code>energy_source_code</code> as an example:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>energy_source_code	fuel_type_code_agg	fuel_unit	plant_state	prime_mover_code	reporting_frequency_code	data_maturity
count	450	450	319	450	450	349	450
unique	8	8	4	1	9	3	2
top	DFO	DFO	barrels	PR	PV	M	final
freq	188	188	237	450	99	181	417</code></pre>
</div>
<ul>
<li>
<code>count</code> shows us how many rows have a value set. If it’s
equal to the total number of rows, you know you have no nulls. Looks
like there aren’t any nulls in the in the energy source code, which is
good.</li>
<li>
<code>unique</code> shows us how many unique values are in each
column. We already kinda know this from looking at the category dtype
object, but it’s nice to have confirmation that this data includes 8
different energy source codes.</li>
<li>
<code>top</code> shows us the most common value in each column, and
<code>freq</code> shows how many times that value appeared. Looks like a
third to half of the rows have an energy source code of DFO.</li>
</ul>
<p>We can apply our strategy here too:</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="co"># 2. what do we expect?</span></span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a><span class="co"># - count: no nulls*</span></span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a><span class="co"># - unique: matches category dtype count, ~matches documentation</span></span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a><span class="co"># - top&amp;freq: plausible</span></span></code></pre>
</div>
<p>To go even further, we can look at the frequency table for
<code>energy_source_code</code> using <code>.value_counts()</code>:</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a>pr_gen_fuel_annual.energy_source_code.value_counts()</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>energy_source_code
DFO    188
SUN     99
NG      49
RFO     49
MWH     24
WND     17
WAT     15
BIT      9
Name: count, dtype: int64</code></pre>
</div>
<p>This builds up our domain knowledge and gives us a more detailed
picture of the energy landscape in Puerto Rico:</p>
<ul>
<li>Lots of oil</li>
<li>Solar is surprisingly common</li>
<li>Wind and hydro less so</li>
<li>Very few coal entries. Is this expected? Not sure.</li>
</ul>
<p>– but keep in mind, this is going purely by the number of EIA-923
entries, and not by the actual fuel mix of the grid. We’ll make a note
of the two surprises – lots of solar and little coal – in our notebook,
in case we want to come back to it later.</p>
<pre class="text"><code>Energy source code frequency table:
    energy_source_code
    DFO    188
    SUN     99
    NG      49
    RFO     49
    MWH     24
    WND     17
    WAT     15
    BIT      9
    Name: count, dtype: int64
Why so much solar?
Why so little coal?</code></pre>
<div id="challenge3" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p>Your turn: Examine the <code>.describe()</code> output for the other
category columns. Use the File Layout documentation and
<code>.value_counts()</code> to verify whether the
<code>reporting_frequency_code</code> and <code>fuel_unit</code> columns
make sense or not.</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a>pr_gen_fuel_annual.reporting_frequency_code.describe()</span></code></pre>
</div>
<p><code>reporting_frequency_code</code> looks good; the File Layout
documentation says there are three options, and we see three unique
values here. There are some nulls though. Something to keep an eye on if
we end up needing this column for something later.</p>
<p>Let’s make a note of what we found:</p>
<pre class="text"><code>- reporting_frequency_code has a bunch of nulls; will this matter? ~100/450</code></pre>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a>pr_gen_fuel_annual.fuel_unit.describe()</span></code></pre>
</div>
<p><code>fuel_unit</code> looks off, since File Layout says there should
be three values but <code>.describe()</code> found four. Let’s look
closer:</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a><span class="co"># 4. why are there 4 fuel units when the docs say there should only be three?</span></span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a>pr_gen_fuel_annual.fuel_unit.value_counts()</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>fuel_unit
barrels          237
mcf               49
megawatthours     24
short tons         9
Name: count, dtype: Int64</code></pre>
</div>
<p>Huh. <code>megawatthours</code> is not a valid physical unit,
according to the documentation… but it’s definitely not a typo. How is
this being used in the data?</p>
<p>We can filter for just the rows that use <code>megawatthours</code>
in the <code>fuel_unit</code> column:</p>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a>pr_gen_fuel_annual.loc[pr_gen_fuel_annual.fuel_unit <span class="op">==</span> <span class="st">"megawatthours"</span>, category_columns].describe()</span></code></pre>
</div>
<p>We can eyeball the whole dataframe looking for patterns, or we can
use <code>.describe()</code> to help us know for sure whether each
column has multiple values or only one.</p>
<ul>
<li>
<code>energy_source_code</code> is MWH, which intuitively matches
the unit but isn’t particularly illuminating</li>
<li>
<code>fuel_type_code_agg</code> is OTH, probably for “Other”; no
help there</li>
<li>
<code>prime_mover_code</code> is BA, which is worth looking up.
“Energy Storage, Battery” – looks like at least some of the PR
respondents report generation from batteries using a fuel unit, which
isn’t expected by the EIA, but they’re consistent about it, which is
nice.</li>
</ul>
<p>Better write that down too:</p>
<pre class="text"><code>- fuel_unit includes "megawatthours" for BA (=battery) prime movers</code></pre>
</div>
</div>
</div>
</div>
<p>We’ve split off 7 of the 24 columns using the “split by data type”
strategy to look at category data. Using this approach, we found some
null values we’ll need to handle carefully if we need those columns for
our research, and we found one off-spec-but-ultimately-reasonable rogue
value for <code>fuel_unit</code> that could have tripped us up if we
were relying on the documentation alone.</p>
</div>
<div class="section level3">
<h3 id="numeric-data">Numeric data<a class="anchor" aria-label="anchor" href="#numeric-data"></a>
</h3>
<p>But we’re here for <em>visual</em> data exploration! Let’s look at
some data we can plot.</p>
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a>pr_gen_fuel_annual.dtypes</span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a>pr_gen_fuel_annual.drop(columns<span class="op">=</span>category_columns).dtypes</span></code></pre>
</div>
<p>While the categorical data was pretty much limited to one dtype, the
numeric data is divided up between <code>float64</code> and
<code>Int64</code>. The columns with <code>float64</code> dtype, like
<code>elec_fuel_consumption_mmbtu</code>, can contain decimal fractions,
while the columns with <code>Int64</code> dtype, like
<code>report_year</code>, contain only whole numbers. Some datasets may
use integers to store whole-number measurements such as counts. In this
dataset, all of the measurements are continuous. If we want to plot
measurement data, we want to look at the float columns.</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a><span class="co"># 1. carve off a chunk: float columns for measurement data</span></span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a>measurement_columns <span class="op">=</span> <span class="bu">list</span>(</span>
<span id="cb33-3"><a href="#cb33-3" tabindex="-1"></a>    pr_gen_fuel_annual.dtypes[</span>
<span id="cb33-4"><a href="#cb33-4" tabindex="-1"></a>        (pr_gen_fuel_annual.dtypes <span class="op">==</span> <span class="st">"float64"</span>)</span>
<span id="cb33-5"><a href="#cb33-5" tabindex="-1"></a>    ].index</span>
<span id="cb33-6"><a href="#cb33-6" tabindex="-1"></a>)</span>
<span id="cb33-7"><a href="#cb33-7" tabindex="-1"></a>measurement_columns</span></code></pre>
</div>
<p>When we were looking at categorical string data, we used
<code>.describe()</code> to show a summary that helped us determine
whether the data was reasonable or not. We can use
<code>.describe()</code> on numeric data, too!</p>
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a>pr_gen_fuel_annual[measurement_columns].describe()</span></code></pre>
</div>
<p>For numeric data, <code>.describe()</code> gives us statistics for
each column.</p>
<ul>
<li>
<code>count</code> is the same as with string data: it shows us how
many rows have a value set. For all of these numeric columns, it is
equal to the total number of rows, so we know we have no nulls.</li>
<li>
<code>mean</code> is the average. If one of these showed a wildly
unexpected scale, or large negative, we would know something was weird,
but these all look plausible.</li>
<li>
<code>std</code> is the standard deviation, which tells you how
spread out the values are in each column.</li>
<li>
<code>min</code>, <code>25%</code> <code>50%</code> <code>75%</code>
(quartiles), <code>max</code> give a rough idea of how the data are
distributed. We have some negatives in
<code>total_net_generation_mwh</code>, but negatives do show up
sometimes in netgen, and negative 3,000 on a maximum of 3,000,000 is
reasonable.</li>
</ul>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a><span class="co"># what do we expect?</span></span>
<span id="cb35-2"><a href="#cb35-2" tabindex="-1"></a><span class="co"># - count: no/few nulls</span></span>
<span id="cb35-3"><a href="#cb35-3" tabindex="-1"></a><span class="co"># - mean&amp;std: plausible scale; plausible sign</span></span>
<span id="cb35-4"><a href="#cb35-4" tabindex="-1"></a><span class="co"># - quartiles: plausible scale; plausible sign</span></span></code></pre>
</div>
<p>This is where we can start looking at the relationship between
columns to see if problems are hiding there.</p>
<p>We’ve got two pairs of mmbtu+quantity variables. Since they’re
measuring in different units, we don’t expect their values to match, but
we do kinda expect them to have the same shape. But it looks like the
<code>_quantity</code> variables have a lot more zeros in them. Let’s
look closer with a histogram:</p>
<div class="codewrapper sourceCode" id="cb36">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a><span class="co"># what did we find? quantity has more zeros than mmbtus. why?</span></span>
<span id="cb36-2"><a href="#cb36-2" tabindex="-1"></a>elec_fuel_consumption_cols <span class="op">=</span> [<span class="st">"elec_fuel_consumption_mmbtu"</span>,<span class="st">"electric_fuel_consumption_quantity"</span>]</span>
<span id="cb36-3"><a href="#cb36-3" tabindex="-1"></a>elec_fuel_consumption <span class="op">=</span> pr_gen_fuel_annual[elec_fuel_consumption_cols]</span>
<span id="cb36-4"><a href="#cb36-4" tabindex="-1"></a>elec_fuel_consumption.hist()</span></code></pre>
</div>
<p>The first thing it prints out is this array of Axes. There is one for
each column we plotted. We’ll talk more about Axes in a little bit.</p>
<p>The next thing is shows is the histogram. There are a few things
preventing this graph from telling us what we want to know. A histogram
has the value on the x axis and the frequency of that value / range of
values on the y axis. These two plots have different y axes, which makes
it difficult to see that the zero bin has a different frequency for
mmbtus on the left than for quantity on the right. We can fix that with
<code>sharey</code>.</p>
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a>elec_fuel_consumption_cols <span class="op">=</span> [<span class="st">"elec_fuel_consumption_mmbtu"</span>,<span class="st">"electric_fuel_consumption_quantity"</span>]</span>
<span id="cb37-2"><a href="#cb37-2" tabindex="-1"></a>elec_fuel_consumption <span class="op">=</span> pr_gen_fuel_annual[elec_fuel_consumption_cols]</span>
<span id="cb37-3"><a href="#cb37-3" tabindex="-1"></a>elec_fuel_consumption.hist(sharey<span class="op">=</span><span class="va">True</span>)</span></code></pre>
</div>
<p>Now we can see that zeros are much more common on the right. Next
let’s make use of this empty space to the right of the plot. The default
plot width is quite narrow. To widen it, we will use the following
incantation:</p>
<div class="codewrapper sourceCode" id="cb38">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb38-2"><a href="#cb38-2" tabindex="-1"></a>plt.rcParams[<span class="st">'figure.figsize'</span>] <span class="op">=</span> [<span class="dv">10</span>, <span class="dv">4</span>]</span></code></pre>
</div>
<p>This sets the default figure size to 10 inches wide and 4 inches
tall. You can put in whatever size makes sense for your monitor. This
works because pandas uses matplotlib under the hood to make its plots.
When we change the settings for matplotlib, it affects pandas’
plotting.</p>
<p>Back to our question: why does <code>_quantity</code> have so many
more zeros than <code>_mmbtu</code>?</p>
<p>The easiest explanation would be if one of our categorical variables
could identify a group that behaved wildly differently in
<code>_quantity</code> than it did in <code>_mmbtu</code>.</p>
<p>Let’s check one categorical variable together.</p>
<p>We can use a for loop to plot each group from
<code>data_maturity</code>:</p>
<div class="codewrapper sourceCode" id="cb39">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" tabindex="-1"></a><span class="co"># why does quantity have more zeros than mmbtu?</span></span>
<span id="cb39-2"><a href="#cb39-2" tabindex="-1"></a><span class="cf">for</span> gr, df <span class="kw">in</span> pr_gen_fuel_annual.groupby(<span class="st">"data_maturity"</span>):</span>
<span id="cb39-3"><a href="#cb39-3" tabindex="-1"></a>    axs <span class="op">=</span> df.hist(column<span class="op">=</span>elec_fuel_consumption_cols, sharey<span class="op">=</span><span class="va">True</span>)</span></code></pre>
</div>
<p>That gave us one row for each value of <code>data_maturity</code>,
but it hasn’t told us which value goes with which row. That’s confusing.
Let’s add some labels using the <code>legend()</code> function:</p>
<div class="codewrapper sourceCode" id="cb40">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" tabindex="-1"></a><span class="cf">for</span> gr, df <span class="kw">in</span> pr_gen_fuel_annual.groupby(<span class="st">"data_maturity"</span>):</span>
<span id="cb40-2"><a href="#cb40-2" tabindex="-1"></a>    axs <span class="op">=</span> df.hist(column<span class="op">=</span>elec_fuel_consumption_cols, sharey<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb40-3"><a href="#cb40-3" tabindex="-1"></a>    axs[<span class="op">-</span><span class="dv">1</span>][<span class="op">-</span><span class="dv">1</span>].legend([<span class="ss">f"data_maturity: </span><span class="sc">{</span>gr<span class="sc">}</span><span class="ss">"</span>])</span></code></pre>
</div>
<p>Okay, so the first row is for <code>data_maturity</code> final and
the second row is for <code>data_maturity</code> incremental-ytd. These
show some slight differences, particularly for the incremental-ytd
group, but nothing overwhelmingly convincing. Ideally we would want to
see a group that had some nonzero bins for <code>mmbtu</code>, but only
the zero bin for <code>quantity</code>. We can mark
<code>data_maturity</code> as a “maybe” for helping explain our
question.</p>
<p>Let’s take a moment and review the process we just used for
exploratory data visualization:</p>
<p>First, we decided we wanted to see a histogram comparing quantity and
mmbtus split out by each category in the <code>data_maturity</code>
column.</p>
<p>Next, we wrote code to get pandas/matplotlib to show it to us.</p>
<p>In our first try, it was too hard to tell which set of histograms
went with which category. So, we added some code to label each pair of
histograms. They’re not pretty labels, but they were enough to clarify
what we were looking at.</p>
<p>Finally, we evaluated the plots and determined that
<code>data_maturity</code> doesn’t explain why quantity has more zeros
than mmbtus.</p>
<div id="challenge4" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p>Now it’s your turn. Find a categorical column that seems to explain
why there are so many more zeros in <code>quantity</code> than in
<code>mmbtu</code>.</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4"> Show me the solution </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" data-bs-parent="#accordionSolution4" aria-labelledby="headingSolution4">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb41">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" tabindex="-1"></a><span class="cf">for</span> gr, df <span class="kw">in</span> pr_gen_fuel_annual.groupby(<span class="st">"energy_source_code"</span>):</span>
<span id="cb41-2"><a href="#cb41-2" tabindex="-1"></a>    axs <span class="op">=</span> df.hist(column<span class="op">=</span>elec_fuel_consumption_cols, sharey<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb41-3"><a href="#cb41-3" tabindex="-1"></a>    axs[<span class="op">-</span><span class="dv">1</span>][<span class="op">-</span><span class="dv">1</span>].legend([gr])</span></code></pre>
</div>
<ul>
<li>SUN, WAT, and WND <em>always</em> have zero <code>quantity</code>.
You can kinda guess from the codes themselves, or look them up in the
File Layout documentation (“Reported Fuel Type Code”), but these are the
energy source codes for solar (SUN), hydro (WAT), and wind (WND) power.
Which kinda makes sense, if we’re trying to measure a “quantity of fuel
consumed”. How many units of sun did we burn today at the power plant?
How about wind? … water? It doesn’t explain why <code>mmbtu</code> for
renewables is nonzero, but it’s something!</li>
<li>Bonus confidence: the other energy source codes have
<em>excellent</em> matching between <code>quantity</code> and
<code>mmbtu</code>.</li>
<li>Bonus puzzle: MWH always has zero <code>mmbtu</code>! How odd.</li>
</ul>
<p>Honorable mentions:</p>
<ul>
<li>
<code>prime_mover</code> shows moderate differences for BA, CT, and
ST as well as the overwhelming differences for HY, PV, and WT. If you’re
a little more endowed with domain knowledge (or handy with the File
Layout documentation, “Reported Primer[sic] Mover”) you may notice that
these are the prime mover codes for hydro (HY), photovoltaic (PV), and
wind turbines (WT), which line up exactly with the WAT, SUN, and WND
energy source codes. The only reason this wasn’t my top choice for the
solution is because this dataset covers 8 energy source codes and 9
prime mover codes.</li>
<li>
<code>fuel_unit</code> shows suspicious differences for
megawatthours, though it’s in the opposite direction</li>
<li>
<code>reporting_frequency_code</code> shows suspicious differences
for AM, but that only covers ~10 respondents, and our discrepancy is
more like 50.</li>
</ul>
<p>Alternate approach: use boxplots</p>
<div class="codewrapper sourceCode" id="cb42">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" tabindex="-1"></a>axs<span class="op">=</span>pr_gen_fuel_annual.groupby(<span class="st">"energy_source_code"</span>)[elec_fuel_consumption_cols].plot.box(</span>
<span id="cb42-2"><a href="#cb42-2" tabindex="-1"></a>    label<span class="op">=</span><span class="st">"energy_source_code"</span>)</span>
<span id="cb42-3"><a href="#cb42-3" tabindex="-1"></a><span class="cf">for</span> i, ax <span class="kw">in</span> <span class="bu">zip</span>(axs.index, axs.values):</span>
<span id="cb42-4"><a href="#cb42-4" tabindex="-1"></a>    ax.legend([i])</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p>So now we know to stick to mmbtus if we want to capture renewables.
That’s definitely something to write down for future-us:</p>
<pre class="text"><code>- fuel consumption columns
  _ *_quantity is always zero for renewables (SUN, WAT, &amp; WND energy source codes) -- use *_mmbtu instead
  - *_mmbtu is always zero for MWH energy source code -- use *_quantity instead? :(</code></pre>
<p>Splitting off the numerical measurement data got us through another 5
columns. Using this approach, we found out that renewables are handled
oddly in the <code>fuel_consumption</code> columns: For solar, wind, and
hydro, all the useful data are in <code>_mmbtu</code>, and for battery
storage, they’re all in <code>_quantity</code>. If our research relies
on fuel consumption figures, we’ll need to either exclude renewables
from our analyses, or treat them separately.</p>
<p>The remaining 9 columns are:</p>
<ul>
<li>1 boolean column (honorary categorical)</li>
<li>3 object columns (all nulls)</li>
<li>3 Int64 columns (all identifiers)</li>
<li>2 string columns (all names) (you can analyse these the same way as
categoricals, using <code>.describe()</code> and
<code>.value_counts()</code>)</li>
</ul>
<p>We got through a 24-column table of annual data from EIA 923 in
Puerto Rico, and we know something about the primary key columns,
category columns, and numeric measurement columns. That’s a significant
step in getting familiar with this dataset!</p>
</div>
</div>
<div class="section level2">
<h2 id="little-break">Little break!<a class="anchor" aria-label="anchor" href="#little-break"></a>
</h2>
</div>
<div class="section level2">
<h2 id="monthly-data">Monthly data<a class="anchor" aria-label="anchor" href="#monthly-data"></a>
</h2>
<p>Now let’s look at the monthly data.</p>
<div class="codewrapper sourceCode" id="cb44">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" tabindex="-1"></a>pr_gen_fuel_monthly <span class="op">=</span> pd.read_parquet(monthly_file)</span>
<span id="cb44-2"><a href="#cb44-2" tabindex="-1"></a>pr_gen_fuel_monthly</span>
<span id="cb44-3"><a href="#cb44-3" tabindex="-1"></a>pr_gen_fuel_monthly.dtypes</span></code></pre>
</div>
<p>We have some familiar friends:</p>
<ul>
<li>Plant ID &amp; plant name</li>
<li>Prime mover code</li>
<li>Energy source code</li>
<li>Fuel unit</li>
</ul>
<p>We have a new <code>date</code> column with dtype
<code>datetime64</code>. What’s that about?</p>
<div class="codewrapper sourceCode" id="cb45">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" tabindex="-1"></a>pr_gen_fuel_monthly.date</span></code></pre>
</div>
<p>Looks suspiciously like the first of the month. Is it always like
that? We can verify using <code>.value_counts()</code>.</p>
<div class="codewrapper sourceCode" id="cb46">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" tabindex="-1"></a>pr_gen_fuel_monthly.date.value_counts().sort_index()</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>date
2017-01-01    35
2017-02-01    35
2017-03-01    35
2017-04-01    35
2017-05-01    35
              ..
2024-10-01    33
2024-11-01    33
2024-12-01    33
2025-01-01    33
2025-02-01    33
Name: count, Length: 98, dtype: int64</code></pre>
</div>
<p>Most of the remaining variables are time series. Time series data
lends itself to plotting especially well.</p>
<p>Most people are familiar with putting plots in reports, research
papers, and presentation slides, where they’re useful as evidence
supporting your argument. To be effective, those plots need to –
essentially – look nice: clear labels and titles, appropriate units and
limits, good color separation for print or screen, tidy legends,
minimizing extraneous data. The goal is to communicate your point.</p>
<p>When you’re in the exploratory phase, you don’t know what the point
is yet, and you’re communicating with yourself, now and future-you. To
be effective, exploratory plots need to tell you something you don’t
already know, and ideally they should do that quickly, so you don’t lose
track of what you’re doing. We can skip a lot of the presentation
refinements, so long as a plot is not <em>actively confusing</em>.</p>
<p>Pandas has great support for exploratory plotting, since it doesn’t
require much extra setup, and the options for presentation refinements
are extremely limited, reducing the risk of going down pixel-perfection
rabbit holes.</p>
<p>In the last section, we started to establish a rhythm for exploratory
data visualization. Let’s review that. The steps are:</p>
<ol style="list-style-type: decimal">
<li>Decide what we want to see</li>
<li>Get pandas/matplotlib to show it to us</li>
<li>If what we want to see is too hard to see, refine the plot</li>
<li>Make a note of anything surprising or weird for followup</li>
</ol>
<div class="section level3">
<h3 id="plot-all-monthly-variables">Plot all monthly variables<a class="anchor" aria-label="anchor" href="#plot-all-monthly-variables"></a>
</h3>
<p>Let’s look at all the monthly variables at once.</p>
<p>What do we want to see?</p>
<ul>
<li>a different line for each variable: fuel consumed for electricity
mmbtu &amp; units, fuel consumed mmbtu &amp; units, and net
generation</li>
<li>one value for each month – we’ll sum across all the plants</li>
</ul>
<p>Now let’s get pandas to show it to us.</p>
<p>The primary key or index columns for this data frame are the month
(“date”), plant id, plant name, prime mover, and energy source code.
We’ll throw fuel unit in there too.</p>
<div class="codewrapper sourceCode" id="cb48">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" tabindex="-1"></a>monthly_index_columns <span class="op">=</span> [</span>
<span id="cb48-2"><a href="#cb48-2" tabindex="-1"></a>    <span class="st">"date"</span>,</span>
<span id="cb48-3"><a href="#cb48-3" tabindex="-1"></a>    <span class="st">"plant_id_eia"</span>,</span>
<span id="cb48-4"><a href="#cb48-4" tabindex="-1"></a>    <span class="st">"plant_name_eia"</span>,</span>
<span id="cb48-5"><a href="#cb48-5" tabindex="-1"></a>    <span class="st">"prime_mover_code"</span>,</span>
<span id="cb48-6"><a href="#cb48-6" tabindex="-1"></a>    <span class="st">"energy_source_code"</span>,</span>
<span id="cb48-7"><a href="#cb48-7" tabindex="-1"></a>    <span class="st">"fuel_unit"</span>,</span>
<span id="cb48-8"><a href="#cb48-8" tabindex="-1"></a>]</span></code></pre>
</div>
<p>We want one value for each month, so we’ll group by date and then
sum.</p>
<pre><code>pr_gen_fuel_monthly.groupby("date").sum()</code></pre>
<p>When we sum on some of the index columns, we make a huge mess! How do
we get it to … not do that? If we move the index columns to the actual
index, then pandas won’t sum them.</p>
<div class="codewrapper sourceCode" id="cb50">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" tabindex="-1"></a>pr_gen_fuel_monthly.set_index(monthly_index_columns).groupby(<span class="st">"date"</span>).<span class="bu">sum</span>()</span></code></pre>
</div>
<p>Much better. Now plot!</p>
<div class="codewrapper sourceCode" id="cb51">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" tabindex="-1"></a>pr_gen_fuel_monthly.set_index(monthly_index_columns).groupby(<span class="st">"date"</span>).<span class="bu">sum</span>().plot()</span></code></pre>
</div>
<p>Check: can we see a different line for each variable, and one value
per month? Yes.</p>
<p>Things to notice:</p>
<ul>
<li>Big zero spike in late 2017, all variables</li>
<li>Repeating pattern of annual variation that peaks in the summer,
mostly</li>
<li>Variables are on vastly different scales but pandas did its best and
it’s okay</li>
</ul>
</div>
<div class="section level3">
<h3 id="compare-energy-source-breakdown-over-time">Compare energy source breakdown over time<a class="anchor" aria-label="anchor" href="#compare-energy-source-breakdown-over-time"></a>
</h3>
<p>Let’s dive in further. What does the energy source breakdown look
like over time?</p>
<p>Restart the cycle again. What do we want to see?</p>
<ul>
<li>a different line for each energy source: DFO, SUN, NG, etc</li>
<li>just fuel consumed mmbtus; we’ll lose battery storage but get to see
solar, hydro, and wind</li>
<li>one value for each month – we’ll sum across all the plants</li>
</ul>
<p>Now let’s get pandas to show it to us. To get <code>.plot()</code> to
show the lines we want, we’ll need to make one column for each energy
source, where each row is the sum for one month.</p>
<div class="codewrapper sourceCode" id="cb52">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" tabindex="-1"></a>(</span>
<span id="cb52-2"><a href="#cb52-2" tabindex="-1"></a>    pr_gen_fuel_monthly</span>
<span id="cb52-3"><a href="#cb52-3" tabindex="-1"></a>    .groupby([<span class="st">"energy_source_code"</span>, <span class="st">"date"</span>], observed<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb52-4"><a href="#cb52-4" tabindex="-1"></a>    .fuel_consumed_mmbtu.<span class="bu">sum</span>()</span>
<span id="cb52-5"><a href="#cb52-5" tabindex="-1"></a>    .unstack(<span class="st">"energy_source_code"</span>).plot()</span>
<span id="cb52-6"><a href="#cb52-6" tabindex="-1"></a>)</span></code></pre>
</div>
<p>Check: does this show us the lines we want? Yes, though it’s pretty
busy. We may need to split it up to see some elements more clearly.</p>
<div id="challenge5" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p>What do you notice?</p>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5"> Show me the solution </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" data-bs-parent="#accordionSolution5" aria-labelledby="headingSolution5">
<div class="accordion-body">
<ul>
<li>Zero spike in 2017 visible in all energy sources but recovery
severely delayed for BIT and renewables</li>
<li>NG another big drop in late 2019/early 2020; again in late 2021.
Independent of other energy sources though.</li>
<li>RFO also seems to vary quite a lot; also not related to other energy
sources.</li>
<li>Renewables way smaller than others</li>
<li>Renewables all drop starting in 2022</li>
</ul>
</div>
</div>
</div>
</div>
<p>That drop in 2022 looks pretty serious. Depending on the cause, it
could definitely affect any research we’d do with this data. We should
investigate further.</p>
</div>
<div class="section level3">
<h3 id="focus-on-renewables">Focus on renewables<a class="anchor" aria-label="anchor" href="#focus-on-renewables"></a>
</h3>
<p>This is an appropriate time for refinement: the current graph
settings aren’t giving us enough detail on the renewable energy
sources.</p>
<p>Let’s put the renewables on their own plot so we can see them
better.</p>
<div class="codewrapper sourceCode" id="cb53">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" tabindex="-1"></a>renewables <span class="op">=</span> [<span class="st">"SUN"</span>, <span class="st">"WND"</span>, <span class="st">"WAT"</span>]</span>
<span id="cb53-2"><a href="#cb53-2" tabindex="-1"></a>(</span>
<span id="cb53-3"><a href="#cb53-3" tabindex="-1"></a>    pr_gen_fuel_monthly</span>
<span id="cb53-4"><a href="#cb53-4" tabindex="-1"></a>    .loc[pr_gen_fuel_monthly.energy_source_code.isin(renewables)]</span>
<span id="cb53-5"><a href="#cb53-5" tabindex="-1"></a>    .groupby([<span class="st">"energy_source_code"</span>, <span class="st">"date"</span>], observed<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb53-6"><a href="#cb53-6" tabindex="-1"></a>    .fuel_consumed_mmbtu.<span class="bu">sum</span>()</span>
<span id="cb53-7"><a href="#cb53-7" tabindex="-1"></a>    .unstack(<span class="st">"energy_source_code"</span>).plot()</span>
<span id="cb53-8"><a href="#cb53-8" tabindex="-1"></a>)</span></code></pre>
</div>
<p>Okay, yes, that is dramatic. We can also see that hydro spends a lot
of time offline. Sufficiently so that we can’t really see if it’s
affected by whatever has happened in 2022.</p>
<p>Does this 2022 event show up in the net generation as well?</p>
<div id="challenge6" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p>Adapt our current fuel_consumed_mmbtu plot to show net_generation
instead.</p>
</div>
</div>
</div>
<div id="accordionSolution6" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution6" aria-expanded="false" aria-controls="collapseSolution6">
  <h4 class="accordion-header" id="headingSolution6"> Show me the solution </h4>
</button>
<div id="collapseSolution6" class="accordion-collapse collapse" data-bs-parent="#accordionSolution6" aria-labelledby="headingSolution6">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb54">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" tabindex="-1"></a>(</span>
<span id="cb54-2"><a href="#cb54-2" tabindex="-1"></a>    pr_gen_fuel_monthly</span>
<span id="cb54-3"><a href="#cb54-3" tabindex="-1"></a>    .loc[pr_gen_fuel_monthly.energy_source_code.isin(renewables)]</span>
<span id="cb54-4"><a href="#cb54-4" tabindex="-1"></a>    .groupby([<span class="st">"energy_source_code"</span>, <span class="st">"date"</span>], observed<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb54-5"><a href="#cb54-5" tabindex="-1"></a>    .net_generation_mwh.<span class="bu">sum</span>()</span>
<span id="cb54-6"><a href="#cb54-6" tabindex="-1"></a>    .unstack(<span class="st">"energy_source_code"</span>).plot()</span>
<span id="cb54-7"><a href="#cb54-7" tabindex="-1"></a>)</span></code></pre>
</div>
<p>No, not really :(</p>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="try-a-scatter-plot">Try a scatter plot<a class="anchor" aria-label="anchor" href="#try-a-scatter-plot"></a>
</h3>
<p>Okay, what else could it be? Maybe a big renewables plant opened or
closed that did things differently than the others? Let’s look for
patterns or clusters in the relationship between net generation and fuel
consumed mmbtus for renewables.</p>
<p>What do we want to see?</p>
<ul>
<li>a scatter plot with one point for each row</li>
<li>net generation on the x axis</li>
<li>fuel consumed on the y axis</li>
</ul>
<p>Now let’s get pandas to show it to us.</p>
<div class="codewrapper sourceCode" id="cb55">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" tabindex="-1"></a>renewables_monthly <span class="op">=</span> pr_gen_fuel_monthly.loc[pr_gen_fuel_monthly.energy_source_code.isin(renewables)]</span>
<span id="cb55-2"><a href="#cb55-2" tabindex="-1"></a>(</span>
<span id="cb55-3"><a href="#cb55-3" tabindex="-1"></a>    renewables_monthly.plot</span>
<span id="cb55-4"><a href="#cb55-4" tabindex="-1"></a>    .scatter(x<span class="op">=</span><span class="st">"net_generation_mwh"</span>, y<span class="op">=</span><span class="st">"fuel_consumed_mmbtu"</span>)</span>
<span id="cb55-5"><a href="#cb55-5" tabindex="-1"></a>)</span></code></pre>
</div>
<p>Check: does this show us a scatter plot with netgen on the x and fuel
consumed on the y? Yes, and we can even see there are at least two
distinct patterns. It’s pretty blobular though, and that makes it tough
to see whether there are only two or if more are hiding here in this top
one. This is an appropriate time for refinement: the current graph
settings aren’t giving us all the information we want.</p>
<p>We can reduce the size of each point to see if that gives us clearer
separation.</p>
<div class="codewrapper sourceCode" id="cb56">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" tabindex="-1"></a>(</span>
<span id="cb56-2"><a href="#cb56-2" tabindex="-1"></a>    renewables_monthly.plot</span>
<span id="cb56-3"><a href="#cb56-3" tabindex="-1"></a>    .scatter(x<span class="op">=</span><span class="st">"net_generation_mwh"</span>, y<span class="op">=</span><span class="st">"fuel_consumed_mmbtu"</span>, s<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb56-4"><a href="#cb56-4" tabindex="-1"></a>)</span></code></pre>
</div>
<p>Is that three lines? Three lines for three energy sources? Awfully
suspicious.</p>
<p>This is another appropriate time for refinement: we can add color to
show whether each line is for a different energy source.</p>
<div class="codewrapper sourceCode" id="cb57">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" tabindex="-1"></a>(</span>
<span id="cb57-2"><a href="#cb57-2" tabindex="-1"></a>    renewables_monthly.plot</span>
<span id="cb57-3"><a href="#cb57-3" tabindex="-1"></a>    .scatter(x<span class="op">=</span><span class="st">"net_generation_mwh"</span>, y<span class="op">=</span><span class="st">"fuel_consumed_mmbtu"</span>, s<span class="op">=</span><span class="fl">0.1</span>, c<span class="op">=</span><span class="st">"energy_source_code"</span>)</span>
<span id="cb57-4"><a href="#cb57-4" tabindex="-1"></a>)</span></code></pre>
</div>
<p>oh gee thanks pandas, the default colormap is grayscale. That’s not
helping at all.</p>
<div class="codewrapper sourceCode" id="cb58">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" tabindex="-1"></a>(</span>
<span id="cb58-2"><a href="#cb58-2" tabindex="-1"></a>    renewables_monthly.plot</span>
<span id="cb58-3"><a href="#cb58-3" tabindex="-1"></a>    .scatter(x<span class="op">=</span><span class="st">"net_generation_mwh"</span>, y<span class="op">=</span><span class="st">"fuel_consumed_mmbtu"</span>, s<span class="op">=</span><span class="fl">0.1</span>, c<span class="op">=</span><span class="st">"energy_source_code"</span>, colormap<span class="op">=</span><span class="st">"rainbow"</span>)</span>
<span id="cb58-4"><a href="#cb58-4" tabindex="-1"></a>)</span></code></pre>
</div>
<p>Oh do not like that. Instead of each line a different color, there
are colors for all three energy sources on all the lines. So energy
source code does not explain what’s going on here.</p>
<div id="challenge7" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p>Are there any other variables in our data that, when used to color
this plot, clearly separate the lines by color?</p>
</div>
</div>
</div>
<div id="accordionSolution7" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution7" aria-expanded="false" aria-controls="collapseSolution7">
  <h4 class="accordion-header" id="headingSolution7"> Show me the solution </h4>
</button>
<div id="collapseSolution7" class="accordion-collapse collapse" data-bs-parent="#accordionSolution7" aria-labelledby="headingSolution7">
<div class="accordion-body">
<p>Disappointingly, <code>date</code> is the only one that really does
it:</p>
<div class="codewrapper sourceCode" id="cb59">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" tabindex="-1"></a>(</span>
<span id="cb59-2"><a href="#cb59-2" tabindex="-1"></a>    renewables_monthly</span>
<span id="cb59-3"><a href="#cb59-3" tabindex="-1"></a>    .plot.scatter(x<span class="op">=</span><span class="st">"net_generation_mwh"</span>, y<span class="op">=</span><span class="st">"fuel_consumed_mmbtu"</span>, s<span class="op">=</span><span class="fl">0.2</span>, c<span class="op">=</span><span class="st">"date"</span>, colormap<span class="op">=</span><span class="st">"rainbow"</span>)</span>
<span id="cb59-4"><a href="#cb59-4" tabindex="-1"></a>)</span></code></pre>
</div>
<p>But at least it clearly identifies three lines. This feels like a
policy change effect – a coordinated change throughout Puerto Rico in
how fuel consumption is reported for renewables (which as we know from
the annual data, is already pretty weird).</p>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="try-plotting-the-heat-rate">Try plotting the heat rate<a class="anchor" aria-label="anchor" href="#try-plotting-the-heat-rate"></a>
</h3>
<p>We’ve probably extracted all the information we can out of this
scatter plot. Sometimes viewing the same data from another angle can
reveal further insights. Let’s try that now: What are the slopes of
these lines?</p>
<p>Fuel consumed per MWH generated is the heat rate, and we can compute
that directly:</p>
<div class="codewrapper sourceCode" id="cb60">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" tabindex="-1"></a>(</span>
<span id="cb60-2"><a href="#cb60-2" tabindex="-1"></a>    renewables_monthly</span>
<span id="cb60-3"><a href="#cb60-3" tabindex="-1"></a>    .assign(heat_rate<span class="op">=</span>renewables_monthly.fuel_consumed_mmbtu<span class="op">/</span>renewables_monthly.net_generation_mwh)</span>
<span id="cb60-4"><a href="#cb60-4" tabindex="-1"></a>    .plot.scatter(x<span class="op">=</span><span class="st">"date"</span>, y<span class="op">=</span><span class="st">"heat_rate"</span>, s<span class="op">=</span><span class="fl">0.5</span>, c<span class="op">=</span><span class="st">"date"</span>, colormap<span class="op">=</span><span class="st">"rainbow"</span>)</span>
<span id="cb60-5"><a href="#cb60-5" tabindex="-1"></a>)</span></code></pre>
</div>
<p>Oh hey, more subtle than we thought. It looks like whatever constant
everyone was using to compute fuel consumption changed a little bit each
year, with a big gap for Maria, and then suddenly decided once and for
all in 2022.</p>
<div id="callout1" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div class="callout-inner">
<div class="callout-content">
<p>This was a real policy change, and it affected more than Puerto
Rico!</p>
<p>Starting in 2023 (in which reports on 2022 data were published), the
EIA changed how it assesses noncombustible renewable energy
contributions. The old way used a fossil fuel equivalency approach and
was adjusted each year using an average heat rate; the new way uses a
captured energy approach and uses a constant heat conversion factor.</p>
<p>For more information, see this <a href="https://www.cleanenergytransition.org/post/understanding-how-the-eia-is-measuring-noncombustible-renewables?u" class="external-link">CleanEnergyTransition
explainer</a>.</p>
</div>
</div>
</div>
<p>The colormap made it easy to see how the different heatrate values
corresponded to our line chart from before, but it’s making these little
stragglers hard to see. Now that we have established some continuity
from the previous plot, we can drop the colormap and focus on the
stragglers.</p>
<div class="codewrapper sourceCode" id="cb61">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" tabindex="-1"></a>(</span>
<span id="cb61-2"><a href="#cb61-2" tabindex="-1"></a>    renewables_monthly</span>
<span id="cb61-3"><a href="#cb61-3" tabindex="-1"></a>    .assign(heat_rate<span class="op">=</span>renewables_monthly.fuel_consumed_mmbtu<span class="op">/</span>renewables_monthly.net_generation_mwh)</span>
<span id="cb61-4"><a href="#cb61-4" tabindex="-1"></a>    .plot.scatter(x<span class="op">=</span><span class="st">"date"</span>, y<span class="op">=</span><span class="st">"heat_rate"</span>, s<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb61-5"><a href="#cb61-5" tabindex="-1"></a>)</span></code></pre>
</div>
<p>Are those individual plants or some other effect?</p>
<div class="codewrapper sourceCode" id="cb62">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" tabindex="-1"></a>(</span>
<span id="cb62-2"><a href="#cb62-2" tabindex="-1"></a>    renewables_monthly</span>
<span id="cb62-3"><a href="#cb62-3" tabindex="-1"></a>    .assign(heat_rate<span class="op">=</span>renewables_monthly.fuel_consumed_mmbtu<span class="op">/</span>renewables_monthly.net_generation_mwh)</span>
<span id="cb62-4"><a href="#cb62-4" tabindex="-1"></a>    .assign(plant_factor<span class="op">=</span>renewables_monthly.plant_name_eia.astype(<span class="st">"category"</span>))</span>
<span id="cb62-5"><a href="#cb62-5" tabindex="-1"></a>    .plot.scatter(x<span class="op">=</span><span class="st">"date"</span>, y<span class="op">=</span><span class="st">"heat_rate"</span>, s<span class="op">=</span><span class="fl">0.5</span>, c<span class="op">=</span><span class="st">"plant_factor"</span>, colormap<span class="op">=</span><span class="st">"rainbow"</span>)</span>
<span id="cb62-6"><a href="#cb62-6" tabindex="-1"></a>)</span></code></pre>
</div>
<p>This colormap is a little too squished to tell us exactly which plant
is the troublemaker, but it does give us enough to suggest that it’s
only one or two plants. If we wanted to figure out exactly which ones,
we could split the data by year, use <code>.describe()</code> to get the
median ratio for each year, then select all the rows that had a
different ratio. We’ll leave that for future research!</p>
<p>In the meantime, let’s review: We were able to use timeseries plots
to identify a weird effect in the data, and then use two other
visualizations to narrow down the cause and extent of the weirdness. We
now know that any models that make use of fuel consumed or heat rate
will need to account for the changes in how renewables were handled in
pre- and post-2022 data. Any models that compare or rely on differences
in heat rates between plants will probably need to exclude renewables
entirely.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<span class="callout-header">Key Points</span>
<div class="callout-inner">
<div class="callout-content">
<ul>
<li>Different kinds of data – indexing, categorical, numeric, time
series – are suited to different kinds of summarization and
visualization.</li>
<li>Divide-and-conquer strategies that split data by type or by purpose
can help you get to know tables that have a lot of columns (common in
energy data).</li>
<li>Successful strategies for assessing data problems alternate between
noticing your expectations about the data and checking to see if the
data match your expectations – and sometimes, updating your expectations
based on what you find!</li>
<li>Visualization is not just for reports, papers, and talks! If you
incorporate plotting into your exploration &amp; troubleshooting toolbox
you’ll be able to identify and diagnose data problems much more quickly
than if you wait for your model to exhibit strange behavior.</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</div>
</div>
</div></section><section id="aio-assumptions"><p>Content from <a href="assumptions.html">Making assumptions about your data</a></p>
<hr>
<p>Last updated on 2025-09-24 |

        <a href="https://github.com/catalyst-cooperative/open-energy-data-for-all/edit/main/episodes/assumptions.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 50 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div id="accordionInstructor1" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor1" aria-expanded="false" aria-controls="collapseInstructor1">
  <h3 class="accordion-header" id="headingInstructor1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Instructor Note </h3>
</button>
<div id="collapseInstructor1" class="accordion-collapse collapse" data-bs-parent="#accordionInstructor1" aria-labelledby="headingInstructor1">
<div class="accordion-body">
<p>Prep list:</p>
<ul>
<li>
<a href="https://www.docs.new" class="external-link">make a Google Doc</a> that people can
put their assumptions in; make it editable by all who have the link</li>
<li>clean out the example notebook so that you can type everything out
again</li>
</ul>
</div>
</div>
</div>
</div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>Exploratory data analysis was fun, but what did I learn?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Articulate assumptions about a dataset</li>
<li>Programmatically verify those assumptions</li>
<li>Prioritize which assumptions are worth verifying</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="intro">Intro<a class="anchor" aria-label="anchor" href="#intro"></a>
</h2>
<hr class="half-width">
<p>As we explore a dataset we naturally start to make assumptions about
it. We also constantly find new evidence that our initial assumptions
are incorrect. We zoom in a little closer to a suspiciously low value,
or we notice that a certain column has more null values than we
expected, or we see that certain values seem to be duplicated in a
confusing way, and suddenly our understanding of the data is irrevocably
changed.</p>
<p>This can understandably have impact on your work! Depending on what
you are using the data for, these shifts will impact your work
differently. Some will not actually affect your output - maybe you
weren’t using that column anyways - but others will mean you have to
make changes to your code, your conclusions, your methodology section,
or the way you answer a question when presenting at a conference.</p>
<p>It’s nice to at least try to see these things coming, so in this
lesson we’ll talk about:</p>
<ul>
<li>identifying and articulating assumptions about a dataset</li>
<li>simple tools for testing these assumptions</li>
<li>prioritizing assumptions for testing</li>
</ul>
<p>Afterwards, you’ll be able to have your code automatically check that
the important assumptions haven’t been broken.</p>
<p>While faulty assumptions lurk everywhere, we’ll focus here on
assumptions about your <em>data</em>.</p>
<p>Speaking of data, we have a dataset at
<code>data/pr_gen_fuel_monthly.parquet</code>, which we’ll be using for
concrete examples through the rest of the lesson. It contains fuel
consumption and electricity generation information, split out by
generation unit and reported monthly, for all of Puerto Rico. This data
was collected by the EIA in form EIA 923.</p>
</section><section><h2 class="section-heading" id="what-is-an-assumption-anyways">What is an assumption anyways?<a class="anchor" aria-label="anchor" href="#what-is-an-assumption-anyways"></a>
</h2>
<hr class="half-width">
<p>In this context, an <em>assumption</em> can be any property you think
is true about the data.</p>
<p>Some examples:</p>
<ul>
<li>values are reasonable: the reported fuel usage in MMBtu is always
non-negative.</li>
<li>relationships are well-defined: data rows that share the same plant
ID correspond to the same plant</li>
<li>data types are consistent: the “year” column only contains numbers,
not words or strings of random characters</li>
<li>and many more!</li>
</ul>
<p>The sneakiest assumptions are the ones that are hard to think of. If
they were obvious to you, then you probably were already working around
them in some way. With that in mind, let’s try to come up with some
assumptions of our own!</p>
<div id="challenge-identifying-assumptions" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<span class="callout-header">Discussion</span>
<div id="challenge-identifying-assumptions" class="callout-inner">
<h3 class="callout-title">Challenge: identifying assumptions</h3>
<div class="callout-content">
<p>Take 5 minutes to list out as many assumptions as you can about the
EIA 923 Puerto Rico data (<code>pr_gen_fuel_monthly.parquet</code>) in
the <a href="data/">data directory</a>.</p>
<p>Please put them in the shared Google doc that your instructor
prepared for you. This will serve as a foundation for future challenges
in this lesson.</p>
<p>The goal is to get past the obvious ones and start thinking of some
un-obvious assumptions - no need to limit yourself to ‘realistic’ ones
at this stage.</p>
<p>Some prompts to get you started:</p>
<ul>
<li>what problems have you run into in previous datasets?</li>
<li>if you were here for the data exploration episode, what are some
things you learned about the data then?</li>
<li>how can I build on others’ suggestions in the doc?</li>
</ul>
<p>When we return, we’ll talk about which things worked.</p>
</div>
</div>
</div>
<div id="accordionInstructor2" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor2" aria-expanded="false" aria-controls="collapseInstructor2">
  <h3 class="accordion-header" id="headingInstructor2">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div> Instructor Note </h3>
</button>
<div id="collapseInstructor2" class="accordion-collapse collapse" data-bs-parent="#accordionInstructor2" aria-labelledby="headingInstructor2">
<div class="accordion-body">
<p>Some examples, if students are feeling a little quiet:</p>
<ul>
<li>the net generation data is actually in MWh and not a mix of
units</li>
<li>the net generation of batteries is strictly less than the fuel
consumed in MWh</li>
<li>the net generation of each individual plant is “reasonable” -
i.e. there are no reports of a generator producing more power than the
Sun</li>
<li>the reported dates are all within the last decade</li>
<li>the fuel mix matches what we know of physical reality</li>
<li>the total generation matches what we expect for Puerto Rican
electricity demand</li>
<li>all energy source codes correspond to the set in the
documentation</li>
<li>a plant ID corresponds to only one plant name per year</li>
<li>a given plant ID always corresponds to the same plant name</li>
<li>plant IDs are distributed in chronological order of
construction</li>
<li>every generator has at least one reporting period for which they
have non-zero generation</li>
<li>electricity generation heat rates are close to known averages for
their prime mover / energy source</li>
<li>if a value is reported, it is correct and reflects reality</li>
<li>if a generator reports all null values for a specific time period,
it was non-operational during that time period; if a generator reports 0
generation for a specific time period, it was operational, but not
dispatched</li>
</ul>
<p>By the end of this we want at least one assumption that fits each of
these categories:</p>
<ul>
<li>easy to test</li>
<li>hard to test</li>
<li>hard to test programmatically, but easy to eyeball</li>
<li>high impact (probably crashes your system)</li>
<li>moderate impact (probably makes bad analysis)</li>
<li>low impact (probably doesn’t do anything)</li>
<li>high likelihood</li>
<li>low likelihood</li>
</ul>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="how-to-test-your-assumptions">How to test your assumptions<a class="anchor" aria-label="anchor" href="#how-to-test-your-assumptions"></a>
</h2>
<hr class="half-width">
<p>Let’s take a look at one of the example assumptions and see how we’d
test it:</p>
<blockquote>
<p>the reported fuel consumption in MMBtu is always non-negative.</p>
</blockquote>
<p>How would we verify that? We can use an <code>assert</code> statement
to verify the assumption.</p>
<p><code>assert</code> basically says, “if this next part is True,
great! Nothing happens. If it’s false, we’ll raise an error.”</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="cf">assert</span> <span class="dv">1</span> <span class="op">==</span> <span class="dv">1</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="cf">assert</span> <span class="dv">1</span> <span class="op">==</span> <span class="dv">2</span></span></code></pre>
</div>
<p>We can include a message in the statement as well, to make the error
a little nicer:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="cf">assert</span> <span class="dv">1</span> <span class="op">==</span> <span class="dv">2</span>, <span class="st">"Expected 1 to be equal to 2."</span></span></code></pre>
</div>
<p>So let’s assert our assumption is true.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># read in the data</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>monthly_gen_fuel <span class="op">=</span> pd.read_parquet(<span class="st">"../data/pr_gen_fuel_monthly.parquet"</span>)</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="co"># pull out the piece we're interested in</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>fuel_consumed_mmbtu <span class="op">=</span> monthly_pr_gen_fuel[<span class="st">"fuel_consumed_mmbtu"</span>]</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a><span class="co"># finally make that assertion!</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="cf">assert</span> (fuel_consumed_mmbtu <span class="op">&gt;=</span> <span class="dv">0</span>).<span class="bu">all</span>(), <span class="st">"The reported fuel consumption in MMBtu should be non-negative"</span></span></code></pre>
</div>
<p>Oh no! We find that the assertion is not true! This is actually
pretty common. Let’s dig in to see what’s going on.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>fuel_consumed_mmbtu[<span class="op">~</span>(fuel_consumed_mmbtu <span class="op">&gt;=</span> <span class="dv">0</span>)]</span></code></pre>
</div>
<p>Huh! We get a bunch of not-a-number values. That is expected, too, so
let’s tweak our assumption to: “If fuel consumption in MMBtu is reported
at all, it should be non-negative.”</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="cf">assert</span> (fuel_consumed_mmbtu.dropna() <span class="op">&gt;=</span> <span class="dv">0</span>).<span class="bu">all</span>(), <span class="st">"If fuel consumption in MMBtu is reported at all, it should be non-negative."</span></span></code></pre>
</div>
<p>Which passes with little fanfare.</p>
</section><section><h2 class="section-heading" id="which-assumptions-are-worth-testing">Which assumptions are worth testing?<a class="anchor" aria-label="anchor" href="#which-assumptions-are-worth-testing"></a>
</h2>
<hr class="half-width">
<p>As we’ve just seen, assumptions take some effort to test. While it’s
useful to test many assumptions, the reality is that we have limited
time to work on our projects and need to prioritize the assumptions that
are “worth” the investment of testing them.</p>
<p>What makes assumptions worth testing? Here are three dimensions to
consider in a rudimentary prioritization framework:</p>
<ul>
<li>How easy it is to test the assumption: the less you have to work for
this test, the more likely it is to be worth it.</li>
<li>The impact on your code: what’s the goal of the system you’ve built
up? What happens to that goal if your assumption is violated?</li>
<li>The likelihood the assumption is violated: what are some ways this
could go wrong? Do they feel plausible or implausible?</li>
</ul>
<p>Some examples:</p>
<ul>
<li>the reported fuel consumption in MMBtu is always non-negative
<ul>
<li>pretty easy to test - we didn’t have to do <em>too</em> much work
above</li>
<li>moderate impact - though this depends on the goals of my system, if
I do any analysis that touches the negative fuel consumption I will
probably end up with numbers that are off in some way.</li>
<li>high likelihood - all it takes is a typo, which happens all the
time.</li>
</ul>
</li>
<li>NA values reflect periods of inactivity for the generator
<ul>
<li>quite hard to test - we would have to find another source for
month-to-month generator activity status and then cross-reference.</li>
<li>high impact - assuming we’re looking at any subset of the data that
includes NA values, if those don’t actually correspond to the activity
of the generator we are going to be heavily misled.</li>
<li>moderate likelihood - it seems easy for some plant administrator to
just forget to report data for a month or two, but there’s likely
<em>some</em> enforcement from the EIA.</li>
</ul>
</li>
<li>there is at least one row of data in the report
<ul>
<li>easy to test!</li>
<li>high impact - any cleaning and analysis requires data to work
on</li>
<li>moderate likelihood - some file transfer failure could easily make
this fail.</li>
</ul>
</li>
</ul>
<div id="challenge-prioritizing-assumptions" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<span class="callout-header">Discussion</span>
<div id="challenge-prioritizing-assumptions" class="callout-inner">
<h3 class="callout-title">Challenge: prioritizing assumptions</h3>
<div class="callout-content">
<p>Now it’s time to try out that prioritization framework!</p>
<p>Let’s start by looking at the list of assumptions we came up
with.</p>
<p>Take a few minutes to put a <code>+</code> next to 3-5 assumptions
that feel important to test.</p>
<p>We’ll then discuss a few assumptions with many <code>+</code>s and
how they fit into the framework above.</p>
</div>
</div>
</div>
<div id="challenge-testing-an-assumption" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<span class="callout-header">Discussion</span>
<div id="challenge-testing-an-assumption" class="callout-inner">
<h3 class="callout-title">Challenge: testing an assumption</h3>
<div class="callout-content">
<p>Now that we have our list of high-priority testing targets, we can go
ahead and write some tests for them!</p>
<p>Pick one of the assumptions identified as high-priority in the last
challenge, and write some code to test whether it’s true or false.</p>
<p>When we finish, we’ll talk about challenges we ran into in writing
these tests.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<hr class="half-width">
<p>We’ve thought a bunch about assumptions and how to test them. What
can we do with this?</p>
<p>The most important is to add checks to your data processing code, to
make sure that your inputs and outputs are behaving as you expect, every
time the code runs. This protects you from surprising changes in new
data, or surprising behavior of changes you make to your code.</p>
<p>Hopefully that saves you from some hair-pulling debugging sessions in
the future!</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<span class="callout-header">Key Points</span>
<div class="callout-inner">
<div class="callout-content">
<ul>
<li>you’re always making assumptions about your data, and many of them
are likely to be wrong</li>
<li>you can prioritize assumptions by thinking about their impact,
likelihood, and testability</li>
<li>you can use <code>assert</code> statements to tell you if an
assumption is wrong <em>every time you run the code</em>
</li>
</ul>
</div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></section><section id="aio-coming-soon"><p>Content from <a href="coming-soon.html">More Topics Coming Soon</a></p>
<hr>
<p>Last updated on 2025-09-09 |

        <a href="https://github.com/catalyst-cooperative/open-energy-data-for-all/edit/main/episodes/coming-soon.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 0 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<p>Topics we plan to cover in the future include:</p>
<ul>
<li>Spend less time fighting with your data and development environment
and more time on your research
<ul>
<li>Plotting as a visual debugging tool</li>
<li>Organizing code to simplify common tasks</li>
<li>Data validation &amp; automated testing</li>
<li>Working with data too big to fit in memory</li>
</ul>
</li>
</ul></section>
</div>
    </main>
</div>
<!-- END  : inst/pkgdown/templates/content-extra.html -->

      </div>
<!--/div.row-->
      		<footer class="row footer mx-md-3"><hr>
<div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/catalyst-cooperative/open-energy-data-for-all/edit/main/README.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/catalyst-cooperative/open-energy-data-for-all/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/catalyst-cooperative/open-energy-data-for-all/" class="external-link">Source</a></p>
				<p><a href="https://github.com/catalyst-cooperative/open-energy-data-for-all/blob/main/CITATION.cff" class="external-link">Cite</a> | <a href="mailto:hello@catalyst.coop">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.17.1" class="external-link">sandpaper (0.17.1)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.9" class="external-link">pegboard (0.7.9)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.7" class="external-link">varnish (1.0.7)</a></p>
			</div>
		</footer>
</div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "LearningResource",
  "@id": "https://catalyst-cooperative.github.io/open-energy-data-for-all/instructor/aio.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/LearningResource/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, energy, PUDL, catalyst",
  "name": "All in One View",
  "creativeWorkStatus": "active",
  "url": "https://catalyst-cooperative.github.io/open-energy-data-for-all/instructor/aio.html",
  "identifier": "https://catalyst-cooperative.github.io/open-energy-data-for-all/instructor/aio.html",
  "dateCreated": "2024-10-23",
  "dateModified": "2025-09-24",
  "datePublished": "2025-09-24"
}

  </script><script>
		feather.replace();
	</script>
</body>
</html><!-- END:   inst/pkgdown/templates/layout.html-->

